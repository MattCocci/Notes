\documentclass[12pt]{article}

\author{Matthew D. Cocci}
\title{Macroeconomics}
\date{\today}

%% Formatting & Spacing %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\usepackage[top=1in, bottom=1in, left=1in, right=1in]{geometry} % most detailed page formatting control
\usepackage{fullpage} % Simpler than using the geometry package; std effect
\usepackage{setspace}
%\onehalfspacing
\usepackage{microtype}

%% Formatting %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\usepackage[margin=1in]{geometry}
    %   Adjust the margins with geometry package
%\usepackage{pdflscape}
    %   Allows landscape pages
%\usepackage{layout}
    %   Allows plotting of picture of formatting



%% Header %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\usepackage{fancyhdr}
%\pagestyle{fancy}
%\lhead{}
%\rhead{}
%\chead{}
%\setlength{\headheight}{15.2pt}
    %   Make the header bigger to avoid overlap

%\fancyhf{}
    %   Erase header settings

%\renewcommand{\headrulewidth}{0.3pt}
    %   Width of the line

%\setlength{\headsep}{0.2in}
    %   Distance from line to text


%% Mathematics Related %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{mathrsfs}
\usepackage{amsthm} %allows for labeling of theorems
%\numberwithin{equation}{section} % Number equations by section
\theoremstyle{plain}
\newtheorem{thm}{Theorem}[section]
\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}

\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}
\newtheorem{ex}[thm]{Example}

\theoremstyle{remark}
\newtheorem*{rmk}{Remark}
\newtheorem*{note}{Note}

% Below supports left-right alignment in matrices so the negative
% signs don't look bad
\makeatletter
\renewcommand*\env@matrix[1][c]{\hskip -\arraycolsep
  \let\@ifnextchar\new@ifnextchar
  \array{*\c@MaxMatrixCols #1}}
\makeatother


%% Font Choices %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[utf8]{inputenc}
%\usepackage{blindtext}
\usepackage{courier}


%% Figures %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing}
\usepackage{graphicx}
\usepackage{subfigure}
    %   For plotting multiple figures at once
%\graphicspath{ {Directory/} }
    %   Set a directory for where to look for figures


%% Hyperlinks %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{hyperref}
\hypersetup{%
    colorlinks,
        %   This colors the links themselves, not boxes
    citecolor=black,
        %   Everything here and below changes link colors
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}

%% Colors %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{color}
\definecolor{codegreen}{RGB}{28,172,0}
\definecolor{codelilas}{RGB}{170,55,241}

% David4 color scheme
\definecolor{d4blue}{RGB}{100,191,255}
\definecolor{d4gray}{RGB}{175,175,175}
\definecolor{d4black}{RGB}{85,85,85}
\definecolor{d4orange}{RGB}{255,150,100}

%% Including Code %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{verbatim}
    %   For including verbatim code from files, no colors
\usepackage{listings}
    %   For including code snippets written directly in this doc

\lstdefinestyle{bash}{%
  language=bash,%
  basicstyle=\footnotesize\ttfamily,%
  showstringspaces=false,%
  commentstyle=\color{gray},%
  keywordstyle=\color{blue},%
  xleftmargin=0.25in,%
  xrightmargin=0.25in
}

\lstdefinestyle{matlab}{%
  language=Matlab,%
  basicstyle=\footnotesize\ttfamily,%
  breaklines=true,%
  morekeywords={matlab2tikz},%
  keywordstyle=\color{blue},%
  morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},%
  identifierstyle=\color{black},%
  stringstyle=\color{codelilas},%
  commentstyle=\color{codegreen},%
  showstringspaces=false,%
    %   Without this there will be a symbol in
    %   the places where there is a space
  numbers=left,%
  numberstyle={\tiny \color{black}},%
    %   Size of the numbers
  numbersep=9pt,%
    %   Defines how far the numbers are from the text
  emph=[1]{for,end,break,switch,case},emphstyle=[1]\color{red},%
    %   Some words to emphasise
}

\newcommand{\matlabcode}[1]{%
    \lstset{style=matlab}%
    \lstinputlisting{#1}
}
    %   For including Matlab code from .m file with colors,
    %   line numbering, etc.

%% Bibliographies %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\usepackage{natbib}
    %---For bibliographies
%\setlength{\bibsep}{3pt} % Set how far apart bibentries are

%% Misc %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{enumitem}
    %   Has to do with enumeration
\usepackage{appendix}
%\usepackage{natbib}
    %   For bibliographies
\usepackage{pdfpages}
    %   For including whole pdf pages as a page in doc


%% User Defined %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newcommand{\nameofcmd}{Text to display}
\newcommand*{\Chi}{\mbox{\large$\chi$}} %big chi
    %   Bigger Chi

% In math mode, Use this instead of \munderbar, since that changes the
% font from math to regular
\makeatletter
\def\munderbar#1{\underline{\sbox\tw@{$#1$}\dp\tw@\z@\box\tw@}}
\makeatother

% Limits
\newcommand{\limN}{\lim_{N\rightarrow\infty}}
\newcommand{\limn}{\lim_{n\rightarrow\infty}}
\newcommand{\limt}{\lim_{t\rightarrow\infty}}
\newcommand{\limT}{\lim_{T\rightarrow\infty}}
\newcommand{\limhz}{\lim_{h\rightarrow 0}}

% Misc Math
\newcommand{\Prb}{\mathrm{P}}
\newcommand{\ra}{\rightarrow}
\newcommand{\diag}{\text{diag}}
\newcommand{\ch}{\text{ch}}
\newcommand{\dom}{\text{dom}}

% Script
\newcommand{\sF}{\mathscr{F}}
\newcommand{\sB}{\mathscr{B}}
\newcommand{\sL}{\mathscr{L}}
\newcommand{\sM}{\mathscr{M}}
\newcommand{\sT}{\mathscr{T}}
\newcommand{\sA}{\mathscr{A}}

% Mathcal
\newcommand{\calB}{\mathcal{B}}
\newcommand{\calD}{\mathcal{D}}
\newcommand{\calF}{\mathcal{F}}
\newcommand{\calG}{\mathcal{G}}
\newcommand{\calH}{\mathcal{H}}
\newcommand{\calC}{\mathcal{C}}

% Dot over
\newcommand{\dx}{\dot{x}}
\newcommand{\ddx}{\ddot{x}}
\newcommand{\dy}{\dot{y}}
\newcommand{\ddy}{\ddot{y}}

% Derivatives
\newcommand{\dydx}{\frac{dy}{dx}}
\newcommand{\pypx}{\frac{\partial y}{\partial x}}

% Blackboard
\newcommand{\R}{\mathbb{R}}
\newcommand{\Rn}{\mathbb{R}^n}
\newcommand{\Rk}{\mathbb{R}^n}
\newcommand{\Rnn}{\mathbb{R}^{n\times n}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\Cn}{\mathbb{C}^n}
\newcommand{\Cnn}{\mathbb{C}^{n\times n}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\N}{\mathbb{N}}

\DeclareMathOperator*{\argmin}{arg\;min}
\DeclareMathOperator*{\argmax}{arg\;max}
\newenvironment{rcases}
  {\left.\begin{aligned}}
  {\end{aligned}\right\rbrace}

% Various probability and statistics commands
\newcommand{\Cov}{\operatorname{Cov}}
\newcommand{\Corr}{\operatorname{Corr}}
\newcommand{\Var}{\operatorname{Var}}
\newcommand{\asto}{\xrightarrow{a.s.}}
\newcommand{\pto}{\xrightarrow{p}}
\newcommand{\msto}{\xrightarrow{m.s.}}
\newcommand{\dto}{\xrightarrow{d}}
\newcommand{\Lpto}{\xrightarrow{L_p}}
\newcommand{\plim}{\text{plim}_{n\rightarrow\infty}}

% Redefine real and imaginary from fraktur to plain text
\renewcommand{\Re}{\operatorname{Re}}
\renewcommand{\Im}{\operatorname{Im}}

% Shorter sums: ``Sum from X to Y''
% - sumXY  is equivalent to \sum^Y_{X=1}
% - sumXYz is equivalent to \sum^Y_{X=0}
\newcommand{\sumnN}{\sum^N_{n=1}}
\newcommand{\sumin}{\sum^n_{i=1}}
\newcommand{\sumkn}{\sum^n_{k=1}}
\newcommand{\sumtT}{\sum^T_{t=1}}
\newcommand{\sumninf}{\sum^\infty_{n=1}}
\newcommand{\sumtinf}{\sum^\infty_{t=1}}
\newcommand{\sumnNz}{\sum^N_{n=0}}
\newcommand{\suminz}{\sum^n_{i=0}}
\newcommand{\sumknz}{\sum^n_{k=0}}
\newcommand{\sumtTz}{\sum^T_{t=0}}
\newcommand{\sumninfz}{\sum^\infty_{n=0}}
\newcommand{\sumtinfz}{\sum^\infty_{t=0}}

\newcommand{\tinf}{^\infty_{t=1}}
\newcommand{\tinfz}{^\infty_{t=0}}

% Shorter integrals: ``Integral from X to Y''
% - intXY is equivalent to \int^Y_X
\newcommand{\intab}{\int_a^b}
\newcommand{\intzN}{\int_0^N}
\newcommand{\intzo}{\int_0^1}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% BODY %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{document}
\maketitle

\tableofcontents

\clearpage

\section{Building Blocks}

\subsection{Utility Functions}


\subsection{Risk Aversion and Important Elasticities}

\begin{defn}(Absolute Risk Aversion)
Given twice-differentiable utility function $u$,
\emph{absolute risk aversion} is defined
\begin{align*}
  A(c) = -\frac{u''(c)}{u'(c)}
\end{align*}
\end{defn}

\begin{defn}(Relative Risk Aversion)
Given twice-differentiable utility function $u$,
\emph{relative risk aversion} is defined
\begin{align*}
  R(c) = cA(c) = -\frac{c u''(c)}{u'(c)}
\end{align*}
\end{defn}

\begin{defn}(Intertemporal Elasticity of Substitution)
Given differentiable utility function $u$,
the \emph{intertemporal elasticity of substitution} is defined
\begin{align*}
  \text{IES}
  = -\frac{\partial \ln(c_{t+1}/c_t)}{\partial r}
  = -\frac{\partial \ln(c_{t+1}/c_t)}{%
    \partial \ln(u'(c_{t+1})/u'(c_t))}
\end{align*}
The IES answers the question ``How much to I change the (log-normalized)
slope of my consumption profile $\{c_t,c_{t+1}\}$---i.e.\ my consumption
growth---in response to a change in the interest rate?''
High IES means that the the consumer will change her consumption
dramatically given small changes in the interest rate---high elasticity,
comfortable substituting across time.
Low IES corresponds to a strong smoothing motive. The consumer is
\emph{not} very responsive to changes in the interest rate, so the
consumption profile over time will be flatter.
\end{defn}
\begin{rmk}
Why are these two IES equations equivalent?
It comes from the savings problem solved by a utility maximizing
household. Consider the two-period case for simplicity (though it also
holds in the infinite horizon problem with separable period utility):
\begin{align*}
  \max_{a_t} \; &
  u\big(
  \underbrace{y_t-a_t}_{c_t}
  \big)
  + \beta
  u\big(
  \underbrace{y_{t+1}+Ra_t}_{c_{t+1}}
  \big)
\end{align*}
where $y_t$ is exogenously given income at time $t$ and $a_t$ is the amount
of assets bought at time $t$, which mature at time $t+1$ and have gross
return $R$. It has first order condition
\begin{align*}
  %u'(c_t) = \beta R u'(c_{t+1})
  %\quad\iff\quad
  R = \frac{u'(c_t)}{\beta u'(c_{t+1})}
  \quad\iff\quad
  r &= -\ln \left(\frac{u'(c_{t+1})}{u'(c_t)}\right) -\ln\beta
\end{align*}
where $r=\ln R$. Now this equation must always hold for any consumption
savings problem with time-separable utility. Moreover, $\beta$ is just a
fixed parameter; it does not change. Therefore, if we change $r$, the
agent must change his consumption profile $\{c_t,c_{t+1}\}$ to change
the log-ratio of marginal utilities $\ln\big(u'(c_{t+1})/u'(c_t)\big)$
so that this equation is true. Hence,
$\partial r = \partial \ln(u'(c_{t+1})/u'(c_t))$, which is why the two
IES expressions are equivalent.
\end{rmk}

\begin{defn}(Frisch Elasticity of Labor Supply)

\end{defn}



\clearpage
\subsection{Power or CRRA Utility}

\begin{defn}(Power Utility or CRRA)
We define the period power utility function as
\begin{align*}
  u(c) &= \frac{c^{1-\sigma}-1}{1-\sigma}
  \qquad \sigma\geq 0
  \\
  u'(c) &= c^{-\sigma} \\
  u''(c) &= -\sigma c^{-\sigma-1}
\end{align*}
where $\sigma\geq 0$ controls the curvature of the utility function.
For $\sigma=0$, utility is linear.
It also has the feature that
\begin{align*}
  \lim_{\sigma\ra 1}
  \frac{c^{1-\sigma}-1}{1-\sigma}
  &= \ln(c)
\end{align*}
which is why we have $-1$ in the numerator (so we can apply L'Hospital),
though it's just a constant that doesn't really affect $u$.
\\
\\
It exhibits constant relative risk aversion
\begin{align*}
  R(c) &=
  -\frac{c u''(c)}{u'(c)}
  = -\frac{c (-\sigma c^{-\sigma-1})}{c^{-\sigma}}
  = \sigma
\end{align*}
The IES is also tied to the coefficient of relative risk aversion, as
$\sigma$ is the inverse IES:
\begin{align*}
  IES
  = \frac{1}{\sigma}
\end{align*}
So if $\sigma$ is large, the IES is very low: the agent does not like
variable consumption. For small $\sigma$, the agent cares less about
variability in consumption, is willing to substitute across time, and
exhibits a large intertemporal elasticity of substitution.
\end{defn}

\begin{prop}
The Power Utility Function characterizes the class of all utility
functions with Constant Relative Risk Aversion.
\end{prop}
\begin{proof}
To have constant relative risk aversion, we need
\begin{align*}
  -\frac{cu''(c)}{u'(c)} = k
  \quad\iff\quad
  cu''(c) + ku'(c) = 0
\end{align*}
for some constant $k$. We want to solve for $u$ that satisfies this. To
do so, define $v(c)=u'(c)$, substitute, and solve:
\begin{align*}
  v'(c) + \frac{k}{c}v(c) &= 0
\end{align*}
We will use an integrating factor
\begin{align*}
  e^{\int \frac{k}{c} \; dc}=e^{k\ln c} = (e^{\ln c})k = c^k
\end{align*}
Therefore, multiply through and solve
\begin{align*}
  c^k v'(c) + kc^{k-1}v(c) &= 0 \\
  \left(c^k v(c)\right)' &= 0 \\
  c^k v(c) &= 1 \\
  \implies \quad v(c) = u'(c) &= c^{-k} \\
  \implies \quad u(c) &= c^{1-k}
\end{align*}
where I left out constants in lots of spots because scaling by a
constant or adding constants doesn't matter for utility. But otherwise,
you see that this is exactly the form of power utility where $k=\sigma$.
\end{proof}

\begin{prop}
Given a balanced growth path for consumption such that
$c_{t+1} = (1+g) c_{t}$,
Power Utility is the only functional form where the ratio of marginal
utilty between periods satisfies
\begin{align*}
  \frac{u'(c_t)}{u'((1+g)c_t)} = k
\end{align*}
for some constant $k$ and all $t$.
\end{prop}
\begin{rmk}
This is often super useful, because some balanced growth path results
require that the ratio of marginal utility between periods is constant.
This tells us that we have to use this form of utility.
\end{rmk}
\begin{proof}
We want to prove that Power Utility is the \emph{only} functional form
of utility displaying this property. Start with what we need to hold:
\begin{align}
  \frac{u'(c)}{u'((1+g)c)} = k
  \quad\iff\quad
  u'(c) = ku'((1+g)c)
  \label{kexp}
\end{align}
Differentiate both sides:
\begin{align*}
  u''(c) &= ku''((1+g)c)(1+g)
\end{align*}
Sub in the expression for $k$ from Equation~\ref{kexp}:
\begin{align*}
  u''(c) &=
  \frac{u'(c)}{u'((1+g)c)} u''((1+g)c)(1+g) \\
  \iff \qquad
  \frac{u''(c)}{u'(c)} &=
  \frac{u''((1+g)c)(1+g)}{u'((1+g)c)}
\end{align*}
Mulitply through by $-c$
\begin{align*}
  -\frac{u''(c)c}{u'(c)} &=
  -\frac{u''((1+g)c)(1+g)c}{u'((1+g)c)}
\end{align*}
But each ratio is relative risk aversion at either $c_t$ or $c_{t+1}$.
So this says that relative risk aversion for all $t=1,2,\ldots$ even
though consumption $c_t$ is growing at rate of $g$. In other words,
relative risk aversion is constant no matter the level of $c_t$. But
power utility is the only class of utility functions satisfying this
property.
\end{proof}

\clearpage
\subsection{Static Resource Allocation Problems}


\clearpage
\subsection{Static Model with Variety, Fixed $N$}

\subsubsection{Preferences, Technology, Endowments}

We define the usual trifecta of primitives for a macro problem:
\begin{enumerate}
  \item \emph{Preferences}:
    Given mass of goods $N$ and the preference parameter $\rho\in(0,1)$,
    define utility of consumption of a continuum of goods, captured by
    function $c:[0,N]\ra \R$, as
    \begin{align*}
      U(c) &=
      u\left(
      \left[
      \int_0^N c(i)^\rho \; di
      \right]^{1/\rho}
      \right)
    \end{align*}
    where $c(i)$ is consumption of the $i$th good and $u$ is some
    standard utility function and $u$ is some standard utility function
    defined for one good. In this way, big $U$ aggregates the utility of
    consuming $c(i)$ units of each $i$th good.  The above has limiting
    cases
    \begin{itemize}
      \item $\rho\ra 0$: Cobb-Douglas
      \item $\rho\ra 1$: Perfect substitutes
    \end{itemize}

  \item \emph{Technology}:
    There is a variety of goods to consume, each of which is produced by
    a different firm, so we need to define the production function for
    each firm:
    \begin{align*}
      y(i) = A h(i)
    \end{align*}
    where $y(i)$ is output of the $i$th good from the $i$th firm and
    $h(i)$ is labor used to produce it. All of the firms have identical
    technology in the sense that the same amount of labor produces the
    same output of output for any good. We ignore capital for now.

  \item \emph{Endowments}: Each household has one unit of labor to
    supply to the firms.
\end{enumerate}

\clearpage
\subsubsection{Social Planner's Problem}

We have Social Planner's problem
\begin{align*}
  \max_{c(i), h(i)\geq 0}
    & \; u\left(
      \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho}
    \right)\\
  \text{s.t} & \;
  \intzN h(i) \; di = 1
  \qquad\qquad
  \text{(Labor Market Clearing)} \\
  &\; c(i) = y(i) = Ah(i)
  \qquad
  \text{(Goods Market Clearing)}
\end{align*}
Use Goods Market Clearing to eliminate $c(i)$ from the problem:
\begin{align*}
  \max_{h(i)\geq 0}
    & \; u\left(
    \left[ \int_0^N (Ah(i))^\rho \; di \right]^{1/\rho}
    \right)\\
  \text{s.t} & \;
  \intzN h(i) \; di = 1
\end{align*}
Differentiate with respect to $h(i)$ and this gives FOC:
\begin{align*}
  u'\left( \left[ \int_0^N (Ah(i))^\rho \; di \right]^{1/\rho} \right)
  \cdot
  \frac{1}{\rho}\left[ \int_0^N (Ah(i))^\rho \; di \right]^{1/\rho-1}
  \cdot
  \rho A^\rho h(i)^{\rho-1}
  = \lambda
\end{align*}
Dividing the FOC for good $i$ by the FOC for good $j$, we get
\begin{align*}
  \left(
  \frac{h(i)}{h(j)}
  \right)^{\rho-1}
  = 1
  \quad&\implies\quad
  h(i) = h(j)
  \qquad \forall i,j \in[0,N] \\
  &\implies\quad
  h(i) = \frac{1}{N}
\end{align*}
Hence, in equilibrium, labor is split up equally among the firms:
$h^*(i)=\frac{1}{N}$. As a result of goods market clearing, consumption
will be split evenly as well and will equal
\begin{align*}
  c^*(i) = \frac{A}{N}
\end{align*}
This will leady to totaly utility at the optimum of
\begin{align*}
  u\left( \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho} \right)
  =
  u\left( \left[ \int_0^N
      \left[ \frac{A}{N} \right]^\rho \; di
    \right]^{1/\rho} \right)
  =
  u\left( A N^{\frac{1}{\rho}-1}\right)
\end{align*}
Hence, since $\rho\in(0,1)$, utility is \emph{increasing} in $N$.
There's a love of variety in the model
because marginal utility at $c(i)=0$ is infinite for any $i$.

\clearpage
\subsubsection{Arrow-Debreu Competetive Equilibrium}

We now characterize an ADCE in an economy with variety, which will be a list
$c^*(i)$ consumption of each good, $h^*$ total labor supply, $h^*(i)$
labor supply to each firm, and $p^*(i)$ price of each good
satisfying the conditions below.

We leave out wages which are normalized to one. We could do this because
equilibrium wages at each firm must be identical, otherwise each agent
would just work for the highest paying firm. They get no utility from
working for a \emph{particular} firm (just the cash money they get to
buy consumption goods); therefore, they would all just work for the one
paying the highest wages. For each firm in fact to produce in
equilibrium, wages must necessarily be equal, so we can just normalize
wages to one and put prices $p(i)$ in terms of wages. Therefore, $h$
units of labor gets a worker $h$ units of purchasing power to buy
consumption at prices $p(i)$ for $i\in[0,N]$.
\begin{enumerate}
  \item \emph{Household Optimization}: Taking prices $p^*(i)$ as given,
    consumption $c^*(i)$, and total labor supply $h^*$ solve
    \begin{align*}
      \max_{c(i), h}
        & \; u\left(
          \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho}
        \right)\\
      \text{s.t} & \;
        \intzN p^*(i) c(i) \; di= h \\
      &\; h\in[0,1]
      \qquad c(i) \geq 0
    \end{align*}
    Again, the household is not optimizing over $h(i)$, just total labor
    $h$. They don't care \emph{which} firm they work for. They just care
    amount the total level of labor $h$ they supply since that's how
    they earn money to buy the consumption that they \emph{do} care
    about.

  \item \emph{Firm Optimization}: With each firm taking prices $p^*(i)$
    as given, $h^*(i)$ solves the profit maximization problem:
    \begin{align*}
      h^*(i)
      &=
      \max_{h(i)\geq 0}
      p^*(i) Ah(i) - h(i)
    \end{align*}
    For now, we stick with this competetive-equilibrium price-taking
    assumption. The firms are not exploiting the consumer's desire for
    variety as they will in the next two subsections where the firms are
    monopolistic.

  \item \emph{Market Clearing}: All of the labor provided to the
    different firms must aggregate to the total amount $h$ of labor
    provided, and everything produced must be consumed:
    \begin{align*}
       h^* &= \intzN h^*(i) \; di \\
       c^*(i) &= Ah^*(i)
    \end{align*}
\end{enumerate}
\clearpage
We do the usual things
\begin{enumerate}
  \item \emph{Household FOCs}: First with respect to consumption of the
    $i$th good $c(i)$:
    \begin{align*}
      u'\left(
        \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho}
      \right)
      \frac{1}{\rho}
      \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho-1}
      \rho c(i)^{\rho-1}
      = \lambda p^*(i)
    \end{align*}
    Dividing the FOC for $c(i)$ by the FOC for $c(j)$:
    \begin{align}
      \left(
      \frac{c(i)}{c(j)}
      \right)^{\rho-1}
      =
      \frac{p^*(i)}{p^*(j)}
      \label{hhfoc-variety}
    \end{align}

  \item \emph{Firm}: It must be the case that profits are zero,
    otherwise the firm would just make infinite profits. Therefore, we
    need
    \begin{align*}
      p^*(i) = \frac{1}{A}
      \qquad \forall i
    \end{align*}

  \item \emph{Market Clearing}: Since prices are all the same at
    $\frac{1}{A}$, Equation~\ref{hhfoc-variety} tells us that
    consumption of all goods must be equal since the prices are equal.
    Therefore, by market clearing, labor must be distributed equally
    among the firms, i.e. $h(i) = \frac{1}{N}$.
\end{enumerate}
Note that the firms are price takers in this market. They're not really
exploiting consumer's desire for variety to make more cash money.  And
since they're just price takers (so that there are no distortions in
this market), the outcome is exactly the same as the Social Planner's
problem---consumption and labor is divided equally among all firms. But
that's not very interesting. We want to see what happens when firms are
price-\emph{setters}, not price-takers.

So in the next two subsections, we dispense with the ``firms as price
takers'' assumption to define the \emph{monopolistic} competetive
equilibrium. First, in the next subsection, we derive the demand
function. Then, in the second next subsection, we define the
monopolistic competetive equilibrium.

\clearpage
\subsubsection{Monopolistic Price Setting and Demand}

Before defining a monopolistic competetive equilibrium, we need to
figure out optimal price setting (or equivalently, the optimal
production decision) chosen by the firm. This is done in steps:
\begin{enumerate}
  \item First, firm $i$ puts itself in the shoes of the consumer,
    solving the consumer's problem to get demand function $c(i)$ in
    terms of income $I$ and price $p(i)$, both of which the consumer
    takes as given when deciding its consumption allocation.

    So again, the consumer makes a consumption decision $c(i)$ given
    prices $p(i)$ and income/wealth $I$, i.e.\ she solves the household
    utility maximization problem
    \begin{align*}
      \max_{c(i) \geq 0}
        & \; u\left(
          \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho}
        \right)\\
      \text{s.t} & \;
        \intzN p(i) c(i) \; di \leq I
    \end{align*}
    The first order condition for $c(i)$ gives
    \begin{align*}
      u'\left(
        \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho}
      \right)
      \frac{1}{\rho}
      \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho-1}
      \rho c(i)^{\rho-1}
      = \lambda p(i)
    \end{align*}
    Dividing the FOC for $c(i)$ by the FOC for $c(j)$:
    \begin{align}
      \left(
      \frac{c(i)}{c(j)}
      \right)^{\rho-1}
      =
      \frac{p(i)}{p(j)}
      &\quad \iff \quad
      c(i)
      =
      c(j)
      \left(
      \frac{p(i)}{p(j)}
      \right)^{\frac{1}{\rho-1}}
      \label{cidemand}
    \end{align}
    Equation~\ref{cidemand} summarizes demand for the $i$th good (for
    any $i\in[0,N]$) as a function of both demand for some fixed
    reference good $j$ and the price ratio between $i$ and $j$.

    Since utility is increasing in consumption, Walras' Law tells us that
    the buget constraint will hold with equality, so we can substitute the
    above expression for $c(i)$ into the budget equation and simplify:
    \begin{align*}
      I &= \intzN p(i) c(i) \; di
      = \intzN p(i)
        c(j)
        \left(
        \frac{p(i)}{p(j)}
        \right)^{\frac{1}{\rho-1}} \notag
        \; di
      %\\
      %&=
        %\frac{c(j)}{p(j)^{\frac{1}{\rho-1}}}
        %\intzN p(i)
        %p(i)^{\frac{1}{\rho-1}} \notag
        %\; di \\
      %\implies\quad
      %I
      %&=
      =
        \frac{c(j)}{p(j)^{\frac{1}{\rho-1}}}
        \intzN
        p(i)^{\frac{\rho}{\rho-1}} \notag
        \; di
    \end{align*}
    Therefore, we can summarize demand for good $j$ as
    \begin{align*}
      c(j)
      =
      p(j)^{\frac{1}{\rho-1}}
      \cdot
      \frac{I}{\intzN p(i)^{\frac{\rho}{\rho-1}} \notag \; di}
    \end{align*}
    And since our choice of reference good was arbitrary, this holds for any
    $j$. Notice that this is extremely tractable since the fraction is a
    constant from the perspective of firm $j$. So we have demand for good
    $j$ written quite simply as
    \begin{align*}
      c(j) = B \cdot p(j)^{\frac{1}{\rho-1}}
      \qquad\text{where} \quad B=
      \frac{I}{\intzN p(i)^{\frac{\rho}{\rho-1}} \notag \; di}
    \end{align*}

  \item Next, firm $i$ uses the demand function $c(i)$ and market
    clearing in the output market to choose $p(i)$ that maximizes
    profits.

    So we return to the firm's problem. Taking wages (normalized to one)
    as given, its profit maximizing decision involves setting prices,
    choosing output, and choosing labor to hire
    \begin{align*}
      \max_{p(i), \,h(i), \,y(i)} \; &p(i) y(i) - h(i)
    \end{align*}
    But by market clearing $c(i)=y(i)$, technology $y(i)=Ah(i)$, and
    demand $c(i)=B \cdot p(i)^{\frac{1}{\rho-1}}$ from above, the
    maximization problem reduces to
    \begin{align*}
      \max_{p(i)} \; &p(i) c(i) - \frac{c(i)}{A} \\
      \max_{p(i)}
      \; &p(i) \left[B p(i)^{\frac{1}{\rho-1}}\right]
        - \frac{1}{A} \left[B p(i)^{\frac{1}{\rho-1}}\right] \\
      \max_{p(i)}
      \; & B p(i)^{\frac{\rho}{\rho-1}}
        - \frac{B}{A} \left[p(i)^{\frac{1}{\rho-1}}\right]
    \end{align*}
    Differentiating with respect to $p(i)$, this leads to FOC
    \begin{align*}
      0&=
      B {\frac{\rho}{\rho-1}} p(i)^{\frac{1}{\rho-1}}
        - \frac{B}{A} \frac{1}{\rho-1}p(i)^{\frac{1}{\rho-1}-1} \\
      \Rightarrow\quad
      p(i) &= \frac{1}{\rho A}
    \end{align*}
    Note that this has a very nice form, as $\frac{1}{A}$ is the
    marginal cost of production, while $\frac{1}{\rho}$ is refers to how
    willing households are to substitute across varieties.


  \item Prices $p(i)$ directly map to a production/consumption amount
    $c(i)$ in equilibrium.

    Recall demand:
    \begin{align*}
      c(i)
      &= B\cdot p(i)^{\frac{1}{\rho-1}}
      = B\cdot \left(\frac{1}{\rho A}\right)^{\frac{1}{\rho-1}}
    \end{align*}
    where we have
    \begin{align*}
      B
      = \frac{I}{\intzN p(i)^{\frac{\rho}{\rho-1}}di}
      =
      \frac{I}{\intzN \left(\frac{1}{\rho A}\right)^{\frac{\rho}{\rho-1}}di}
      =
      \frac{I}{N\left(\frac{1}{\rho A}\right)^{\frac{\rho}{\rho-1}}}
    \end{align*}
    Substiting this expression for $B$ back into the expression for
    $c(i)$, we get
    \begin{align*}
      c(i)
      &= \left(\frac{1}{\rho A}\right)^{\frac{1}{\rho-1}}
      \left(
      \frac{I}{N\left(\frac{1}{\rho A}\right)^{\frac{\rho}{\rho-1}}}
      \right) \\
      \implies\quad
      c(i)
      &= \frac{I\rho A}{N}
    \end{align*}
\end{enumerate}


\clearpage
\subsubsection{Monopolistic Competitive Equilibrium}

We now characterize an MCE (monopolistic competitive equilibrium) in an
economy with variety, which a list $c^*(i)$ consumption of
each good, $h^*$ total labor supply, $h^*(i)$ labor supply to each firm,
$d^*_i(p)$ demand for good $i$ given price $p$ (holding all other prices
and profits constant), $p^*(i)$ prices for each good (wages left out
because normalized to one), and $\pi^*(i)$ profits that satisfy the
following conditions:
\begin{enumerate}
  \item \emph{Household Optimization}: Taking prices $p^*(i)$ and
    profits $\pi^*(i)$ as given, consumption $c^*(i)$, and total labor
    supply $h^*$ solve
    \begin{align*}
      (c^*(i), h^*)
      = \max_{c(i), h}
        & \; u\left(
          \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho}
        \right)\\
      \text{s.t} & \;
        \intzN p^*(i) c(i) \; di \leq h
          + \intzN \pi^*(i) \; di \\
      &\; h\in[0,1]
      \qquad c(i) \geq 0
    \end{align*}
    while also $d^*_i(p)$ is the optimal choice for good $i$ as a
    function of price, holding all other prices and profits constant.

  \item \emph{Firm Optimization}: With each firm taking \emph{demand}
    (not prices this time) $d_i^*(p)$ as given, $p^*(i)$ and $h^*(i)$
    solve the profit maximization problem:
    \begin{align*}
      \max_{p(i),h(i)}
      &\;
      p(i) Ah(i) - h(i) \\
      \text{s.t.} \;
      & \; Ah(i) = d_i^*[p(i)] \\
      & \; h(i) \geq 0\\
      & \; \pi^*(i) = p^*(i) Ah^*(i) - h^*(i)
    \end{align*}

  \item \emph{Market Clearing}: All of the labor provided to the
    different firms must aggregate to the amount of total labor
    provided, and everything produced must be consumed:
    \begin{align*}
       h^* &= \intzN h^*(i) \; di \\
       c^*(i) &= Ah^*(i)
    \end{align*}
\end{enumerate}


\clearpage
\subsection{Static Model with Variety, Endogenous $N$}

As we saw in the fixed $N$ subsection, households love variety, so $N$
is substantive. But so far, we've just taken it as given. Where does it
come from? Since it is important, we probably want to endogenize it.
But notice that since consumers love variety, the social planner would
just send $N\ra \infty$ if $N$ were a totally free variable. Therefore,
we want to introduce costs to producing/supporting more variety to make
sure this problem is well-defined.

\subsubsection{Preferences, Technology, Endowments}

Things look similar to the case of fixed $N$, except $N$ is now chosen
in equilibrium and labor has two uses: (1) setting $N$, the mass of
varieties and (2) producing output of the varieties. Therefore, the only
part that really changes is the technology portion:
\begin{enumerate}
  \item \emph{Preferences}:
    As before, given preference parameter $\rho\in(0,1)$, we define
    utility of consumption of a continuum of goods as
    \begin{align*}
      U(c) &=
      u\left(
      \left[
      \int_0^N c(i)^\rho \; di
      \right]^{1/\rho}
      \right)
    \end{align*}

  \item \emph{Technology}:
    $N$ represents the mass of varieties of goods that can be consumed.
    We let $\bar{h}$ represent the labor cost of producing/supporting
    one unit of variety, so that supporting a mass of $N$ units of
    variety costs a total of $N\bar{h}$ units of labor supplied by the
    household.

    Firms then employ the remaining $1-N\bar{h}$ units of labor to
    produce each of the existing varieties in $[0,N]$. Each variety is
    produced by a different firm according to production function
    \begin{align*}
      y(i) = A h(i)
    \end{align*}
    where $y(i)$ is output of the $i$th good from firm $i$ and $h(i)$ is
    labor used to produce it.

    Just a quick word about the choice of $N$.
    In the case of the social planner, it is chosen by making the
    optimal tradeoff between
    \begin{enumerate}
      \item Expanding the mass of varieties to $[0,N]$ at cost
        $N\bar{h}$
      \item Production (which becomes consumption) of those varieties in
        $[0,N]$ with the remaining $1-N\bar{h}$ units of labor
    \end{enumerate}
    On the other hand, in a symmetric MCE, $N$ is determined by by
    entry. It costs $\bar{h}$ per unit of variety, which is paid for by
    the firms' profits. Since monopolistically competetive profits are
    zero, they can cover and exactly balance out the costs of entry.

  \item \emph{Endowments}: Each household has one unit of labor to
    supply to the firms.
\end{enumerate}

\clearpage
\subsubsection{Social Planner's Problem}

The social planner maximizes utility by choosing $c(i)$, $h(i)$, and
$N$:
\begin{align*}
  \max_{c(i),h(i),N\geq 0}
    & \; u\left(
      \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho}
    \right)
  \\
  \text{s.t.} & \;
  \intzN h(i) \; di = 1 - N\bar{h}
  \qquad
  \text{(Labor Market Clearing)} \\
  &\; c(i) = Ah(i)
  \qquad\qquad\qquad
  \text{(Goods Market Clearing)}
\end{align*}
where ``Labor Market Clearing'' says that  $\intzN h(i)\; di$---the
total amount of labor used in producing $y(i)$ for $i\in[0,N]$---must
equal $1-N\bar{h}$---the total labor left over for production after
spending $N\bar{h}$ units of labor on producing exactly that mass $N$ of
variety in the first place.
\\
\\
Start by eliminating $c(i)$ from the problem
\begin{align*}
  \max_{h(i),N}
    & \; u\left(
      \left[ \int_0^N \left(Ah(i)\right)^\rho \; di \right]^{1/\rho}
    \right)
  \\
  \text{s.t} & \;
  \intzN h(i) \; di = 1 - N\bar{h}
\end{align*}
Notice that the labor supply problem hasn't really changed relative to
the fixed $N$ case. If we get the FOCs with respect to $h(i)$, it will
still be the case that the household should allocate labor evenly among
the firms to consume evenly across varieties. Only now, there are only
$1-N\bar{h}$ units of labor to allocate towards producing the varieties
(by the labor market clearing constraint) so that
$h(i)=\frac{1-N\bar{h}}{N}$. Hence, we can sub in to simplify
\begin{align*}
  \max_{N\geq 0}
    & \; u\left(
      \left[ \int_0^N
      \left(A\left(\frac{1-N\bar{h}}{N}\right)\right)^\rho \; di
    \right]^{1/\rho}
    \right) \\
  \Leftrightarrow\quad
  \max_{N\geq 0}
    & \; u\left(
      A(1-N\bar{h})
      N^{\frac{1}{\rho}-1}
    \right)
\end{align*}
But since $u$ is an increasing function, we can just maximize
\begin{align*}
  \max_{N\geq 0}
    & \;
      A(1-N\bar{h})
      N^{\frac{1}{\rho}-1}
\end{align*}
which has FOCs
\begin{align*}
  A\bar{h} N^{\frac{1}{\rho}-1}
  &=
  \left(\frac{1}{\rho}-1\right)
  A(1-N\bar{h}) N^{\frac{1}{\rho}-2} \\
  \Rightarrow\quad
  N &= \frac{1-\rho}{\bar{h}}
\end{align*}
So as $\rho\ra 1$ and the consumer views the goods more as perfect
substitutes, the social planner opts for fewer firms (and vice versa).
Moreover, as the cost $\bar{h}$ of creating new firms decreases, the
social planner opts for more firms.


\clearpage
\subsubsection{Symmetric MCE with Entry}

The goal here is to take everything the same, but let $N$ be endogenous.
We know what the equilibrium looks like for fixed $N$. It will just be a
matter of letting $N$ be a free parameter that adjusts until profits
from entry are zero.

So we now characterize a symmetric MCE in an economy with entry, which a
list
$c^*(i)$ consumption of each good,
$h^*$ total labor supply,
$h^{f*}$ labor for each producing firm,
%$h^*(i)$ labor supply to each firm,
$d^*(p)$ demand for each good $i$ given price $p$ (holding all other
prices and profits constant),
$p^*$ price for each good,
and $N^*>0$ mass of firms that satisfy the following conditions:
\begin{enumerate}
  \item \emph{Household Optimization}: Taking prices $p^*$ as given,
    consumption $c^*(i)$ and total labor supply $h^*$ solve
    \begin{align*}
      \max_{c(i), h}
        & \; u\left(
          \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho}
        \right)\\
      \text{s.t} & \;\;
         p^*\intzN c(i) \; di \leq h \\
      &\; h\in[0,1]
      \qquad c(i) \geq 0
    \end{align*}
    while also $d^*(p)$ is the optimal choice each good as a function of
    price, holding all other prices and profits constant.

  \item \emph{Firm Optimization}: With each firm taking \emph{demand}
    (again, not prices this time) $d^*(p)$ as given, $p^*$ and
    $h^{f*}$ solve the profit maximization problem:
    \begin{align*}
      \max_{p,h(i)} &\;\
      p\cdot Ah^f - h^f \\
      \text{s.t.} \;
      & \; Ah^f = d^*[p] \\
      & \; h^f \geq 0
    \end{align*}
    and, the free entry condition, which states that profits from entry
    equal fixed costs of entry:
    \begin{align*}
      p^*\cdot Ah^{f*} - h^{f*} = \bar{h}
    \end{align*}

  \item \emph{Market Clearing}: All of the labor employed by the
    different firms in production of output and production of variety
    must equal the total labor supply:
    \begin{align*}
        N^*(h^{*f}+\bar{h}) &= h^*
    \end{align*}
    and and everything produced must be consumed
    \begin{align*}
        c^*(i) &= Ah^{*f} \qquad \forall i
    \end{align*}
\end{enumerate}
To solve, we can use previous results. In particular, we know that labor
will be provided evenly to all producing firms, i.e.
$h^{f*}=\frac{1-N^*\bar{h}}{N^*}$ for each producing firm, where $N^*$
is the equilibrium value that we want to solve for. We also know that
prices will be $p^*=\frac{1}{\rho}\cdot\frac{1}{A}$ for each of the
goods produced. So plug these things into the zero-profit free entry
condition to compute $N^*$:
\begin{align*}
  p^*\cdot Ah^{f*} - h^{f*} &= \bar{h} \\
  \left(\frac{1}{\rho}\cdot\frac{1}{A}\right)\cdot
  \left[A \left(\frac{1-N^*\bar{h}}{N^*}\right)\right]
  - \left(\frac{1-N^*\bar{h}}{N^*}\right)
  &= \bar{h}
\end{align*}
This implies that
\begin{align*}
  N^* &= \frac{1-\rho}{\bar{h}}
\end{align*}

\clearpage
\section{Neoclassical, Ramsey, or Cass-Koopmans Model}


\subsection{The Economy}

Single representative firm with CRS technology and a single
representative household.
%There is a single representative household and a single
%firm with CRS production. At time $t$, the single household has
%mass/size of members $L_t$ which grow at gross rate $G_p>1$ every period
%so $L_{t+1}=G_pL_t$.
%The household is completely altruistic to its future members.
%We will use capital letters to denote aggregates, lower-case letters to
%denote per-capita quantities.
\begin{enumerate}
  \item \emph{Preferences}:
    Basic tradeoffs for household are (1) consumption today versus
    tomorrow, (2) consumption today versus leisure.
    Encode this in a household-wide utility function
    \begin{align*}
      \sumtinfz \beta^tNu(C_t,1-N_t)
      \qquad\beta\in(0,1)
    \end{align*}
    $u$ is continuously twice differentiable with $u_1,u_2>0$ and
    $u_{11},u_{22}<0$ (strictly increasing, strictly concave in each
    input).
    Also impose Inada conditions to ensure interior solution
    \begin{align*}
      \lim_{C\ra 0} \; u_1(C,1-N) = +\infty
      \qquad
      \lim_{N\ra 0} \; u_2(C,1-N) = 0
      \qquad
      \lim_{N\ra 1} \; u_2(C,1-N) = +\infty
    \end{align*}
    First condition: avoid zero consumption.
    Second: the marginal value of leisure goes to zero.
    Third: avoid working all the time.

  \item \emph{Technology}:
    Output $Y_t$ is produced by a CRS production function, capital
    $K_t$, labor $N_t$:
    \begin{align*}
      Y_t &= F(K_t,N_t)
    \end{align*}
    $F$ continuously twice differentiable, CRS (i.e. homogeneous of
    degree one or linear $(K,N)$ jointly), strictly increasing, strictly
    concave in $K$ and $N$ individually, and weakly concave (because
    linear) in $(K,N)$ jointly. Also impose Inada conditions:
    \begin{align*}
      F(0,N) &= 0
      \qquad
      \lim_{K\ra 0} F_1(K,N) = +\infty
      \qquad
      \lim_{K\ra \infty} F_1(K,N) = 0
    \end{align*}
    First condition: No production without capital.
    Second: Use some capital to produce.
    Third: Returns to capital go to zero eventually.

    Since $F$ CRS, we sometimes define things in terms of the
    capital/labor ratio:
    \begin{align*}
      F(k,n) &= n \cdot F(k/n,1)
    \end{align*}
    So then define
    \begin{align*}
      f(\hat{k}) := F(\hat{k},1)
      \qquad\text{where}\quad
      \hat{k} = \frac{k}{n}
    \end{align*}
    Then the derivatives are
    \begin{align*}
      F_1(k,n)
      &=
      \frac{d}{dk}[F(k,n)]
      =
      \frac{d}{dk}[n\cdot f(k/n)]
      = f'(k/n) \\
      &= f'(\hat{k}) \\
      F_2(k,n)
      &=
      \frac{d}{dn}[F(k,n)]
      =
      \frac{d}{dn}[n\cdot f(k/n)]
      = f(k/n) +
      n\cdot
      \frac{d}{dn}[F(k/n,1)] \\
      &= f(\hat{k}) - f'(\hat{k})\cdot \hat{k}
    \end{align*}

    Output used for consumption, investment, or government purchases:
    \begin{align*}
      C_t + I_t + G_t &\leq Y_t
    \end{align*}
    Capital accumulation affected by depreciation at rate
    $\delta\in[0,1]$:
    \begin{align*}
      K_{t+1} &= (1-\delta)K_t + I_t
    \end{align*}

  \item \emph{Government}:
    We allow for a government that purchases $\{G_t\}\tinfz$ financed by
    tax rates $\{\tau_t^C,\tau_t^K,\tau_t^N\}\tinfz$ on consumption,
    earnings from capital, and wages, along with a lump-sum head taxes
    each period, $\{\tau^H_t\}\tinfz$.

  \item \emph{Endowments}:
    Initial capital level $K_0=\bar{K}_0$ is given.
    Also, each household has one unit of time to be split among labor
    and leisure each period.
\end{enumerate}



\clearpage
\subsection{Social Planner's Problem}

The social planner ignores the government by setting $g_t$ and all tax
rates equal to zero for all periods. The SP then just maximizes
household's utility subject to feasibility constraints:
\begin{align*}
  \max_{\{c_t\},\{k_t\},\{n_t\}}
    &\sumtinfz \beta^t u(c_t,1-n_t) \\
    \text{s.t.} &\quad
    c_t + k_{t+1}
    \leq F(k_t,n_t) + (1-\delta) k_t\\
    &\quad c_t, k_t \geq 0
    \qquad n_t\in[0,1]
    \qquad k_0 = \bar{k}_0
\end{align*}
We can eliminate choice of $\{c_t\}$ and turn this into equivalent
problem
\begin{align*}
  \max_{\{k_t\},\{n_t\}}
    &\sumtinfz \beta^t
      u\big(F(k_t,n_t) + (1-\delta) k_t - k_{t+1}, \;1-n_t\big) \\
    \text{s.t.} &\quad
    F(k_t,n_t) + (1-\delta) k_t - k_{t+1} \geq 0 \\
    & \quad k_t \geq 0 \qquad n_t \in[0,1] \qquad
    k_0 = \bar{k}_0
\end{align*}
First order necessary conditions:
\begin{alignat*}{3}
  k_t:&&\qquad
  0 &=
  \beta^t u_1(c_t,1-n_t)
  \left[F_1(k_t,n_t)+(1-\delta)\right]
  - \beta^{t-1}u_1(c_{t-1},1-n_{t-1})
  \\
  n_t:&&\qquad
  0
  &=
  \beta^t u_1(c_t,1-n_t)F_2(k_t,n_t) - \beta^t u_2(c_t,1-n_t)
\end{alignat*}
Then the pareto efficient allocation is then completely characterized by
\begin{align}
  \frac{u'(c_{t-1},1-n_{t-1})}{\beta u'(c_{t},1-n_t)}
  &= F_1(k_t,n_t) + (1-\delta) \notag \\
  \frac{u_2(c_t,1-n_t)}{u_1(c_t,1-n_t)} &= F_2(k_t,n_t) \\
  c_t &= F(k_t,1) + (1-\delta)k_t - k_{t+1}\notag\\
  \limt \beta^{t-1}u'(c_{t-1},1-n_t) k_t &= 0 \notag\\
  k_0 &= \bar{k}_0\notag
\end{align}
The first equation says MRS = MRT. On the LHS, it's clear that the
quantity represents the marginal rate of substitution between
consumption at $t-1$ and consumption at $t$. On the RHS, it's less
clear, but follows from the fact that decreasing consumption by one unit
to but capital increases tomorrow's consumption by $F_1(k_t,n_t)$ and
allows the individual to decrease investment by $(1-\delta)$ next period
since we carried extra capital forward.
The second equation \emph{also} says MRS = MRT, where the LHS is the
MRS between leisure and consumption while the RHS is the extra
production from giving up a little more leisure.

We could alternatively express the FOCs interns of $f$, rather than $F$:
\begin{align}
  \frac{u'(c_{t-1},1-n_{t-1})}{\beta u'(c_{t},1-n_t)}
  &= f'(\hat{k}_t) + (1-\delta) \notag \\
  \frac{u_2(c_t,1-n_t)}{u_1(c_t,1-n_t)} &= f(\hat{k}_t) - \hat{k}_t\cdot
  f'(\hat{k}_t) \notag \\
  c_t &= n_t f(\hat{k}_t) + (1-\delta)n_t \hat{k}_t - n_{t+1} \hat{k}_{t+1}\notag
\end{align}
Let $n_*$, and $\hat{k}_*$ denote the steady values, and substitute
$c_t$ into the first two equations to arrive at the following steady
state equations:
\begin{align}
  \frac{1}{\beta}
  &= f'(\hat{k}_*) + (1-\delta) \notag \\
  \frac{u_2\big(n_* \left[f(\hat{k}_*) - \delta\hat{k}_*\right],\;1-n_*\big)}{%
    u_1\big(n_* \left[f(\hat{k}_*) - \delta\hat{k}_*\right],\;1-n_*\big)}
    &= f(\hat{k}_*) - \hat{k}_*\cdot
  f'(\hat{k}_*) \notag
\end{align}
Two equations in two unknowns, $n_*$ and $\hat{k}_*$. The first equation
pins down $\hat{k}_*$, and it does so uniquely by the Inada conditions.
The second equation can be written as
\begin{align*}
  \frac{u_2\big(n_* B_2,\;1-n_*\big)}{%
    u_1\big(n_* B_2,\;1-n_*\big)}
    &= B_1
\end{align*}
where $B_1$ and $B_2$ are constants (since $\hat{k}_*$ was determined by
the first equation) that equal
\begin{align*}
  B_1 &= f(\hat{k}_*) - \hat{k}_*\cdot f'(\hat{k}_*) \\
  B_2 &= f(\hat{k}_*) - \delta\hat{k}_*
\end{align*}
There always exists at least one solution, but in general there is no
unique solution unless we assume $B_1$ and $B_2$ are normal goods or
$B_1=B_2$.

\clearpage
\subsection{Arrow-Debreu Competetive Equilibrium (ADCE)}

Here, the government matters.
In this subsection, we formulate an
\emph{Arrow-Debreu Competetive Equilibrium} (ADCE) for a simple
production-based economy involving households that consume output,
supply labor, and own capital along with firms that produce output by
buying labor and renting capital from the households (paying a rental
rate).

Note that there will be no real link between time periods for capital.
You can change capital a lot from $k_t$ to $k_{t+1}$. You could link up
time periods by adding adjustment costs, a feature we ignore for now.

In this context, and ADCE is a list of sequences of
$\{c_t^*\}$  Consumption,
$\{k_t^*\}$  Capital,
$\{h_t^*\}$  Hours,
$\{p_t^*\}$  Prices,
$\{w_t^*\}$  Wages,
$\{r_t^*\}$  Rate of return on capital, and
$\{T_t^*\}$ Transfers
that satisfy the following conditions:

\begin{enumerate}
  \item \emph{Household Optimization}: Taking prices,
    wages, and the rate of return on capital
    ($\{p^*_t\}$, $\{w^*_t\}$, $\{r^*_t\}$) as given, the
    sequences for consumption, capital, and hours of labor
    ($\{c_t^*\}$, $\{k_t^*\}$, and $\{h_t^*\}$)
    solve the utility maximization problem
    \begin{align}
      (\{c_t^*\}, \{k_t^*\}, \{h_t^*\})
      =
      \argmax_{\{c_t\}, \{k_t\}, \{h_t\}}
        \; &\sumtinfz \beta^t u(c_t)
        \label{defn:adce-hh-objfcn}\\
      \text{s.t.} \; &
        \sumtinfz p^*_t(c_t + k_{t+1}-(1-\delta)k_t) \leq
        \sumtinfz (r^*_t k_t + w^*_t h_t)
        \label{defn:adce-hh-budget}\\
      c_t &\geq 0 \notag\\
      h_t &\in [0,1] \notag\\
      k_0 &= \bar{k}_0 \; \text{given} \notag
    \end{align}
    In other words the ``star'' sequences correspond exactly to what the
    household optimizing household would choose to do, taking things
    outside of their control as given.

    A few remarks:
    \begin{enumerate}
      \item Inequality~\ref{defn:adce-hh-budget} acts as a budget
        constraint that stipulates total lifetime spending on
        consumption and capital must be less than or equal to total
        lifetime capital-rental income and labor income. Note that it is
        a single budget constraint for time zero, not a sequence of
        budget constraints each period.

      \item Outside of the budget constraint, the remaning constraints
        enforce nonnegative consumption, supply of hours limited by
        hours in the day (normalized to one), and capital given.

      \item There is no non-negativity constraint on capital since the
        firm's production function will be defined for positive capital
        values only. Hence they will never demand negative capital, so
        we can leave it out of the constraints here.

      \item Labor $h_t$ is not in the utility function, so it is pretty
        obvious that the household would choose to supply $h_t=1$ units
        of labor for all $t$. That earns housholds the most consumption
        (which they value) at the cost of leisure (which we assume they
        don't care about).

        So it might seem like we could have left the $\{h_t\}$ out of
        the definition of equilibrium altogether. However, that is not
        the case. Even though households will choose to supply one unit
        of labor, firms don't know that. We must keep the labor decision
        in the model because that will allow us to pin down the wage
        rate.
    \end{enumerate}

  \item \emph{Firm Optimization}: Taking
    prices, wages, and the rate of return on capital
    ($\{p^*_t\}$, $\{w^*_t\}$, $\{r^*_t\}$) as given,
    the sequences for capital to rent and labor hours to buy
    ($\{k_t^*\}$ and $\{h_t^*\}$)
    solve the profit maximization problem
    \begin{align}
      (\{k_t^*\}, \{h_t^*\})
      =
      \argmax_{\{k_t\}, \{h_t\}}
        \; &\sumtinfz \beta^t (p^*_t F(k_t,h_t) - w^*_t h_t - r^*_t k_t)
        \label{defn:adce-firm-objfcn}\\
      \text{s.t.} \;
      &k_t \geq 0 \notag\\
      &h_t \geq 0 \notag
    \end{align}
    A few remarks:
    \begin{enumerate}
      \item Firms don't worry about the fact that we must have
        $h_t\leq 1$. To them, they can buy as many labor hours as they
        want at rate $w^*_t$. In reality, the household optimization
        side of the equilibrium will enforce $h_t\leq 1$.

      \item Though there does not appear to be any discounting in the
        firm's objective function, it is implicit in the prices. As
        we'll see below, $p_t\ra 0$, which will take care of the
        discounting.
    \end{enumerate}

  \item \emph{Government}: For each $t$:
    \begin{align}
      \tau_k r^*_t k^*_t = T^*_t
      \label{taxes-govt}
    \end{align}

  \item \emph{Market Clearing}: For each $t$:
    \begin{align}
      F(k^*_t,h_t^*) = c_t^* + k^*_{t+1} - (1-\delta)k_t^*
      \label{taxes-clear}
    \end{align}
\end{enumerate}
We are now in a position to characterize equilibrium. Rather than appeal
to the welfare theorem to say that the outcome is Pareto optimal (hence
it looks exactly like the outcome of the planning problem), we will look
at the first order conditions to the different optimization problems we
have. It turns out that they \emph{will} match the planning problem,
which will offer a kind of proof of the first welfare theorem.
\begin{enumerate}
  \item \emph{Household FOCs}: Again there is a single budget
    constraint at time zero, not one for each period. So
    Inequality~\ref{defn:adce-hh-budget} has only one associated
    multiplier, $\mu$. Therefore, differentiating with respect to
    consumption and capital, we get FOCs for time $t$ as:
    \begin{align}
      \beta^t u'(c_t) &= \mu p_t^* \label{hhfoc1}\\
      \mu[r_t^* + p_t^* (1-\delta)]
      &= \mu p_{t-1}^* \label{hhfoc2}
    \end{align}
    while clearly $h_t=1$.

    These are necessary conditions for optimal $c_t$ that follow from
    the fact that $u'(0)=\infty$, so we have an interior solution,
    implying the KKT conditions are necessary.

  \item \emph{Firm FOCs}: We have
    \begin{align}
      p^*_t F_1(k_t,h_t) &= r_t^* \label{firmfoc1}\\
      p^*_t F_2(k_t,h_t) &= w_t^* \notag
    \end{align}
    Notice that capital appears nowhere in those equations.
    We instead have Equation~\ref{firmfoc1} relating \emph{prices},
    rather than quantities of capital. This is called a
    \emph{no arbitrage condition}. More on that later.

  \item \emph{Transversality Condition}:
    Think about a finite-time version of this problem. The household has
    to choose consumption and investment for the last period, denoted
    time $T$. At $T$, the household can either consume output in the
    form of $c_T$ or invest to keep a positive $k_{T+1}$. But since $T$
    is the last period, investing output to keep $k_{T+1}>0$ looks
    pretty dumb when you could instead use that output for higher
    consumption $c_T$.  So it must be that \emph{either} $k_{T+1}=0$
    (i.e.\ you consume all output in the last period and invest nothing)
    or the value of consumption---the marginal utility
    $u'(c_T)$---equals zero so that more consumption $c_T$ isn't
    actually worth shit. In math, you'd need
    \begin{align*}
      \beta^{T} u'(c_T) k_{T+1} = 0
    \end{align*}
    The transversality condition is the infinite horizon analog to this
    problem, written
    \begin{align*}
      \limt \beta^t u'(c_t) k_{t+1}=0
    \end{align*}

  \item \emph{Pareto Optimality}: We want to show the competetive
    equilibrium matches the solution to the planning problem. Since
    we're considering the equilibrium sequences, everything will have
    stars ${}^*$.

    Start by dividing Equation~\ref{hhfoc1} at time $t-1$ by its time
    $t$ analog to get
    \begin{align}
      \frac{u'(c_{t-1}^*)}{\beta u'(c_{t}^*)} = \frac{p_{t-1}^*}{p_t^*}
      \label{pratio1}
    \end{align}
    Take household FOC Equation~\ref{hhfoc2}, cancel $\mu$'s, and divide
    by $p_t^*$:
    \begin{align*}
      \frac{r_t^*}{p_t^*} + (1-\delta)
      &= \frac{p_{t-1}^*}{p_t^*}
    \end{align*}
    Into the above equation, substitute Equation~\ref{firmfoc1} in for
    $r_t^*$:
    \begin{align}
      F_1(k_t,h_t) + (1-\delta)
      &= \frac{p_{t-1}^*}{p_t^*}
      \label{pratio2}
    \end{align}
    How equate Equations~\ref{pratio1} and \ref{pratio2}:
    \begin{align*}
      \frac{u'(c_{t-1}^*)}{\beta u'(c_{t}^*)}
      = F_1(k_t,h_t) + (1-\delta)
    \end{align*}
    So we have this, together with market clearing, $h_t=1$, the
    transversality condition, and an initial capital level:
    \begin{align*}
      \frac{u'(c_{t-1}^*)}{\beta u'(c_{t}^*)}
      &= F_1(k_t,h_t) + (1-\delta) \\
      F(k_t,h_t) &= c_t + k_{t+1} - (1-\delta) k_t \\
      h_t &= 1\\
      \limt \beta^t u'(c_t) k_{t+1}&=0\\
      k_0 &= \bar{k}_0 \; \text{given}
    \end{align*}
    These are exactly the conditions that characterized the Pareto
    efficient allocations from the planning problem.

  \item \emph{Prices}: Normalize $p_0^*=1$, which will also remove
    indeterminacy problems. We get the wage and capital rental rates
    from the firm's first order conditions:
    \begin{align*}
      r_t^* &= p_t^* F_1(k^*_t,h^*_t) \\
      w_t^* &= p_t^* F_2(k^*_t,h^*_t)
    \end{align*}
    We get tomorrow's price by Solving Equation~\ref{pratio1} for
    $p_{t+1}$:
    \begin{align}
       p_t^*
       = p_{t-1}^*\beta \frac{u'(c_{t}^*)}{u'(c_{t-1}^*)}
    \end{align}

  \item \emph{Government Waste}: Suppose that the government did not
    lump-sum capital income taxes back to households. Suppose instead
    that the government just buries the output. Then there will be
    changes to equilibrium.

    Specifically, if the government wastes taxes revenue, replace
    sequence $\{T^*_t\}$ with $\{G^*_t\}$, and remove $T^*_t$ terms from
    the household budget constraint, since they never see the tax
    %revenue.  Equation~\ref{defn:adce-hh-budget-taxes} becomes
    \begin{align*}
        \sumtinfz p^*_t(c_t + k_{t+1}-(1-\delta)k_t) &\leq
        \sumtinfz ((1-\tau_k)r^*_t k_t + w^*_t h_t)
    \end{align*}
    We also modify the Government Budget Equation~\ref{taxes-govt} and
    Market Clearing Equation~\ref{taxes-clear}
    \begin{align*}
      G^*_t &=  \tau_k r^*_t k^*_t \\
      F(k^*_t,h_t^*) &= c_t^* + k^*_{t+1} - (1-\delta)k_t^* + G^*_t
    \end{align*}
    Of the key equations summarizing the ADCE allocation, only the
    market clearing constraint (which pins down the level of
    consumption) is affected. We see that the government waste reduces
    consumption.
    Notably, however, the consumption Euler equation does not change. In
    other words, households don't change how they allocate cash money
    across time---they just need to reduce their consumption by the
    amount of waste in each period.
\end{enumerate}
Lastly, a \emph{steady state ADCE} is a value $k^*$ and an ADCE for the
economy with $\bar{k}_0=k^*$ and $\{k_t^*\}$ satisfying $k^*_t=k^*$ for
all $t$. Consumption must be a constant $c^*$ because solving the market
clearing equation for consumption expresses consumption as a function of
constants:
\begin{align*}
  c^* := c_t^* = F(k^*,1) - \delta k^*
  \qquad \forall t
\end{align*}
Therefore, by Equation~\ref{pratio1}
\begin{align*}
  \frac{u'(c^*)}{\beta u'(c^*)} &= \frac{p_{t-1}^*}{p_t^*} \\
  \implies \quad p_t &= \beta p_{t-1}^* = \beta^t p_0^*
\end{align*}
Hence, prices are \emph{not} constant---they are falling. The same logic
can be used to show that wages and rental rates are falling
monotonically in steady state:
\begin{align*}
  r_t^* &= p_t^* F_1(k^*,1) = \beta^t p_0^* F_1(k^*,1) = \beta^t r_0^*\\
  w_t^* &= p_t^* F_2(k^*,1) = \beta^t p_0^* F_2(k^*,1) = \beta^t w_0^*
\end{align*}
Hence we have justified the earlier claim that ``prices embed
discounting'' within the firm's optimization problem.

\subsection{Rates of Return in an ADCE}

There are two ways for the consumer to move money through time in an
ACDE, with two corresponding rates of return:
\begin{enumerate}
  \item \emph{Real Rate of Return}, $R_t^*$: Give up one unit of
    consumption today, saving $p_t^*$, and buy $\frac{p_t^*}{p_{t+1^*}}$
    units of consumption tomorrow:
    \begin{align}
      1+R_t^* = \frac{p_t^*}{p_{t+1}^*} = \frac{1}{\beta}
      \label{noarb1}
    \end{align}
    where the last equality followed from a steady relationship.

  \item \emph{Real Rate of Return on Capital}: Give up one unit of
    consumption today, invest in capital, and use all proceeds from the
    capital to consume at time $t+1$
    \begin{align}
      \frac{r_{t+1}^* + (1-\delta)p_{t+1}^*}{p_{t+1}^*}
      \label{noarb2}
    \end{align}
    In words, you give up one unit of consumption today and instead buy
    one unit of capital for use tomorrow.
    First, that extra unit of capital gets you extra rental income
    $r_{t+1}^*$ tomorrow.
    Second, you also get the liquidation value of that unit of capital
    (net of depreciation) at tomorrow's price $(1-\delta)p_{t+1}^*$
    The sum of these two things $r_{t+1}^* + (1-\delta)p_{t+1}^*$ is the
    numerator.

    Lastly, you gave up one unit of consumption today at price $p_t^*$,
    but consumption will be priced differently tomorrow.  So we should
    divide this extra consumption tomorrow by $p_{t+1}^*$ to make the
    periods comparable. That's the denominator.
\end{enumerate}
So we've established two ways to move money through time: via simple
reallocation of consumption and via investment. By any reasonable notion
of equilibrium, we would expect no arbitrage, i.e.\ for
Equation~\ref{noarb1} (in whichever of the three representations we
choose) to equal Equation~\ref{noarb2}:
\begin{align*}
  \frac{p_t^*}{p_{t+1}^*}
  &=
  \frac{r_{t+1}^* + (1-\delta)p_{t+1}^*}{p_{t+1}^*} \\
  \Leftrightarrow\quad
  \frac{p_t^*}{p_{t+1}^*}
  &=
  \frac{r_{t+1}^*}{p_{t+1}^*} + (1-\delta)
\end{align*}
But recall that this equation popped out of the ADCE. It was also the
reason why the FOC for capital didn't have the \emph{quantity} of
capital involved, but rather this no arbitrage condition (implicitly).



\clearpage
\subsection{Solow Model}

Fixed output-share of investment each period, $s$. Capital evolves
according to
\begin{align*}
  k_{t+1} &= sf(k_t) + (1-\delta)k_t \\
  k_0 &= \hat{k}_0
\end{align*}
By investment equation, steady state capital must satisfy
\begin{align*}
  k^* &= sf(k^*) + (1-\delta)k^*\\
  \Leftrightarrow\quad
  \frac{\delta}{s} k^* &= f(k^*)
\end{align*}



\clearpage
\section{Economic Growth}

\subsection{Exogenous Growth}

\subsection{Endogenous Growth}

We modify the time-homogeneous production function. There's three ways
you can do it
\begin{enumerate}
  \item $y_t = F(A_t k_t,h_t)$: Capital augmenting
  \item $y_t = F(k_t,A_t h_t)$: Labor augmenting
  \item $y_t = A_t F(k_t,h_t)$: Neutral or factor neutral technological
    change because it affects the production function generally---not
    just one of the factors. It's as if the production function displays
    constant returns to scale, so you augment both factors and the
    constant $A_t$ gets pulled out in front.
\end{enumerate}
Note that for something like Cobb-Douglas, there's no difference.

\subsubsection{Baseline Growth Model}

We set up the model
\begin{enumerate}
  \item \emph{Preferences}: $\sumtinfz \beta^t u(c_t)$
  \item \emph{Technology}: Assume $\{A_t\}$ given, so deterministic
    technology growth at a constant rate (for now).\footnote{%
      Add randomness and you get RBC models.}
    We go for labor-augmenting technological change.
    \begin{align*}
      y_t &= F(k_t,A_th_t) \\
      y_t &= c_i + i_t \\
      k_{t+1} &= (1-\delta)k_t + i_t
    \end{align*}
  \item \emph{Endowments}: One unit of time for labor each period, and
    $k_0=\bar{k}_0$.
\end{enumerate}
This leads to social planner problem.
\begin{align*}
  \max_{\{c_t\},\{k_t\}}
    &\sumtinfz \beta^t u(c_t) \\
    \text{s.t.} &\quad
    c_t + k_{t+1}
    = F(k_t,A_t) + (1-\delta) k_t\\
    &\quad c_t \geq 0 \\
    &\quad k_0 = \bar{k}_0
\end{align*}
Then the pareto efficient allocation is completely characterized by
\begin{align}
  \frac{u'(c_{t-1}}{\beta u'(c_{t})}
  &= F_1(k_t,A_t) + (1-\delta) \label{eulerA}\\
  c_t &= F(k_t,A_t) + (1-\delta)k_t - k_{t+1}\notag\\
  \limt \beta^{t-1}u'(c_{t-1}) k_t &= 0 \notag\\
  k_0 &= \bar{k}_0\notag
\end{align}
We will now attempt to find a \emph{balanced growth path}, which is the
natural generalization of steady state that considers asymptotic
behavior. A balanced growth path is a solution in which all of the
variables grow at \emph{constant} rates, though \emph{not necessarily}
the same rate.\footnote{%
  For our simple model, it will be the case that things grow at the same
  rate. But the concept of a ``balanced growth path'' is more general.
}

So we know that $A_t$ grows at some constant rate $g$. We want $k_t$ and
$c_t$ to grow at a constant rates $g_k$ and $g_c$ as well, though they
could differ from $g$. So we want
\begin{align*}
  c_t &= F(k_t,A_t) + (1-\delta) k_t - k_{t+1} \\
  (1+g_c) c_0 &= F((1+g_k)k_t,(1+g)^tA_0) + (1-\delta) k_t - k_{t+1} \\
\end{align*}
For $c_t$ to grow at a constant rate, we need $g_k=g$. Then we can pull
out $(1+g)$ from inside the production function and everything on the
RHS grows at $g$. Then $c_t$ grows at rate $g$ too.

Next, notice that since $k_t$ and $A_t$ are growing at $g$, the ratio
between the goods is not changing. Hence $F_1(k_t,A_t)$ is constant
since the derivative is homogeneous of degree zero (which follows from
$F$ being HoD1).

\subsubsection{Baseline with Change of Variables}

Since everything is growing at rate $g$, define
$\tilde{k}_t = \frac{k_t}{(1+g)^t}$ or equivalently
$k_t=(1+g)^t\cdot \tilde{k}_t$. Moreover, normalize $A_0=1$ and
substitute $A_t=(1+g)^t$. Substitute. Then the Social Planner's problem
becomes
\begin{align*}
  \max_{\{k_t\}}
    &\sumtinfz \beta^t u\left[F\left((1+g)^t\tilde{k}_t,(1+g)^{t}\right)
      + (1-\delta) (1+g)^t\tilde{k}_t - (1+g)^t\tilde{k}_{t+1}\right] \\
    \text{s.t.} &\quad
    F((1+g)^t\tilde{k}_t,(1+g)^t) + (1-\delta) (1+g)^t\tilde{k}_t
      - (1+g)^t\tilde{k}_{t+1}\geq 0\\
    &\quad k_0 = \bar{k}_0
\end{align*}
We can pull out $(1+g)^t$ in both the objective function and the
constraint to simplify to
\begin{align*}
  \max_{\{k_t\}}
    &\sumtinfz \beta^t u\left[F\left(\tilde{k}_t,\right)
      + (1-\delta) (1+g)^t\tilde{k}_t - (1+g)^t\tilde{k}_{t+1}\right] \\
    \text{s.t.} &\quad
    F((1+g)^t\tilde{k}_t,(1+g)^t) + (1-\delta) (1+g)^t\tilde{k}_t
      - (1+g)^t\tilde{k}_{t+1}\geq 0\\
    &\quad k_0 = \bar{k}_0
\end{align*}

Then the pareto efficient allocation is completely characterized by
\begin{align}
  \frac{u'(c_{t-1}}{\beta u'(c_{t})}
  &= F_1(k_t,A_t) + (1-\delta) \\
  c_t &= F(k_t,A_t) + (1-\delta)k_t - k_{t+1}\notag\\
  \limt \beta^{t-1}u'(c_{t-1}) k_t &= 0 \notag\\
  k_0 &= \bar{k}_0\notag
\end{align}
We will now attempt to find a \emph{balanced growth path}, which is the
natural generalization of steady state that considers asymptotic
behavior. A balanced growth path is a solution in which all of the
variables grow at \emph{constant} rates, though \emph{not necessarily}
the same rate.\footnote{%
  For our simple model, it will be the case that things grow at the same
  rate. But the concept of a ``balanced growth path'' is more general.
}

So we know that $A_t$ grows at some constant rate $g$. We want $k_t$ and
$c_t$ to grow at a constant rates $g_k$ and $g_c$ as well, though they
could differ from $g$. So we want
\begin{align*}
  c_t &= F(k_t,A_t) + (1-\delta) k_t - k_{t+1} \\
  (1+g_c) c_0 &= F((1+g_k)k_t,(1+g)^tA_0) + (1-\delta) k_t - k_{t+1} \\
\end{align*}
For $c_t$ to grow at a constant rate, we need $g_k=g$. Then we can pull
out $(1+g)$ from inside the production function and everything on the
RHS grows at $g$. Then $c_t$ grows at rate $g$ too.

Next, notice that since $k_t$ and $A_t$ are growing at $g$, the ratio
between the goods is not changing. Hence $F_1(k_t,A_t)$ is constant
since the derivative is homogeneous of degree zero (which follows from
$F$ being HoD1).


\clearpage
\subsection{Romer Model}

\subsubsection{Preferences, Technology, Endowments}

Specialization drives productivity. Primitives
\begin{enumerate}
  \item \emph{Preferences}: $\sumtinfz \beta^t u(c_t)$ with
    $u(c)=\frac{c^{1-\sigma}-1}{1-\sigma}$ for $\sigma>0$.
  \item \emph{Technology}:
    Output $y_t$ is produced by spreading out aggregate capital $k_t$
    among a mass of $N_t$ production processes that all use capital
    differently:
    \begin{align*}
      y_t &=
      \left(
      \int_{0}^{N_t} k_t(i)^\alpha \;di \right)
      h_t^{1-\alpha} \\
      k_t &= \int_0^{N_t} k_t(i) \; di
    \end{align*}
    where $N_t$ is an index of specialization that will grow over time
    as additional (specialized) production processes come into
    existence through R\&D. But given $N_t$ fixed, note that the
    production function is CRS.

    Output can be used for consumption, investment in aggregate
    capital, or investment in finding more production processes
    (i.e.\ R\&D).
    \begin{align*}
      y_t &= c_t + i_t^k + i_t^N \\
      k_{t+1} &= (1-\delta)k_t + i_t^k \\
      N_{t+1} &= N_t + i_t^N
    \end{align*}

  \item \emph{Endowments}: Each household has one unit of time, while
    capital and the number of production processes start at
    $k_0=\bar{k}_0$ and $N_0=\bar{N}_0$.
\end{enumerate}
Note that there are no irreversibilities, so the stock of knowledge can
be turned back into consumption $c$, but that won't be a problem since
we'll be finding a BGP.


\subsubsection{Social Planner's Problem}

First, we know that aggregate capital will be spread out equally among
the production processes, so that $k_t(i) = \frac{k_t}{N_t}$. Therefore
\begin{align*}
  \int_0^{N_t} k_t(i)^\alpha \; di
  &=
  \int_0^{N_t} \left(\frac{k_t}{N_t}\right)^\alpha \; di
  =
  \left(\frac{k_t}{N_t}\right)^\alpha N_t
  = k_t^\alpha N_t^{1-\alpha}
\end{align*}
Coupled with the fact that $h_t=1$, this allows us to write the
production function more compactly as
\begin{align*}
  F(k_t,h_t)
  &= \left( \int_0^{N_t} k_t(i)^\alpha \; di\right)
    h_t^{1-\alpha}
  = k_t^{\alpha} N_t^{1-\alpha}
\end{align*}
This allows us to write the social planner's problem
\begin{align*}
  \max_{\{k_t\},\{N_t\}} \; & \sumtinfz \beta^t u(c_t) \\
  \text{s.t.} \; &
    c_t =
    k_t^\alpha N_t^{1-\alpha}
    - [k_{t+1}-(1-\delta)k_t] + [N_{t+1}-N_t] \\
    & k_0 = \bar{k}_0 \\
    & N_0 = \bar{N}_0 \\
    & c_t, k_t,N_t\geq 0
\end{align*}
Hence, first order conditions
\begin{align*}
  \frac{u'(c_{t-1})}{\beta u'(c_t)}
  &=
  \alpha \left(\frac{k_t}{N_t}\right)^{\alpha-1} + (1-\delta) \\
  \frac{u'(c_{t-1})}{\beta u'(c_t)}
  &=
  (1-\alpha) \left(  \frac{k_t}{N_t} \right)^{\alpha} + 1
\end{align*}
Equating
\begin{align*}
  \alpha \left(\frac{k_t}{N_t}\right)^{\alpha-1} + (1-\delta)
  &=
  (1-\alpha) \left(  \frac{k_t}{N_t} \right)^{\alpha} + 1
\end{align*}
This needs to be true at each $t$, hence $\frac{k_t}{N_t}$ is a
constant i.e.
\begin{align*}
  \frac{1}{\tilde{A}} = \frac{k_t}{N_t}
  \quad\implies\quad
  N_t = \tilde{A}k_t
\end{align*}
Moreover, there's a unique value for the ratio since the RHS is
increasing in $\frac{k_t}{N_t}$, while the LHS is decreasing.
\\
\\
And if we plug this back into the Euler Equation
\begin{align*}
  \frac{u'(c_{t-1})}{\beta u'(c_t)}
  &=
  \alpha \left(\frac{1}{\tilde{A}}\right)^{\alpha-1} + (1-\delta)
\end{align*}
which is exactly identical to the $Ak$ model where
$A=\alpha \left(\frac{1}{\tilde{A}}\right)^{\alpha-1}$.


\clearpage
\subsubsection{MCE with R\&D plus Entry}

Output $y_t$ is the ``final good'' produced by mixing many intermediate
goods $z_t(i)$ according to production function
\begin{align*}
  y_t = \left( \intzN z_t(i)^\alpha \; di \right) h_t^{1-\alpha}
\end{align*}
The intermediate goods are produced directly by capital, rather than the
final good as we've had before.
\begin{enumerate}
  \item \emph{Firm Optimization}:
    There are now three types of firms, each with their own optimization
    problems:
    \begin{enumerate}
      \item \emph{Final Goods Producers}:
        These take a variety of intermediate goods and produce a homo
        \begin{align*}
          \max_{z_t} \; & p^*_{z,t} z_t
        \end{align*}

      \item \emph{R\&D Sector}: These firms have linear technology in
        producing new intermediate products. They are monopolists on
        intermediate products---no other firm can create new
        intermediate products. Profits must be zero,
        \begin{align*}
          p_t^* (p_{N,t}^*-1) &= 0 \\
          N_0^* &= \bar{N}_0
        \end{align*}
        I multiplied by $p_t^*$ to normalize all prices. Within
        parentheses, we see that it costs one unit to create a new where
        $p_{N,t}^*$ is the price that it can be sold at.

      \item \emph{Intermediate Goods Sector}:
        \begin{align*}
          \max_{k_{z,t}, \; p_{z,t}}
          p_{z,t} \, k_{z,t}
          - r_t^* k_{z,t}
        \end{align*}

    \end{enumerate}
    With each firm taking \emph{demand}
    (not prices this time) $d^*(p)$ as given, $p^*$ and $h^*(i)$
    solve the profit maximization problem:
    \begin{align*}
      (p^*(i),h^*(i))
      &=
      \max_{p(i),h(i)}
      p(i) Ah(i) - h(i) \\
      \text{s.t.} \;
      & \; Ah(i) = d_i^*[p(i)] \\
      & \; h(i) \geq 0\\
      & \; \pi^*(i) = p^*(i) Ah^*(i) - h^*(i)
    \end{align*}

  \item \emph{Household Optimization}: Taking prices $p^*$ as given,
    consumption $c^*(i)$ and total labor supply $h^*$ solve
    \begin{align*}
      (c^*(i), h^*)
      = \max_{c(i), h}
        & \; u\left(
          \left[ \int_0^N c(i)^\rho \; di \right]^{1/\rho}
        \right)\\
      \text{s.t} & \;
        \intzN p^*(i) c(i) \; di \leq h \\
      &\; h\in[0,1] \\
      &\; c(i) \geq 0
    \end{align*}
    while also $d^*(p)$ is the optimal choice each good as a function of
    price, holding all other prices and profits constant.

  \item \emph{Market Clearing}: All of the labor provided to the
    different firms must aggregate to the amount of total labor
    provided, and everything produced must be consumed:
    \begin{align*}
       h^* &= \intzN h^*(i) \; di \\
       c^*(i) &= Ah^*(i)
    \end{align*}
\end{enumerate}




\clearpage
\section{Static Model with Variety in Variety}


We define the usual trifecta of primitives for a macro problem:
\begin{enumerate}
  \item \emph{Preferences}:
    Given mass of goods $N$ and the preference parameter $\rho\in(0,1)$,
    define utility over consumption of a continuum of goods, captured by
    function $c:[0,N]\ra \R$, as
    \begin{align*}
      U(c) &=
      u\left(
      \left[
      \int_0^N [a(i)c(i)]^\rho \; di
      \right]^{1/\rho}
      \right)
    \end{align*}

  \item \emph{Technology}:
    There is a variety of goods to consume, each of which is produced by
    a different firm, so we need to define the production function for
    each firm:
    \begin{align*}
      y(i) = A(i) h(i)
    \end{align*}
    where $y(i)$ is output of the $i$th good from the $i$th firm, $A(i)$
    is productivity in producing the $i$th good, and $h(i)$ is labor
    used to produce the $i$th good.

  \item \emph{Endowments}: Each household has one unit of labor to
    supply to the firms.
\end{enumerate}
Social planner's problem
\begin{align*}
  \max_{c(i),h(i)}
  &\;
  u\left( \left[ \int_0^N [a(i)c(i)]^\rho \; di \right]^{1/\rho} \right)
  \\
  \text{s.t.}
  &\; \intzN h(i) \; di = 1 \\
  &\; c(i) = A(i) h(i) \\
  &\; c(i),h(i)\geq 0
\end{align*}
Eliminate $h(i)$ and use the fact that $u$ is increasing to rewrite the
problem as just the maximization of CES-weighted consumption:
\begin{align*}
  C=
  \max_{c(i)\geq 0}
  &\;
  \left[ \int_0^N [a(i)c(i)]^\rho \; di \right]^{1/\rho}
  \\
  \text{s.t.}
  &\; \intzN \frac{c(i)}{A(i)} \; di = 1
\end{align*}
where $C$ is CES-weighted consumption at the maximum.
FOCs with respect to $c(i)$:
\begin{align*}
  \frac{\lambda}{A(i)}
  &=
  \frac{1}{\rho}\left[
    \int_0^N [a(i)c(i)]^\rho \; di
  \right]^{\frac{1}{\rho}-1}
  \rho [a(i) c(i)]^{\rho-1} a(i)
  \\
  \frac{\lambda}{A(i)}
  &=
  C^{1-\rho}
  a(i)^\rho c(i)^{\rho-1}
  \\
  \frac{1}{A(i)}
  &=
  \lambda^{-1}
  C^{1-\rho}
  a(i)^\rho c(i)^{\rho-1}
\end{align*}
Subbing this into the constraint
\begin{align*}
  1&=
  \intzN \frac{c(i)}{A(i)} \; di
  =
  \intzN
    c(i)
    \lambda^{-1} C^{1-\rho} a(i)^\rho c(i)^{\rho-1}
    \; di \\
  \lambda &=
  C^{1-\rho}
  \intzN
    [a(i)c(i)]^{\rho}
    \; di \\
  \lambda &= C^{1-\rho} C^\rho = C
\end{align*}
Therefore, we have identified $\lambda = C$. Using this and solving the
FOC for $c(i)$, you get
\begin{align*}
  c(i)
  &=
  \left(
  \frac{C^{\rho}}{A(i)a(i)^\rho}
  \right)^{\frac{1}{\rho-1}}
  %=
  %\left(\frac{C}{a(i)}\right)^{\frac{\rho}{\rho-1}}
  %A(i)^{\frac{1}{1-\rho}}
  =
  A(i)
  \left(\frac{A(i)a(i)}{C}\right)^{\frac{\rho}{1-\rho}}
\end{align*}
Subbing this into the definition of $C$
\begin{align*}
  C
  = \left[ \int_0^N [a(i)c(i)]^\rho \; di \right]^{1/\rho}
  &=
  \left[ \int_0^N
    \left[a(i)
    \left(
    \frac{C^{\rho}}{A(i)a(i)^\rho}
    \right)^{\frac{1}{\rho-1}}
    \right]^\rho \; di \right]^{1/\rho} \\
  C
  &=
  \left[ \int_0^N
    \left[
    A(i)a(i)
    \right]^{\frac{\rho}{1-\rho}}
    \; di \right]^{\frac{1-\rho}{\rho}}
\end{align*}
Hence, consumption can be written
\begin{align*}
  c(i)
  &=
  A(i)
  \left(\frac{A(i)a(i)}{C}\right)^{\frac{\rho}{1-\rho}} \\
  &=
  A(i)
  \frac{[A(i)a(i)]^{\frac{\rho}{1-\rho}}}{%
    \int_0^N \left[ A(i)a(i) \right]^{\frac{\rho}{1-\rho}} \; di
  }
\end{align*}
Hence, labor allocation is
\begin{align*}
  h(i) =
  \frac{[A(i)a(i)]^{\frac{\rho}{1-\rho}}}{%
    \int_0^N \left[ A(i)a(i) \right]^{\frac{\rho}{1-\rho}} \; di
  }
\end{align*}


\clearpage
\section{Competitive Equilibrium in a Pure Exchange\\ Economy}

\subsection{The Economy}
There are $I$ agents, and the world is stochastic so that at time $t$
some state $s_t\in S$ will be realized. State histories are denoted
$s^t:=\{s_0,\ldots,s_t\}$
which occurs with probability $\pi_t(s^t)$.
\begin{enumerate}
  \item \emph{Endowments}: Each agent has a state-contingent endowment
    $\{y^i_t(s^t)\}\tinfz$.

    The $y_t^i(s^t)$ are measurable functions from a state history to a
    endowment realization.  In particular, if state history $s^t$ has
    been realized at time $t$, the endowment is $y_t^i(s^t)$.
  \item \emph{Preferences}:
    Each household chooses a state-contingent consumption plan
    $c^i := \{c_t^i(s^t)\}\tinfz$, i.e. a sequence of functions (one for
    each $t$) mapping from the state history realization $s^t$ into
    consumption.
    Preferences over consumption streams given by
    \begin{align}
      U(c^i) :=
      \E_0\left[
      \sumtinfz \beta^t
        u(c_t^i)
      \right]
      =
      \sumtinfz
        \sum_{s^t}
        \beta^t
        u\left(c_t^i(s^t)\right)\pi_t(s^t)
      \label{ad:objfcn}
    \end{align}
  \item \emph{Technology}:
    Pure exchange economy, so no production. Instead, agents trade
    time- and state history- contingent claims to their endowments to
    build their preferred consumption sequence.
    But for any such $t$ and $s^t$, total consumption must be feasible
    \begin{align*}
      \sum_i c_t^i(s^t) \leq \sum_i y_t^i(s^t)
      \qquad \forall t,s^t
    \end{align*}
    In words, at any time $t$ and state history realization $s^t$,
    consumption is financed purely from endowments/wealth, so total
    consumption cannot exceed total wealth at that $t$ and $s^t$
    combination.

    We let $p_t^\tau(s^t)$ represent the price of such a claim. This is
    the price of an asset that pays one unit of the consumption good
    $c_t$ at time $t$ if state history $s^t$ is realized.
    Its price is quoted in terms/units of the time $\tau$ consumption
    good $c_\tau$.

    In other words, to buy this asset, you must give up or sell a claim
    to $p_t^\tau(s^t)$ units of $c_\tau$. Then, if state history $s^t$
    is realized at $t$, you'll be compensated with enough money at time
    $t$ to go out and buy one unit of $c_t$.
\end{enumerate}

\clearpage
\subsection{Arrow-Debreu Competitive Equilibrium: Time 0 Trading}

\begin{itemize}
  \item
    At time $t=0$, you can buy and sell a security with price
    $p_t^0(s^t)$ (in some arbitrary units to be discussed later) that
    pays one unit of consumption at time $t$ if state history $s^t$ is
    realized.
    The household can therefore sell claims to its endowment
    realizations at these prices and then buy a bundle of these
    securities to construct its desired consumption plan $c^i$. This
    leads to the \emph{single} budget constraint for agent $i$
    \begin{align}
      \sumtinfz \sum_{s^t} p^0_t(s^t)c^i_t(s^t)
      \leq
      \sumtinfz \sum_{s^t} p^0_t(s^t)y^i_t(s^t)
      \label{ad:budget}
    \end{align}
    Note that this budget constraint is not in expectation or anything.
    It is exact/deterministic. We sum over every time period $t$ and
    every unique history $s^t$ \emph{within} a time period because
    contingent claim securities exist for every time and state-history
    combination.

  \item \emph{Household Optimization}:
    Household $i$ is trying to maximize expected utility in
    Expression~\ref{ad:objfcn} subject to the budget constraint in
    Expression~\ref{ad:budget}.  This gives the following time-$t$,
    state-history $s^t$ first order condition for agent $i$:
    \begin{align}
      \beta^t u'\left(c_t^i(s^t)\right) \pi_t(s^t)
      &= \mu_i p_t^0(s^t)
      \label{ad:foc}
    \end{align}
    where we took the derivative with respect to $c_t^i(s^t)$ and
    $\mu_i$ is the agent $i$ multiplier.

    To summarize allocations across individuals, divide first order
    condition Expression~\ref{ad:foc} for agent $i$ by the one for agent
    $j$:
    \begin{align}
      \frac{u'\left(c_t^i(s^t)\right)}{u'\left(c_t^j(s^t)\right)}
      &= \frac{\mu_i}{\mu_j}
      \label{ad:ratio}
    \end{align}
    Since the multipliers $\mu_i$ and $\mu_j$ are time-invariant for
    each agent, the ratio of marginal utilities is constant at
    \emph{every} time $t$ and for \emph{any} state realization $s^t$.

    Choosing $j=1$, we can solve Expression~\ref{ad:ratio} for agent
    $i$'s consumption:
    \begin{align}
      c_t^i(s^t)
      &=
      u'^{-1}
      \left[
      u'\left(c_t^1(s^t)\right)
      \frac{\mu_i}{\mu_1}
      \right]
    \end{align}
    Summing over all individuals and using market clearing
    \begin{align*}
      \sum_i y_t^i(s^t)
      =
      \sum_i c_t^i(s^t)
      =
      \sum_i
      u'^{-1}
      \left[
      u'\left(c_t^1(s^t)\right)
      \frac{\mu_i}{\mu_1}
      \right]
    \end{align*}
    where the first object in the equality is the realization of the
    aggregate endowment. From this, we also conclude that $c^1_t(s^t)$
    in the rightmost expression (the only choice variable slash
    non-parameter) depends on $s^t$ only through the realization of the
    aggregate endowment $\sum_i y_t^i(s^t)$ and the ratios $\mu_i/\mu_1$
    (which are just parameters). From there, you can conclude the same
    for any $c^i_t(s^t)$, not just $i=1$, by using
    Expression~\ref{ad:ratio}.

    Therefore, conclude that
    \begin{align*}
      s^t, \tilde{s}^\tau
      \quad\text{s.t.}\quad
      \sum_i y_t^i(s^t)
      = \sum_i y_\tau^i(\tilde{s}^\tau)
      \quad\implies\quad
      c_t^i(s^t) = c_\tau^i(\tilde{s}^\tau)
      \qquad \forall i
    \end{align*}
    That is, even for compeletely different times $t\neq \tau$, if the
    state histories $s^t$, $\tilde{s}^\tau$ are such that aggregate
    endowments have the same realized value at those times, consumption
    will be \emph{the same} for \emph{all agents}.  Only the aggregate
    endowment and parameters $\mu_i$ matter for an agent's consumption
    at a particular time---not how you got to that aggregate endowment
    or when you got to that aggregate endowment.

  \item \emph{Prices}:
    Note that we typically normalize prices so that $p_0^0(s_0)=1$,
    which puts all prices in units of time zero goods.
\end{itemize}

\subsection{Preview}

If we disallow trades, it's clear that the household $i$'s consumption
at time $t$, denoted $c_t^i$, depends directly upon the realization
$s^t$, the full-history state realization. In particular, his
consumption is equal to the realization of his endowment $y^i_t(s^t)$
(provided there are no bonds to transfer consumption across time), which
is directly a function of $s^t$.  Therefore, consumption, more
explicitly denoted $c_t^i(s^t)$, is directly a function of full state
history $s^t$.

However, after allowing trades, the remarkable feature is
\begin{align*}
  s^t, \tilde{s}^\tau
  \quad\text{s.t.}\quad
  \sum_i y_t^i(s^t)
  = \sum_i y_\tau^i(\tilde{s}^\tau)
  \quad\implies\quad
  c_t^i(s^t) = c_\tau^i(\tilde{s}^\tau)
  \qquad \forall i
\end{align*}
That is, even for compeletely different times $t\neq \tau$, if the state
histories $s^t$, $\tilde{s}^\tau$ are such that \emph{aggregate}
endowments have the same realized value at those times, consumption will
be \emph{the same} for \emph{all agents}.  Only the aggregate endowment,
some time-invariant parameters, and the initial wealth distribution
matter for consumption at any time and state history realization---not
how you got to that aggregate endowment, the cross section of individual
endowment realizations (i.e.\ we observe full insurance), or when you
got to that aggregate endowment.

\clearpage
\subsection{Asset Pricing}

Let $\{d_t(s^t)\}\tinfz$ denote an asset that pays $d_t(s^t)$ units of
the consumption good at time $t$ given state history $s^t$. In other
words, $d_t(\cdot)$ is a function that maps a state history up to $t$,
denoted $s^t$, into $d_t(s^t)$  units of the consumption good at that
time $t$. The asset is a bundle of such functions/contingent claims.

We can price this asset using the prices of contingent claims
\begin{align*}
  P_0^0(s_0)
  =
  \sumtinfz \sum_{s^t} p_t^0(s^t) \cdot d_t(s^t)
\end{align*}
This is the price at time $t=0$ in units of the $t=0$ consumption good.

We let $P^0_\tau$ denote the time-zero price that entitles the owner to
$\{d_t(s^t)\}_{t=\tau}^\infty$ (i.e.\ post-time-$\tau$ payments),
conditional on state $s^\tau$ being realized. It can be priced
\begin{align*}
  P_\tau^0(s^\tau)
  =
  \sumtinfz \sum_{s^t|s^\tau} p_t^0(s^t) \cdot d_t(s^t)
\end{align*}
So given original payment stream $\{d_t(s^t)\}\tinfz$, we strip out all
contingent claims for times $t=0,\ldots,\tau$ and \emph{also}
throw out all contingent claims that correspond to state histories
$\tilde{s}^t$ for $t\geq \tau$ such that $\tilde{s}^\tau \neq s^\tau$.
This is the price at time zero in units of the time-zero consumption
good of an asset that gets the owner all post-$\tau$ payments
$\{d_t(s^t)\}^\infty_{t=\tau}$ if state history $s^\tau$ is realized.

We can re-express this price in units of the time $\tau$ consumption
good (changing notation from $P^0_\tau$ to $P^\tau_\tau$) by computing
\begin{align*}
  P_\tau^\tau(s^\tau)
  =
  \frac{P_0^\tau(s^\tau)}{p_\tau^0(s^\tau)}
  =
  \sumtinfz \sum_{s^t|s^\tau} \frac{p_t^0(s^t)}{p_\tau(s^\tau)} \cdot d_t(s^t)
\end{align*}
This is the equity price you see quoted on the ticker. It is the price
quoted at time $\tau$, given partial history $s^\tau$ up to that time, and in
units of the time-$\tau$ consumption good. You get all dividends
thereafter. It's called the \emph{tail asset}.

\clearpage
\subsection{Sequence of Markets}

Let $\tilde{a}^i_t(s^t)$ represent a contingent claim that pays one unit
of time-$t$ consumption in time $t$ if state history $s^t$ is realized.
\begin{enumerate}
  \item \emph{Sequence of Budget Constraints}:
    We are at some time $t\geq 0$. The state history $s^t$ has been
    realized. The budget constraint is
    \begin{align*}
      \tilde{c}_t^i(s^t)
      + \sum_{s_{t+1}}
      \tilde{a}^i_{t+1}(s_{t+1},s^t)
      \tilde{Q}_t(s_{t+1}|s^t)
      \leq y^i_t(s^t) + \tilde{a}_t^i(s^t)
    \end{align*}
    On the RHS are the total assets agent $i$ has at time $t$. Those
    include the endowment realization $y^i_t(s^t)$ and the claims
    purchased at time $t-1$ that pay units of consumption in this state,
    denoted $\tilde{a}_t^i(s^t)$.

    Given those assets, the agent spends them (as we see on the LHS) on
    current-period consumption $\tilde{c}_t^i(s^t)$ and on contingent
    claims for all possible realizations of tomorrow's state, which is
    captured by the sum over the $\tilde{a}^i_{t+1}(s_{t+1},s^t)$ terms
    that each represent the total payoff to the agent if state $s_{t+1}$
    is realized tomorrow.\footnote{%
      Alternatively, we can think of $\tilde{a}^i_{t+1}(s_{t+1},s^t)$ as
      a real number representing the total number of contingent claims
      purchased which pay up if $s_{t+1}$ is realized tomorrow.
    }
    Sincce the agent is buying and selling the one-period contingent
    claims denoted $\tilde{a}^i_{t+1}(s_{t+1},s^t)$, those values could
    be positive or negative (negative indicates borrowing-on/selling
    future consumption). So to rule out Ponzi schemes, we impose an
    additional constraint
    \begin{align*}
      -\tilde{a}^i_{t+1}(s^{t+1}) \leq
      A^i_{t+1}(s^{t+1})
      :=
      \sum^\infty_{\vphantom{s^\tau|s^{t+1}}\tau = t+1} \sum_{s^\tau|s^{t+1}}
      p^{t+1}_\tau (s^\tau)y_\tau^i(s^\tau)
    \end{align*}
    where $A^i_{t+1}(s^{t+1})$ is the natural debt limit for time $t+1$
    and history $s^{t+1}$.
    It's the value of the tail of agent $i$'s endowment sequence
    conditional on history $s^{t+1}$.
    %That is, if state $s_{t+1}$ is drawn tomorrow to give full state
    %history $s^{t+1}=(s^t,s_{t+1})$, the agent can sell off the right
    %to all future endowments $y_\tau^i(s^\tau)$ conditional on state
    %history $s^{t+1}|s^\tau$.

    Contigent claims prices are given by the pricing kernel
    $\tilde{Q}_t(s_{t+1}|s^t)$, which is the price today at time $t$ of
    a contingent claim that pays one unit of time-$t+1$ consumption at
    time $t+1$ if state $s_{t+1}$ is realized.
\end{enumerate}


\clearpage
\section{Savings Problem}

\subsection{Determistic Problem}

Consumption streams ordered by
\begin{align*}
  U\big(\{c_t\}\tinfz\big)
  = \sumtinfz \beta^tu(c_t)
\end{align*}
Possible ways to write the budget constraint:
\begin{itemize}
  \item
    \emph{Asset Holdings in Units of Time $t$ Consumption}:
    \begin{align*}
      c_t + a_{t+1} = Ra_t + y_t
    \end{align*}
    No-borrowing constraint expressed as
    \begin{align*}
      a_{t+1} \geq 0
    \end{align*}

  \item
    \emph{Asset Holdings in Units of Time $t+1$ Consumption}:
    \begin{align*}
      c_t + R^{-1}a_{t+1} = a_t + y_t
    \end{align*}
    No-borrowing constraint expressed as
    \begin{align*}
      a_{t+1} \geq 0
    \end{align*}

  \item \emph{Total Assets}:
    \begin{align*}
      a_{t+1} = R(a_t-c_t) + y_{t+1}
    \end{align*}
    No-borrowing constraint expressed as
    \begin{align*}
      c_t \leq a_t
    \end{align*}


\end{itemize}

\clearpage
\section{Classical Monetary Model}

Flexible prices are the hallmark of this section, in contrast to the
sticky price New Keynesian models of the next section.

\subsection{The Role of Money}

Throughout most of this section, there's no reason to discuss money
beyond its role as simply a unit of account.
First, we can characterize monetary policy entirely in terms of the
nominal interest rate, so the money stock is a sideshow for monetary
policy. Second, households that derive utility only from consumption
and leisure have no desire to hold money at zero-return when they could
instead buy a positive-return risk-free bond. Money is a dominated
asset, so there's no place for it anyway.

Therefore, if we want to discuss the money supply and monetary policy,
two options:
\begin{enumerate}[label=(\roman*)]
  \item \emph{Add Microfoundations}:
    Try to motivate why households want to hold money. There are several
    ways to do this:
    \begin{itemize}
      \item \emph{Utility Function}: Put real money balances in the
        household utility function
    \end{itemize}
  \item \emph{Append Ad Hoc Money Demand Function}: Punt on the
    microfoundations. In addition to the model equilibrium conditions,
    just append a simple ad-hoc money demand function
    \begin{align*}
      m_t-p_t= c_t - \eta i_t
    \end{align*}
    where $\eta$ is the semielasticity of money demand. A money demand
    function of this form typically results from each of the above
    microfoundations.

\end{enumerate}

\clearpage
\subsection{Household Problem: Cashless Economy}
\label{sec:singlegood}

\subsubsection{Optimality Conditions}

Households take wages $W_t$, prices of a zero-coupon discount bound
$Q_t$, prices $P_t$, profits/dividends from firms $D_t$, and preference
shifter $Z_t$ as given, and choose consumption $C_t$, hours $N_t$, and
bounds $B_t$
\begin{align*}
  \max_{\{C_t,N_t,B_t\}\tinfz} \;
  &\E_0\sumtinfz \beta^t U(C_t,N_t;Z_t) \\
  \text{s.t.}\quad&
  P_tC_t + Q_{t}B_t \leq B_{t-1} + W_tN_t + D_t\quad \forall t\\
  &\limT \E_t\bigg[
    \underbrace{\beta^{T-t} \frac{U_{c,T}}{U_{c,t}}}_{\Lambda_{t,T}}
    \frac{B_T}{P_T}
  \bigg]
  \geq 0
  \qquad \forall t
\end{align*}
where the second constraint is a no-Ponzi condition and
we define $U_t:=U(C_t,N_t;Z_t)$, partial derivatives
$U_{x,t}=\partial U_t/\partial X_t$, and stochastic discount factor
$\Lambda_{t,T}$ between $t$ and $T$.
First order conditions:
\begin{alignat*}{3}
  C_t:&&\quad
  \beta^t U_{c,t} &= \mu_t P_t
  \\
  N_t:&&\quad
  \beta^t U_{n,t} &= -\mu_t W_t
  \\
  B_t:&&\quad
  \mu_t Q_t &= \mu_{t+1}
\end{alignat*}
Divide the FOCs for $C_t$ and $N_t$ by each other, and use the FOC for
$B_t$ to link the $C_t$ and $C_{t+1}$ FOC. This gives optimality
conditions:
\begin{align*}
  -\frac{U_{n,t}}{U_{c,t}}
  &=
  \frac{W_t}{P_{t}} \\
  Q_t &=
  \beta\;
  \E_t\left[
    \frac{U_{c,t+1}}{U_{c,t}}
    \frac{P_t}{P_{t+1}}
  \right]
  \\
  0 &=
  \limT \E_t\bigg[
    \Lambda_{t,T}
    \frac{B_T}{P_T}
  \bigg]
\end{align*}
where the third equation is a TVC. It must hold because if the no-Ponzi
condition held with strict inequality, the consumer could raise
utility by a discrete amount without decreasing future consumption, and
that would violate optimality. So the TVC must hold for an optimal
sequence.

\clearpage
\subsubsection{Log-Linearizing}

We now log-linearize the two household conditions:
\begin{itemize}

  \item \emph{Intratemporal Labor-Consumption Choice}:
    Given real wage $w_t-p_t$, this gives $n_t$ supply\footnote{%
      We see here how $\varphi$ is the inverse Frisch labor supply
      elasticity, since $\varphi$ is the increase in labor supply $n_t$,
      holding constant $c_t$ (hence marginal utility---since that only
      depends on $c_t$ given assumed utility function).
    }
    \begin{align*}
      -\frac{U_{n,t}}{U_{c,t}}
      =
      \frac{W_t}{P_{t}}
      \quad\implies\quad
      \boxed{%
      w_t - p_t
      =
      \varphi n_t
      + \sigma c_t
      }
    \end{align*}

  \item \emph{Intertemporal Consumption Choice}:
    First, we reproduce the optimality condition, using identity
    $x_t=\exp(\ln x_t)$ and subbing in the assumed functional form:
    \begin{align*}
      1 =
      \E_t\left[
        \exp\left\{
        \ln
        \left(
        \frac{U_{c,t+1}}{U_{c,t}}
        \frac{P_t}{P_{t+1}}
        \frac{\beta}{Q_t}
        \right)
        \right\}
      \right]
      %&=
      %\E_t\left[
        %\frac{Z_{t+1}}{Z_{t}}
        %\left(\frac{C_{t+1}}{C_t}\right)^{-\sigma}
        %\frac{P_t}{P_{t+1}}
        %\frac{\beta}{Q_t}
      %\right]
      %\\
      %\iff\quad
      %1
      &=
      \E_t\left[
        \exp\left\{
        \ln
        \left(
        \frac{Z_{t+1}}{Z_{t}}
        \left(\frac{C_{t+1}}{C_t}\right)^{-\sigma}
        \frac{P_t}{P_{t+1}}
        \frac{\beta}{Q_t}
        \right)
        \right\}
      \right]
    \end{align*}
    Using the definition of logged variables, this simplifies to
    \begin{align}
      1
      =&\;
      \E_t\big[
        \exp\big\{
        \underbrace{%
        \Delta z_{t+1}
        -\sigma \Delta c_{t+1}
        - \pi_{t+1}
        -\rho
        + i_t
        }_{=:x_t\quad\implies\quad x = 0 - \sigma g - 0 - \rho + i}
        \big\}
      \big]
      \label{interalmost}
    \end{align}
    where $x$ is the nonstochastic steady state value corresponding to
    $x_t$. To simplify further, we log-linearize the exponential inside
    the expectation
    \begin{align}
      \exp(x_t)
      &\approx \exp(x) + \exp(x)(x_t-x) \notag \\
      &\approx \exp(x) + \exp(x)\big(
        \Delta z_{t+1}
        -\sigma (\Delta c_{t+1}-g)
        - \pi_{t+1}
        + (i_t-i)
      \big) \label{interalmost2}
    \end{align}
    We just left $\exp(x)=\exp(-\sigma g-\rho+i)$ because really, we
    want a simpler expression for it. We can get one if we consider what
    happens when $x_t=x$. Then Equation~\ref{interalmost} says
    \begin{align*}
      x_t=x\quad\implies\quad
      1 = \E_t[\exp(x_t)] = \E_t[\exp(x)] = \exp(x)
      \quad\iff\quad
      x = 0
    \end{align*}
    These simplifications---$\exp(x)=1$ and $x=0$ (which implies
    $g=(i-\rho)/\sigma$)---along with the assumed functional form for
    $z_t$ allow us to simplify Expression~\ref{interalmost2} to
    \begin{align}
      \exp(x_t)
      &\approx 1 + 1\cdot\big(
        (\rho_z-1)z_t+\varepsilon_{t+1}^z
        -\sigma (\Delta c_{t+1}-(i-\rho)/\sigma)
        - \pi_{t+1}
        + (i_t-i)
      \big)
      \notag
      \\
      &\approx 1 + \big(
        (\rho_z-1)z_t+\varepsilon_{t+1}^z
        -\sigma (c_{t+1}-c_t)
        + i_t
        - \pi_{t+1}
        - \rho
      \big)
      \label{interalmost3}
    \end{align}
    Substituting this last approximation for $\exp(x_t)$ into
    Equation~\ref{interalmost}, rearranging, and simplfying, we end up
    with
    \begin{align*}
      \boxed{%
      c_{t}
      =
      \E_t[c_{t+1}]
      -
      \frac{1}{\sigma}
      \big(
      i_t-\E_t[\pi_{t+1}]
      -\rho
      \big)
      +
      \frac{1}{\sigma}
      (1-\rho_z) z_t
      }
      \qquad\text{Real Rate:}\quad
      \boxed{ r_t:=i_t-\E_t[\pi_t] }
    \end{align*}
\end{itemize}

\clearpage
\subsection{Household Problem: Cash Economy, Money in Utility}

In this subsection, we add money to the utility function. This has two
advantages
\begin{enumerate}[label=(\roman*)]
  \item \emph{Money Demand Function}:
    From the first order conditions to this new household problem,
    we can derive a microfounded money demand function
  \item \emph{Welfare Analysis}:
    Suppose we have two different monetary policy rules that deliver
    wildly different price-level fluctuations.
    Since consumption and leisure (the only objects in the above
    household utility function) are entirely pinned down outside of
    monetary policy (as we will see below), the two interest rate rules
    are welfare equivalent.
    Therefore, if we want there to be welfare consequences to
    more volatatile price fluctuations in this classical economy with
    flex prices, we must put money in the utility function.

\end{enumerate}

\subsubsection{Optimality Conditions}
Households solve
\begin{align*}
  \max_{\{C_t,N_t,B_t,M_t\}\tinfz} \;
  &\E_0\sumtinfz \beta^t U(C_t,M_t/P_t,N_t;Z_t) \\
  \text{s.t.}\quad&
  P_tC_t + Q_{t}B_t + M_t
  \leq B_{t-1} + M_{t-1} + W_tN_t + D_t\quad \forall t\\
  &\limT \E_t\bigg[
    \underbrace{\beta^{T-t} \frac{U_{c,T}}{U_{c,t}}}_{\Lambda_{t,T}}
    \frac{B_T+M_t}{P_T}
  \bigg]
  \geq 0
  \qquad \forall t
\end{align*}
Alternatively, we define cash-on-hand $X_t=M_t+B_t$ and rewrite the
budget constraint as
\begin{align*}
  P_tC_t
  + Q_{t}X_t
  + (1-Q_{t})M_t
  \leq X_{t-1} + W_tN_t + D_t
\end{align*}
This makes explicit that $Q_t$ is the price of cash on hand next period
$X_t$, while the price of utility-generating money this period is
$(1-Q_t)\approx i_t$.

In either setup, the problem has first order conditions:
\begin{alignat*}{3}
  C_t:&&\quad
  \beta^t U_{c,t} &= \mu_t P_t \\
  N_t:&&\quad
  \beta^t U_{n,t} &= -\mu_t W_t \\
  B_t:&&\quad
  \mu_t Q_t &= \mu_{t+1} \\
  M_t:&&\quad
  \beta^t \frac{U_{m/p,t}}{P_t}
  &=
  \mu_t - \mu_{t+1}
\end{alignat*}
These conditions yield equilibrium conditions
\begin{align*}
  Q_t &= \beta \E_t\left[
    \frac{U_{c,t+1}}{U_{c,t}}\frac{P_t}{P_{t+1}}
  \right]
  \\
  -\frac{U_{c,t}}{U_{n,t}} &= \frac{P_t}{W_t}
  \\
  \frac{U_{m/p,t}}{U_{c,t}}
  &=
  1 - Q_t
\end{align*}

\clearpage
\subsubsection{Log-Linearizing}

The first two conditions are the same as in the cashless economy. So
let's consider the new equilibrium condition using assumed functional
form from the appendix.
\begin{align*}
  \frac{U_{m/p,t}}{U_{c,t}}
  =
  1 - Q_t
  \quad\iff\quad
  \frac{M_t}{P_t}
  &=
  C_t^{\sigma/\nu}(1 - Q_t)^{-1/\nu}
\end{align*}
We will log-linearize this by writing
\begin{align}
  \frac{M_t}{P_t}
  &=
  C_t^{\sigma/\nu}(1 - e^{-i_t})^{-1/\nu}
  \quad\implies\quad
  m_t - p_t
  =
  \frac{\sigma}{\nu}c_t
  -\frac{1}{\nu}\ln(1 - e^{-i_t})
  \label{classicalmoneydemand}
\end{align}
Define and Taylor-Expand
\begin{align*}
   \ln(1-e^{-x_t}) =: f(x_t)
  &\approx f(x) + f'(x)(x_t-x) \\
  &= \ln(1-e^{-x}) + \frac{e^{-x}}{1-e^{-x}}(x_t-x)
\end{align*}
If we take $x_t=i_t$ and $x=i$, the nominal interest rate in the
nonstochastic steady state, then
\begin{align*}
  \ln(1-e^{-i_t})\approx
  \ln(1-e^{-i})
  + \frac{e^{-i}}{1-e^{-i}}
  (i_t-i)
\end{align*}
Ignore the constant terms: the whole first term and the $f'(i)\cdot i$
part of the second term; the total is just a constant. Though it
will change the value of $m_t-p_t$, the ``mistake'' will be constant
across time and values of $m_t-p_t$, so we will just have to change
our interpretation of $m_t$. Therefore, the log linear version of
Equation~\ref{classicalmoneydemand} is
\begin{align*}
  m_t - p_t
  &\approx
  \frac{\sigma}{\nu}c_t
  - \frac{1}{\nu(e^{i}-1)}
  i_t
  \approx
  \frac{\sigma}{\nu}c_t
  - \frac{1}{\nu i} i_t
\end{align*}
which is often written, after defining $\eta=1/(\nu i)$ (the
semi-interest elasticity of money demand)
\begin{align*}
\boxed{%
  m_t - p_t
  =
  \frac{\sigma}{\nu}c_t
  - \eta i_t
}
  \qquad \text{where}\quad
  \eta = \frac{1}{\nu i}
\end{align*}


\clearpage
\subsection{Househod Problem: Shopping Time Model}

Here's another model that can microfound money demand.
In particular, we suppose that consuming $C_t$
requires shopping time $N_t^s$, which equals
\begin{align*}
  N_t^s=S(C_t,M_t/P_t)
  \qquad \text{where}\;
  \begin{cases}
    S_c > 0 \\
    S_{m/p} \leq 0
  \end{cases}
\end{align*}
Household period utility is given by $V(C_t,L_t)$ where
$L_t=1-N_t-N_t^s$ denotes leisure time not devoted to work/production or
shopping.


\subsubsection{Optimality Conditions}

Given $V(C_t,L_t)$, we can construct implied utility function
\begin{align*}
  U(C_t,M_t/P_t,N_t)
  := V\big(C_t,\;1-N_t-S(C_t,M_t/P_t)\big)
  %=: V_t
\end{align*}
This has first derivatives of
\begin{align*}
  U_{c,t}
  &=
  V_{c,t} - V_{\ell,t}S_{c,t}
  \qquad\quad
  U_{m/p,t}
  =
  -V_{\ell,t} S_{m/p,t}
  \qquad\quad
  U_{n,t}
  =
  -V_{\ell,t}
\end{align*}
Given this definition of $U(C_t,M_t/P_t,N_t)$, the model is now
isomorphic to the model with money in the utility function. In fact, we
can think of that model as a reduced form version of this model.
Thus, it has the same optimality conditions---only now, our derivatives
$U_{\cdot,t}$ are expressed in terms of derivatives of $V_{\cdot,t}$ and
$S_{\cdot,t}$:
\begin{alignat*}{3}
  Q_t &=
  \beta \E_t\left[
    \frac{U_{c,t+1}}{U_{c,t}}\frac{P_t}{P_{t+1}}
  \right]
  &&=
  \beta \E_t\left[
    \frac{V_{c,t+1}-V_{\ell,t+1}S_{c,t+1}}{V_{c,t} - V_{\ell,t}S_{c,t}}\frac{P_t}{P_{t+1}}
  \right]
  \\
  \frac{P_t}{W_t}
  &=
  -\frac{U_{c,t}}{U_{n,t}}
  &&=
  \frac{V_{c,t} - V_{\ell,t}S_{c,t}}{V_{\ell,t}}
  \\
  1 - Q_t
  &=
  \frac{U_{m/p,t}}{U_{c,t}}
  &&=
  -\frac{V_{\ell,t} S_{m/p,t}}{V_{c,t} - V_{\ell,t}S_{c,t}}
\end{alignat*}
Combining the second and third, we can get
\begin{align*}
  \frac{P_t}{W_t}
  &=
  \frac{V_{c,t} - V_{\ell,t}S_{c,t}}{V_{\ell,t}}
  =
  \frac{1}{V_{\ell,t}}
  \left(
  \frac{1}{V_{c,t} - V_{\ell,t}S_{c,t}}
  \right)^{-1}
  =
  \frac{1}{V_{\ell,t}}
  \left(
  -\frac{1-Q_t}{V_{\ell,t}\,S_{m/p,t}}
  \right)^{-1}
  =
  - \frac{S_{m/p,t}}{1-Q_t}
\end{align*}
Hence
\begin{align*}
  -\frac{W_t}{P_t}S_{m/p,t}
  =
  1-Q_t
  \approx i_t
  %\qquad\iff\qquad
  %\frac{U_{n,t}}{U_{c,t}}S_{m/p,t}
  %\approx i_t
\end{align*}
This is another ``marginal benefits equals marginal costs'' condition.
Specifically, the RHS is the cost of holding money over bonds, i.e. the
forgone interest $i_t$. The LHS is the benefit of holding more money,
i.e. the reduction in shopping costs $-S_{m/p,t}$ times the real wage
$W_t/P_t$. By holding more money, you can cut back on work at wage
$W_t/P_t$ that is necessary to cover shopping costs.

\clearpage
\subsection{Household Problem: Cash in Advance Constraint}

This is another model to microfound demand.
Suppose that a household with period utility $U(C_t,N_t)$ faces both a
budget constraint and a cash-in-advance (CIA) constraint:
\begin{align*}
  P_tC_t + Q_tB_t + M_t &\leq B_{t-1} + M_{t-1} + W_tN_t + T_t\\
  P_tC_t &\leq M_{t-1} + T_t
\end{align*}
where $T_t$ is a lump-sum monetary transfer to households.
We see that the household must have enough money $M_{t-1}$ (chosen in
advance at $t-1$) to cover consumption at time $t$, $P_tC_t$.


\clearpage
\subsection{Firm Problem}


Techology is $Y_t=A_tN_t^{1-\alpha}$. Therefore firms choose labor/hours
to maximize profits:
\begin{align*}
  \max_{N_t} \; &P_tY_t - W_tN_t \\
  \text{s.t.} \quad &Y_t =A_tN_t^{1-\alpha}
\end{align*}
The first order condition is
\begin{align*}
  \text{Marginal Cost} =
  \frac{W_t}{P_t} = (1-\alpha) A_t N_t^{-\alpha}
  = \text{Marginal Benefit}
\end{align*}
This has a very simple log-linear form
\begin{align*}
  %\frac{W_t}{P_t} = (1-\alpha)A_t N_t^{-\alpha}
  %\quad\implies\quad
  \boxed{%
  w_t - p_t
  = \ln(1-\alpha) + a_t - \alpha n_t
  }
\end{align*}


\subsection{Equilibrium}

The last piece we need is just a log-linear version of production
technology for the single representative firm:
\begin{align*}
  Y_t = A_t N_t^{1-\alpha}
  \quad\implies\quad
  \boxed{%
  y_t = a_t + (1-\alpha)n_t
  }
  \qquad\text{where}\quad
  a_t = \rho_a a_{t-1} + \varepsilon_t^a
\end{align*}

\subsubsection{Defining Equilibrium}

For given paths of exogenous shocks $\{z_t,a_t\}$, an equilibrium is an
allocation $\{c_t,n_t,y_t\}$ and prices $\{i_t,w_t,p_t\}$ such that
\begin{alignat*}{3}
  \text{Household Optimization}:&&
  \qquad\qquad
      c_{t}
      &=
      \E_t[c_{t+1}]
      -
      \frac{1}{\sigma}
      \big(
      \underbrace{%
      i_t-\E_t[\pi_{t+1}]
      }_{r_t}
      -\rho
      \big)
      +
      \frac{1}{\sigma}
      (1-\rho_z) z_t
      \\
      &&
      \omega_t:=
      w_t - p_t
      &=
      \varphi n_t
      + \sigma c_t
      \\
  \text{Firm Optimality}:&&\quad
      \omega_t:=w_t - p_t &= a_t - \alpha n_t + \ln(1-\alpha)
      \\
  \text{Market Clearing}:&&
    y_t &= c_t \\
    && y_t &= a_t + (1-\alpha)n_t
\end{alignat*}
Since $w_t$ and $p_t$ always enter together, only the real wage
$\omega_t:=w_t-p_t$ can be identified. But notice that the last four
equations pin down the four real endogenous variables in the economy
$\{y_t,n_t,c_t,\omega_t\}$. As a result, they also pin down the
\emph{real} interest rate by the \emph{first} equation, the consumption
Euler Equation:
\begin{align*}
    \underbrace{%
    i_t-\E_t[\pi_{t+1}]
    }_{r_t}
    &=
    \rho
    + \sigma \E_t[\Delta c_{t+1}]
    + (1-\rho_z) z_t
\end{align*}
In the nonstochastic economy, notice that we would have $r_t=\rho$ for
all $t$.

The only things not pinned down are nominal variables
$\{i_t,\E_t\pi_{t+1},w_t,p_t\}$. For that we specify monetary policy.
Notice that monetary policy won't have any \emph{real} effects (which is
why we need to introduce sticky prices later on in the NK model).
Monetary policy simply pins down nominal variables.

\clearpage
\subsubsection{Solving for Real Variables}

Now that we have defined equlibrium, let's solve for the endogenous
variables.

First, we can essentially pin down all real variables by solving two
equations in two unkowns. In particular, combine the intratemporal
household decision and the firm problem (eliminating the real wage
$w_t-p_t$), impose market clearing $c_t=y_t$, and append the log-linear
equation for aggregate production as the second equation:
\begin{align*}
  \varphi n_t + \sigma y_t &= \ln(1-\alpha) + a_t - \alpha n_t
  \\
  y_t &= a_t + (1-\alpha)n_t
\end{align*}
The process for technology $\{a_t\}$ is exogenously given; therefore,
this is a system of two equations in two endogenous unkowns, $y_t$ and
$n_t$. We can solve to get these in terms of constants and the exogenous
process:
\begin{align*}
   n_t
   &= \frac{\ln(1-\alpha)}{\varphi +\alpha+ \sigma(1-\alpha)}
   + \frac{1-\sigma}{\varphi +\alpha+ \sigma(1-\alpha)} a_t
   \\
    y_t
    &=
    \frac{(1-\alpha)\ln(1-\alpha)}{\varphi +\alpha+ \sigma(1-\alpha)}
    + \frac{\varphi + 1}{\varphi +\alpha+ \sigma(1-\alpha)}
      a_t
\end{align*}
From this, we can pin down the real wage, $\omega_t:=w_t-p_t$. In
particular, sub these expressions for $n_t$ and $y_t=c_t$ into the
expression for the intratemporal decision
\begin{align*}
  \omega_t
  &= \varphi n_t + \sigma y_t
  =
  \frac{(\varphi+\sigma(1-\alpha))\ln(1-\alpha)}{\varphi +\alpha+ \sigma(1-\alpha)}
  + \frac{\varphi + \sigma}{\varphi +\alpha+ \sigma(1-\alpha)}
  a_t
\end{align*}
Lastly, now that we have solved for $y_t$ in terms of exogenous
$\{a_t\}$, we can use market clearing $y_t=c_t$ and the intertemporal
Euler Equation to pin down the real rate $r_t = i_t - \E_t[\pi_t]$ in
terms of exogenous $\{a_t,z_t\}$
\begin{align*}
  r_t
  &=
  \rho
  + \sigma\E_t[\Delta y_{t+1}]
  + (1-\rho_z) z_t
  \\
  &=
  \rho
  +
  \frac{\sigma(\varphi + 1)}{\varphi +\alpha+ \sigma(1-\alpha)}
  \E_t\left[\Delta a_{t+1}\right]
  + (1-\rho_z) z_t
  \\
  &=
  \rho
  +
  \frac{\sigma(\varphi + 1)}{\varphi +\alpha+ \sigma(1-\alpha)}
  \E_t\left[(\rho_a-1)a_t+\varepsilon^a_{t+1}\right]
  + (1-\rho_z) z_t
  \\
  \implies\quad
  r_t
  &=
  \rho
  +
  \frac{\sigma(\varphi + 1)(\rho_a-1)}{\varphi +\alpha+ \sigma(1-\alpha)}
  a_t
  + (1-\rho_z) z_t
\end{align*}
From these expressions, we see that $\{n_t,y_t,\omega_t\}$ are all
\emph{invariant} to preference shocks, $\{z_t\}$.
Only the real rate $\{r_t\}$ is affected by preference shocks, which
makes sense, as $z_t$ essentially changes the discount factor from
constant $\beta$ to affect intertemporal decisions (not intratemporal).

\subsection{Monetary Policy through Interest Rate Rules}

In the previous section, we were able to pin down real variables
$\{y_t,n_t,\omega_t,r_t\}$ in terms of exogenous parameters and shocks
$\{a_t,z_t\}$. Only nominal variables were not pinned down. For that, we
need monetary policy.

In particular, we will make use of the fisher equation
\begin{align*}
  i_t = r_t + \E_t\pi_{t+1}
  \quad\implies\quad
  \E_t\pi_{t+1} = i_t - r_t
\end{align*}
With the real rate $r_t$ pinned down by the real side of the economy,
the central bank adjusts $i_t$ to affect expected inflation
$\E_t\pi_{t+1}$.
The Fisher equation and the expression derived above for $r$ makes clear
that, in the nonstochastic steady state,
\begin{align*}
  r = \rho
  \quad\implies\quad
  i = \pi + r = \pi + \rho
  \quad\iff\quad
  \pi = i - \rho
\end{align*}
We now use all this to consider different rules.

\subsubsection{Exogenous Nominal Interest Rate Path}

Suppose that the nominal interest rate is set
\begin{align*}
  i_t &= i + \nu_t
  \qquad\text{where}\quad
  \nu_t = \rho_\nu \nu_{t-1}+\varepsilon_t^\nu
\end{align*}
where $\nu_t$ is a monetary policy shock. Then, the path of
$\E_t\pi_{t+1}$ can be summarized as
\begin{align*}
  \E_t\pi_{t+1} &= i_t - r_t
  \\
  &= i + \nu_t - r_t \\
  \implies\quad
  \E_t\pi_{t+1}
  &= \pi - (r_t-\rho) + \nu_t
\end{align*}
Thus only \emph{expected} inflation is pinned down in terms of
exogenous parameters and variables $\pi,\rho,r_t,\nu_t$.
\emph{Actual} inflation is not pinned down. As a consequence, there are
many possible paths for actual inflation consistent with equilibrium.
Given exogenous monetary shocks $\{\nu_t\}$ and pinned-down path for
$\{r_t\}$,
\emph{any} path of shocks $\{\xi_t\}$ that satisfy $\E_t[\xi_{t+1}]=0$
and the following actual inflation equation
\begin{align*}
  \pi_{t+1}
  &= \pi - (r_t-\rho) + \nu_t  + \xi_{t+1}
  \qquad \E_t[\xi_{t+1}]=0
\end{align*}
will constitute a valid equilibrium.
The sequence of shocks $\{\xi_t\}$ are called ``sunspot shocks'' since
they are divorced from fundamentals (i.e. parameters, exogenous shocks);
they are simply any arbitrary sequence such that $\E_t\xi_{t+1}=0$ and
the above inflation equation is satisfied.

In other words, we have inflation indeterminacy, hence price
indeterminacy, hence indeterminacy of all nominal variables.
This indeterminacy follows because the monetary rule was chosen
\emph{independently} of the real side of the economy. If we change
that, there will not be indeterminacy, as we see for the next rule.

\subsubsection{Simple Taylor Rule}

Suppose that the Fed sets nominal interest rates according to
\begin{align*}
  i_t &= i + \phi_\pi(\pi_t-\pi) + \nu_t
  \qquad\text{where}\quad
  \nu_t = \rho_\nu \nu_{t-1} +\varepsilon^\nu_{t}
  \\
  &= \rho + \pi + \phi_\pi(\pi_t-\pi) + \nu_t
  \qquad \phi_\pi > 0
\end{align*}
Then, expected inflation responds endogenously through the Fisher
equation:
\begin{align*}
  \E_t\pi_{t+1} =
  i_t - r_t
  &=
  \pi + \rho + \phi_\pi(\pi_t-\pi) + \nu_t - r_t
  \\
  &= \pi + \phi_\pi(\pi_t-\pi) - (r_t -\rho) + \nu_t \\
  \implies\quad
  \E_t\hat{\pi}_{t+1}
  &= \phi_\pi\hat{\pi}_t - \hat{r}_t + \nu_t
\end{align*}
Again, $\hat{r}_t$ comes from the real side of the economy, while
the monetary shock $\{\nu_t\}$ is exogenously given. If we ask about
actual inflation $\hat{\pi}_t$, there are a few possibilities
\begin{enumerate}[label=(\roman*)]
  \item $\phi_\pi>1$: We can solve forward the expected inflation
    equation to get
    \begin{align*}
      \hat{\pi}_t
      &=
      \phi_\pi^{-1}
      \big(
      E_t\hat{\pi}_{t+1} + \hat{r}_t - \nu_t
      \big)
      =
      \sum_{k=0}^\infty
      \phi_\pi^{-k-1}
      \E_t[\hat{r}_{t+k}-\nu_{t+k}]
    \end{align*}
    This converges since $\phi_\pi>1$, so we can solve for the
    \emph{unique} nonexplosive equilibrium inflation path
    $\{\pi_t\}$, which imply unique paths for all other nominal
    variables. Simply plug in the expressions for
    $\hat{r}_{t+k}=r_{t+k}-\rho$ and $r_{t+k}$ derived above
    \begin{align*}
      \hat{\pi}_t
      &=
      \sum_{k=0}^\infty
      \phi_\pi^{-k-1}
      \E_t\left[
      \psi_{ra}
      a_{t+k}
      + (1-\rho_z)z_{t+k}
      -\nu_{t+k}
      \right]
      \quad\text{where}\quad
      \psi_{ra}
      :=
      \frac{\sigma(\varphi + 1)(\rho_a-1)}{\varphi +\alpha+ \sigma(1-\alpha)}
      < 0
      \\
      %&=
      %\sum_{k=0}^\infty
      %\phi_\pi^{-k-1}
      %\E_t\left[
      %\psi_{ra}
      %(
      %\rho_a a_{t+k-1} + \varepsilon^a_{t+k}
      %)
      %+ (1-\rho_z)
      %(
      %\rho_z z_{t+k-1} + \varepsilon^z_{t+k}
      %)
      %-\nu_{t+k}
      %\right]
      %\\
      &=
      \sum_{k=0}^\infty
      \phi_\pi^{-k-1}
      \E_t\bigg[
      \psi_{ra}
      \left(
      \rho_a^k a_t
      + \sum_{h=0}^{k-1} \rho_a^h\varepsilon^a_{t+k-h}
      \right)
      + (1-\rho_z)
      \left(
      \rho_z^k z_t
      + \sum_{h=0}^{k-1} \rho_z^h\varepsilon^z_{t+k-h}
      \right)
      \\
      &\qquad\qquad\qquad\qquad
      -
      \left(
      \rho_\nu^k \nu_t
      + \sum_{h=0}^{k-1} \rho_\nu^h\varepsilon^\nu_{t+k-h}
      \right)
      \bigg]
      \\
      &=
      \sum_{k=0}^\infty
      \phi_\pi^{-k-1}
      \big[
      \psi_{ra}
      \rho_a^k a_t
      + (1-\rho_z)
      \rho_z^k z_t
      -\rho_\nu^k\nu_{t}
      \big]
    \end{align*}
    which simplifies to the following value for inflation
    \begin{align*}
      \hat{\pi}_t
      &=
      \frac{\psi_{ra}}{\phi_\pi-\rho_a}a_t
      + \frac{(1-\rho_z)}{\phi_\pi-\rho_z}z_t
      - \frac{1}{\phi_\pi-\rho_v}\nu_t
    \end{align*}
    From this expression, we see that the central bank
    can reduce the volatility of inflation by choosing a larger
    $\phi_\pi$.

  \item $\phi_\pi\in[0,1]$: Here, forward solution does not
    converge. Therefore, we have
    \begin{align*}
      E_t\hat{\pi}_{t+1}
      &= \phi_\pi\hat{\pi}_t - \hat{r}_t + \nu_t \\
      \hat{\pi}_{t+1}
      &= \phi_\pi\hat{\pi}_t - \hat{r}_t + \nu_t + \xi_{t+1}
      \qquad\E_t[\xi_{t+1}]=0
    \end{align*}
    Again, inflation indeterminacy; any path of sunspot shocks
    $\{\xi_t\}$ work.
\end{enumerate}
That we must have $\phi_\pi>1$ for a determinite solution is called
the \emph{Taylor Principle}.

\clearpage
\subsubsection{Money Supply Rule}

If we want to introduce money into monetary policy, we need to link
money to the interest rate (which fully characterizes monetary policy in
this model, as we've seen). The link is given by money demand equation
\begin{align*}
  m_t - p_t = y_t - \eta i_t
\end{align*}
This can be ad hoc or microfounded. But regardless of where this comes
from, we now use it to infer prices given a money supply rule.

Suppose that the central bank sets the money supply $\{m_t\}$ over time.
The money demand equation pins down the price level:
\begin{align*}
  m_t - p_t &= y_t - \eta i_t \\
  \iff\quad
  p_t
  &=
  m_t - y_t + \eta i_t
\end{align*}
No substitute the fisher equation in for $i_t$:
\begin{align*}
  p_t &=
  m_t
  - y_t
  + \eta \big(\E_t[\pi_{t+1}] + r_t\big)
  \\
  \iff\quad
  p_t
  &=
  m_t
  - y_t
  + \eta \big(\E_t[p_{t+1}] - p_t + r_t\big)
\end{align*}
We can rearrange to get
\begin{align*}
  \E_t[p_{t+1}]
  &=
  \left(
  1+
  \frac{1}{\eta}
  \right)p_t
  -
  \frac{m_t}{\eta}
  + \frac{y_t}{\eta}
  - r_t
\end{align*}
Provided that that $\eta>0$, we can solve forward to compute the
uniquely determined price level
\begin{align*}
  p_t
  &=
  \frac{1}{\eta + 1}
  \sum_{k=0}^\infty
  \left(\frac{\eta}{\eta + 1} \right)^k
  \E_t\left[
    m_{t+k}
  - y_{t+k}
  + \eta r_{t+k}
  \right]
\end{align*}

\clearpage
\subsection{Friedman Rule: Optimal Policy with Money in Utility}

\subsubsection{Result}

We consider the model with money in the utility function. The optimal
money policy is that which maximizes the social planner's problem.
Since there is a single representative agent (implying bonds in zero net
supply, $B_t=0$ for all $t$) solving the social planner's problem means
solving a sequence of static problems with no borrowing/lending across
time
\begin{align*}
  \max_{Y_t,N_t,M_t}
  &\;
  U(Y_t,M_t/P_t,N_t;Z_t)
  \qquad
  \text{s.t.}\quad
  Y_t = A_tN_t^{1-\alpha}
\end{align*}
This problem has first order conditions:
\begin{align}
  -\frac{U_{n,t}}{U_{c,t}}
  &= (1-\alpha)A_tN_t^{-\alpha}
  \qquad\qquad
  U_{m/p,t} = 0
  \label{friedmansp}
\end{align}
The first condition is standard: there should be an optimal tradeoff
between the benefits of labor/production and the cost of lost leisure.

The second condition, Equation~\ref{friedmansp}, is new and interesting.
Money is costless to produce and there is no constraint limiting
the quantity of money; therefore, the SP should equate the
marginal benefit of real money balances $U_{m/p,t}$ and the social
marginal cost, zero.

Now let's again consider the decentralized economy: Can the
decentralized equilibrium produce the same allocations as the SP
equlibrium? Well, the first optimality condition of the SP problem is
clearly satisfied in the decentralized equilibrium, where the real wage
$\omega_t=m_t-p_t$ adjusts to ensure that firms and households equate
the marginal benefit (production/output) with the household's marginal
cost. As for the second equation, recall the household FOC for real
money balances in the decentralized equilibrium:
\begin{align}
  \frac{U_{m/p,t}}{U_{c,t}} &= 1-Q_t
  = 1 - \exp\{-i_t\}
  \label{friedmanhh}
\end{align}
Equation~\ref{friedmanhh} reproduces Equation~\ref{friedmansp} iff
$i_t=0$ for all $t$, which brings us to our definition.

\begin{defn}(Friedman Rule)
The \emph{Friedman Rule} says that the central bank should adopt a
monetary policy that implies/results in $i_t=0$ holds for all $t$.
By the Fisher equation, this implies steady state deflation $\pi=-\rho$.
\end{defn}
\begin{rmk}
Subtle point:
The Friedman Rule does \emph{not} say that the central bank should adopt
nominal interest rate rule $i_t=0$. Rather, it says the central bank
should set a nominal interest rate rule
\emph{such that $i_t=0$ is a consequence of the rule}.
The ``rule'' in ``Friedman Rule'' refers \emph{not} to a specific
interest rate rule, but to the ``rule'' that average deflation $-\rho$
is optimal. More on this in the next subsection.
\end{rmk}

To understand the rationale in the decentralized equlibrium, recall the
budget constraint to the household problem written in terms of cash on
hand:
\begin{align*}
  P_tC_t
  + Q_{t}X_t
  + (1-Q_{t})M_t
  \leq X_{t-1} + W_tN_t + D_t
\end{align*}
As we see, the private marginal cost of buying one unit of money $M_t$
is $1-Q_t\approx i_t$ since holding money means foregoing interest
from buying bonds instead.
But if the nominal rate $i_t=0$, the opportunity cost is wiped out
entirely.


\clearpage
\subsubsection{Implementation}

Lastly, we want to implement the Friedman rule, ensuring $i_t=0$ for all
$t$. There are two approaches the central bank could take.
\begin{itemize}
  \item \emph{Use Rule $i_t=0$ Directly}:
    Of course, if the central bank uses monetary policy rule $i_t=0$, it
    is obvious that $i_t=0$ will hold for all $t$, satisfying the
    Friedman rule.

    \emph{However}, a constant interest rate implies nominal
    indeterminacy with sunspot shocks, as shown before, which might be
    undesirable. But again, there are no welfare consequences since
    $y_t$, $n_t$, and $m_t-p_t$ (which are the only things that matter
    for welfare) are pinned down by technology and $i_t$. We can resolve
    nominal indeterminacy through the next approach.

  \item \emph{Impose Rule where $i_t=0$ is a Consequence}:
    Rather than have the central bank use nominal interest rate rule
    $i_t=0$, the central bank could instead impose a more complicated
    rule that merely \emph{implies} $i_t=0$ for all $t$
    \emph{as a consequence of the rule}.

    In general, any rule such that $\pi_t$ adjusts one-for-one with
    $-r_{t-1}$ implies $i_t=0$ as a consequence, thus satisfying the
    Friedman rule.

\end{itemize}

\begin{ex}(Second Approach)
For example, suppose the central bank adopts rule
\begin{align*}
  i_t=\phi(r_{t-1}+\pi_t)\qquad \text{where}\quad \phi>1
\end{align*}
Now simply compute $\E_t[i_{t+1}]$.
\begin{align*}
  \E_t[i_{t+1}]
  =
  \E_t[\phi(r_t + \pi_{t+1})]
  = \phi(r_t+\E_t[\pi_{t+1}])
  =
  \phi i_t
\end{align*}
We got the last equality by using the Fisher equation. Thus,
computing $\E_t[i_{t+1}]$ according to the bank's interest rate rule
revealed a first order difference equation that must hold for
$\{i_t\}$.  Since $\phi>1$, the only non-explosive solution to this
difference equation (hence the only one we care about) is $i_t=0$,
satisfying the Friedman Rule. Moreover, this rule implies
$\pi_t=-r_{t-1}$ resolving nominal indeterminacy.

We see how this differs from the first approach. Rather than just
impose nominal interest rate rule $i_t=0$, the central bank imposed
rule $i_t=\phi(r_{t-1}+\pi_t)$ that, in theory, could deliver an
$i_t\neq 0$.  \emph{But} the exact structure/specification of this
rule was such that the only non-explosive equilibrium consistent
with the rule implies $i_t=0$.

In the first approach, $i_t=0$ was the rule. In the example of the
second approach, $i_t=\phi(r_{t-1}+\pi_t)$ was a rule with $i_t=0$ the
result of that rule.
\end{ex}





\clearpage
\section{New Keynesian Model}

\subsection{Introducing Sticky Prices}

We want an environment with sticky prices and inflation grounded in
firms' price setting decisions.
%Therefore, we opt for monopolistic competition with CES aggregation.
%There will be a continuum of firms producing differentiated goods.
%Demand is not totally elastic, so firms have some pricing power.
Therefore, we assume a continuum of differentiated goods firms
indexed by $i\in[0,1]$, each producing output $Y_t(i)$ sold at
price $P_t(i)$. The price $P_t(i)$ is optimally chosen by firm $i$
subject to production technology and a demand curve that's only
partially price-elastic, i.e.\ each firm $i$ is a monopolitistic
competitor.
Either directly or indirectly (more on this in a second), the consumer
is consuming nonzero amounts of all goods being produced.

There are two places we could put the CES aggregation that drives the
monopolitistic competition. Both are used interchangeably and are
\emph{entirely equivalent} in that they imply an identical demand curve
for the monopolitistically competitive firm producing $Y_t(i)$.
\begin{enumerate}[label=(\roman*)]
  \item \emph{CES Utility with Consumer Aggregation}:
    This is the case we use throughout this section where the consumer
    directly consumes each differentiated good, choosing $C_t(i)$ given
    price $P_t(i)$ for all $i$.
    Utility is derived from CES-aggregated $C_t$ as follows:
    \begin{align*}
      \E_0\sumtinfz \beta^t U(C_t,N_t;Z_t)
      \qquad\text{where}\quad
      C_t =
      \left[ \int_0^1 C_t(i)^{\frac{\epsilon-1}{\epsilon}}\;di
      \right]^{\frac{\epsilon}{\epsilon-1}}
    \end{align*}
    As we'll see, optimality will imply a demand curve for $C_t(i)$
    \begin{align*}
      C_t(i)
      \left( \frac{P_t(i)}{P_t} \right)^{-\epsilon}
      C_t
    \end{align*}
    Market clearing imposes $Y_t(i)=C_t(i)$.

  \item \emph{Two Sectors with Final Goods Firm Aggregation}:
    Here, the monopolistically competitive firms are part of some
    \emph{intermediate goods sector}. All such firms set their price
    $P_t(i)$ and sell their output $Y_t(i)$ to a single representative
    \emph{final goods sector} firm that behaves competitively (price
    taker in inputs and outputs) to transform intermediate goods
    $Y_t(i)$ into final good $Y_t$, sold at market price $P_t$.  The
    final goods firm solves
    \begin{align*}
      \max_{Y_t(i)} &\; P_tY_t - \intzo P_t(i)Y_t(i)\;di \\
      \text{s.t}\quad &
      Y_t = \left(
        \intzo Y_t(i)^{\frac{\varepsilon-1}{\varepsilon}}
        \; di
      \right)^{\frac{\varepsilon}{\varepsilon-1}}
    \end{align*}
    Turns out, the final goods firm has exactly the same demand curve
    for input $Y_t(i)$ that the household in case (i) has for $C_t(i)$.
    \begin{align*}
      Y_t(i)
      \left( \frac{P_t(i)}{P_t} \right)^{-\epsilon}
      Y_t
    \end{align*}
    And now, the consumer eats only final good $Y_t$, solving the
    single-good household problem of Section~\ref{sec:singlegood}.
    Market clearing is $C_t=Y_t$.
\end{enumerate}
Both are equivalent: Firm $i$ producing $Y_t(i)$ faces the exact same
demand curve and price-setting maximization problem whether selling
direct to consumers or to a final goods firm.



\subsection{Household Problem: Cashless Economy, Differentiated Goods}
\label{sec:diffgood}

\subsubsection{Deriving Demand for Differentiated Goods}

We can introduce multiple differentiated goods quite easily by embedding
them in the framework in the last subsection. In particular, modify the
household problem to
\begin{align*}
  \max_{\{C_t(i),N_t,B_t\}\tinfz} \;
  &\E_0\sumtinfz \beta^t U(C_t,N_t;Z_t) \\
  \text{s.t.}\quad&
  \int_0^1 P_t(i)C_t(i)\; di + Q_{t}B_t \leq B_{t-1} + W_tN_t + D_t\quad \forall t\\
  & C_t =
    \left[ \int_0^1 C_t(i)^{\frac{\epsilon-1}{\epsilon}}\;di
    \right]^{\frac{\epsilon}{\epsilon-1}}
\end{align*}
Our strategy will be to determine the optimal consumption (a demand
curve) for good $C_t(i)$ in terms of aggregate consumption $C_t$,
aggregate prices $P_t$, and good price $P_t(i)$. Then, we will
substitute this demand curve back into the optimization problem and
rewrite things simply as a choice of aggregate $C_t$, not each $C_t(i)$
(we use the demand curve for that).

Start with the FONC with respect to $C_t(i)$
\begin{align*}
  C_t(i):\qquad
  \beta^t U_{c,t}
  \left[ \int_0^1 C_t(i)^{\frac{\epsilon-1}{\epsilon}}\;di
  \right]^{\frac{1}{\epsilon-1}}
  \; C_t(i)^{-\frac{1}{\epsilon}}
  = \mu_t P_t(i)
\end{align*}
Note that $U_{c,t}$ is the same for $C_t(i)$ and $C_t(j)$
because it's the partial derivative of $U(\,\cdot\,)$ w.r.t.  the first
argument evaluated at aggregate $C_t$. Dividing the FOC for $C_t(i)$ by
that for $C_t(j)$:
\begin{align*}
  %\left(
  %\frac{C_t(i)}{C_t(j)}
  %\right)^{-\frac{1}{\epsilon}}
  %= \frac{P_t(i)}{P_t(j)}
  %\quad\implies\quad
  C_t(i)
  =
  \left(
  \frac{P_t(i)}{P_t(j)}
  \right)^{-\epsilon}
  C_t(j)
\end{align*}
This writes $C_t(i)$ in terms of reference good $C_t(j)$ and relative
prices. Sub this $C_t(i)$ expression into the expression that defines
aggregate $C_t$ and simplify
\begin{align*}
  C_t
  =
  \left[
    \int_0^1
    \left[
    \left(
    \frac{P_t(i)}{P_t(j)}
    \right)^{-\epsilon}
    C_t(j)
    \right]^{\frac{\epsilon-1}{\epsilon}}
    \;di
  \right]^{\frac{\epsilon}{\epsilon-1}}
  =
  C_t(j)
  P_t(j)^\epsilon
  \left[
    \int_0^1
    P_t(i)^{1-\epsilon}
    \;di
  \right]^{\frac{\epsilon}{\epsilon-1}}
\end{align*}
Flip around and get $C_t(j)$ in terms of $C_t$ and prices, defining
price index $P_t$ along the way:
\begin{align}
  \text{Demand Curve:}\quad
  \boxed{%
  C_t(j)
  %=
  %\frac{P_t(i)^{-\epsilon}}{%
    %\left[
      %\int_0^1
      %P_t(i)^{1-\epsilon}
      %\;di
    %\right]^{\frac{\epsilon}{\epsilon-1}}
  %}
  %\;
  %C_t
  =
  \left( \frac{P_t(j)}{P_t} \right)^{-\epsilon}
  C_t
  }
  \qquad\text{Price Index:}\;\;
  \boxed{%
  P_t :=
    \left[
      \int_0^1
      P_t(i)^{1-\epsilon}
      \;di
    \right]^{\frac{1}{1-\epsilon}}
  }
  \label{nkdemandprice}
\end{align}

\clearpage
\subsubsection{Rewriting as a Single Good Problem}

We will now find a way to rewrite this problem so that it looks like the
single good problem, allowing us to reuse the optimality conditions.
So first, plug demand curve into the integral defining the total cost of
consumption $\int_0^1 P_t(i)C_t(i)\;di$:
\begin{align*}
  \int_0^1 P_t(i)C_t(i)\; di
  =
  \int_0^1 P_t(i)
  \left( \frac{P_t(i)}{P_t} \right)^{-\epsilon}
  C_t
  \; di
  =
  C_t P_t^{\epsilon}
  \int_0^1 P_t(i)^{1-\epsilon}
  \; di
  =
  C_t P_t^{\epsilon}
  P_t^{1-\epsilon}
  = C_tP_t
\end{align*}
Thus, the Household Problem can be rewritten exactly as in the
single-good case:
\begin{align*}
  \max_{\{C_t,N_t,B_t\}\tinfz} \;
  &\E_0\sumtinfz \beta^t U(C_t,N_t;Z_t)
  \\
  \text{s.t.}\quad&
  P_tC_t + Q_{t}B_t \leq B_{t-1} + W_tN_t + D_t\quad \forall t
\end{align*}
Hence we have \emph{exactly} the same optimality conditions as
in the single-good, classical model:
\begin{align*}
  Q_t &=
  \beta\;
  \E_t\left[
    \frac{U_{c,t+1}}{U_{c,t}}
    \frac{P_t}{P_{t+1}}
  \right]
  \\
  -\frac{U_{n,t}}{U_{c,t}}
  &=
  \frac{W_t}{P_{t}} \\
  0 &=
  \limT \E_t\bigg[
    \Lambda_{t,T}
    \frac{B_T}{P_T}
  \bigg]
  %\\
  %C_t(i) &=
  %\left( \frac{P_t(i)}{P_t}\right)^{-\epsilon} C_t
  %\\
  %P_t &= \left[\int_0^1
  %P_t(i)^{1-\epsilon}\;di\right]^{\frac{1}{1-\epsilon}}
\end{align*}
We just need now also need to append our the demand curve and price
level from Expression~\ref{nkdemandprice} to complete our description of
the model.

The three optimality conditions that match those of the single-good
classical case obviously have the same log-linearization.
So nothing new really.


\clearpage
\subsection{Firm Problem with Monopolistic Competition}

We now focus on the firms producing differentiated output.
As derived in the household problem, they all face demand function
(with associated derivative with respect to price)
\begin{align}
  \text{Demand:}\quad
  Y_t(i) = Y_t\left(\frac{P_t(i)}{P_t}\right)^{-\varepsilon}
  \implies\quad
  \frac{\partial Y_t(i)}{\partial P_t(i)}
  %=
  %-\varepsilon \frac{Y_t}{P_t}
  %\left(\frac{P_t(i)}{P_t}\right)^{-\varepsilon-1}
  =
  -\varepsilon
  \frac{Y_t(i)}{P_t(i)}
  \label{nkdemand}
\end{align}
Each intermediate goods firm operates identical production technology:
\begin{align}
  Y_t(i) &= A_t N_t(i)^{1-\alpha}
  \quad\implies\quad
  N_t(i) = \left(\frac{Y_t(i)}{A_t}\right)^{\frac{1}{1-\alpha}}
  \label{nklabor}
  \\
  \ln A_t = a_t &= \rho_a a_{t-1} + \varepsilon_t^a
  \notag
\end{align}
where level of technology $A_t$ is common to all firms and taken as
given.
We now use this to define a few objects related to the technology.

First, the expression for $N_t(i)$ above (to produce $Y_t(i)$ units of
output) lets us define the (nominal) total and marginal cost of
production
\begin{align}
  \calC_t\big(Y_t(i)\big) &=
  W_t
  N_t(i)=
  W_t
  \left(\frac{Y_t(i)}{A_t}\right)^{\frac{1}{1-\alpha}}
  \label{nkcost}
  \\
  \Psi_t(i) :=
  \calC'_t\big(Y_t(i)\big) &=
  \frac{W_t}{(1-\alpha)A_t}
  \left(\frac{Y_t(i)}{A_t}\right)^{\frac{\alpha}{1-\alpha}}
  =
  \frac{W_tN_t(i)^{\alpha}}{(1-\alpha)A_t}
  \notag
\end{align}
Accordingly, we define average real marginal cost, letting $\Psi_t$
denote the average (nominal) marginal cost across firms:
\begin{align*}
  (MC)_t
  =
  \frac{\Psi_t}{P_t}
  \qquad
  (mc)_t = \psi_t - p_t
\end{align*}
It will be useful to define some terms related to the ``markup'' (we'll
see where the name comes from below):
\begin{align*}
  \mu := \frac{\varepsilon}{\varepsilon-1} > 1
  \qquad
  \tilde{\mu} := \ln(\mu)
  \qquad
  \tilde{\mu}_t
  := \ln P_t - \ln\Psi_t
  = p_t - \psi_t
  = -(mc)_t
\end{align*}
Finally, just a quick thing to note.
Since labor is the only input, we see that the marginal cost equals the
wage times the inverse of the marginal product of labor, which is given
by
\begin{align*}
  \text{Marginal Product of Labor:}\quad\quad
  \frac{\partial Y_t(i)}{\partial N_t(i)}
  =&\;
  (1-\alpha) A_tN_t^{-\alpha}
  = \frac{W_t}{\Psi_t(i)}
\end{align*}
%We can also define unit labor cost. In the special case of CRS
%($\alpha=0$), it is apparaent that unit labor cost equals the marginal
%cost
%\begin{align*}
  %\text{(Unit Labor Cost)}
  %= \frac{\calC_t\big(Y_t(i)\big)}{Y_t(i)}
  %= \frac{W_t}{A_t^{1/(1-\alpha)}}Y_t(i)^{\frac{\alpha}{1-\alpha}}
%\end{align*}
Now we move onto the firm problem in the different price setting cases.
Each firm will take $Y_t$, $P_t$, and Demand Curve~(\ref{nkdemand}) as
given. When they can change prices, they choose $P_t(i)$ to max the
expected discounted sum of future profits. That price choice will pin
down a quantity $Y_t(i)$ through Demand Curve~(\ref{nkdemand}), while
Equation~\ref{nklabor} pins down the amount of labor $N_t(i)$ that must
be hired to produce that quantity.

\clearpage
\subsection{Flexible Prices}

Differentiated goods firms face a sequence of static problems in each
period
\begin{align*}
  \max_{P_t(i)}
  \;&P_t(i)Y_t(i) - \calC_t(Y_t(i)) \\
  \text{s.t.}&\; (\ref{nkdemand})
  ,\;(\ref{nkcost})
\end{align*}
Recall that $Y_t(i)$ is a function of $P_t(i)$ as given by the
demand function in Equation~\ref{nkdemand}. We can use that formula
and the formula for demand's derivative (with respect to $P_t(i)$)
to compute the FOC:
\begin{align*}
  0 &=
  Y_t(i)
  + P_t(i)\frac{\partial Y_t(i)}{\partial P_t(i)}
  - \calC_t'(Y_t(i))\frac{\partial Y_t(i)}{\partial P_t(i)}
  \\
  &=
  Y_t(i)
  - \varepsilon Y_t(i)
  + \varepsilon\;
  \Psi_t(i)
  \frac{Y_t(i)}{P_t(i)}
\end{align*}
This can be simplified and rearranged to
\begin{align*}
  P_t(i)
  &=
  \frac{\varepsilon}{\varepsilon-1}
  \;
  \Psi_t(i)
  =
  \mu\;
  \Psi_t(i)
\end{align*}
Here we see where the markup term $\mu$ gets it's name: the nominal
price $P_t(i)$ is a constant markup $\mu$ over and above nominal
marginal cost $\Psi_t(i)$. We can also divide through by
$P_t$ on both sides, and express real price as a constant markup
over real marginal cost:
\begin{align*}
  \frac{P_t(i)}{P_t}
  &=
  \mu\;
  \frac{\Psi_t(i)}{P_t}
\end{align*}
Assuming all firms identical, we focus on a symmetric equilibrium
with $P_t(i)=P_t$ and $\Psi_t(i)=\Psi_t$ for all $i$ implying
\begin{align*}
  \frac{\Psi_t}{P_t}
  &=
  \frac{1}{\mu}
\end{align*}
Thus, we have constant real marginal costs $(mc)_t=-\tilde{\mu}$ or,
equivalently, constant markups over time $\tilde{\mu}_t=\tilde{\mu}$
in this economy with monopolistically competitive firms, but flexible
prices.



\clearpage
\subsection{Rotemberg Quadratic Price Setting}

Now we consider the case where firms can \emph{always} change price, but
at a cost that depends on the magnitude of the change\footnote{%
  This differs from \emph{menu costs}, where the \emph{size} of the
  price adjustment does not impact the \emph{cost}.
  If you pay the fixed cost to change menus, you can change as much
  as you want---no marginal cost to larger changes.
}
This is a \emph{state-dependent} (not \emph{time-dependent}) pricing
scheme.


\subsubsection{Optimal Price-Setting Problem}


We again solve the problem a firm choosing which price to set, except
the problem is now linked across time periods (rather than a sequence of
static problems). We will write the problem recursively
\begin{align*}
  v\big(P_{t-1}(i)\big)
  =
  \max_{P_t(i)}
  \big[
  P_t(i)Y_t(i) - \calC_t(Y_t(i))
  \big]
  - \frac{1}{2}\theta
  \left(
  \frac{P_t(i)}{P_{t-1}(i)}-1
  \right)^2 P_tY_t
  + \E_t\left[\Lambda_{t,t+1}\;v\big(P_t(i)\big)\right]
\end{align*}
The first group of terms is period profits.  The second term is the
cost of price adjustment in terms of the cost of total final output,
which is governed by $\theta$, a measure of price stickiness.
We use the discount factor $\Lambda_{t,T}=\beta^{T-t}
\frac{U_{c,T}}{U_{c,t}}\frac{P_t}{P_T}$ to discount future profits.
This is the ``correct'' rate of discounting because firms are owned
by households; therefore, firms should discount future profits at
the same rate as households.

The RHS has FOC given by
\begin{align*}
  0 &=
  Y_t(i)
  + P_t(i)\frac{\partial Y_t(i)}{\partial P_t(i)}
  - \calC_t'(Y_t(i))\frac{\partial Y_t(i)}{\partial P_t(i)}
  -
  \theta
  \left(
  \frac{P_t(i)}{P_{t-1}(i)}-1
  \right) \frac{P_tY_t}{P_{t-1}(i)}
  + \E_t\big[
    \Lambda_{t,t+1}v'\big( P_t(i) \big)
  \big]
\end{align*}
Substituting in for the partial derivative, we get
\begin{align*}
  0
  &=
  \left[
  (1-\varepsilon)
  + \varepsilon \;\frac{\Psi_t(i)}{P_t(i)}
  \right]Y_t(i)
  -
  \theta
  \left(
  \frac{P_t(i)}{P_{t-1}(i)}-1
  \right) \frac{P_tY_t}{P_{t-1}(i)}
  + \E_t\big[
    \Lambda_{t,t+1}v'\big( P_t(i) \big)
  \big]
\end{align*}
The envelope condition of the Bellman Equation is given by
\begin{align*}
  v'(P_{t-1}(i))
  &= \theta\left(
    \frac{P_t(i)}{P_{t-1}(i)}-1
  \right)
  \frac{P_t(i)}{P_{t-1}(i)^2}
  P_tY_t
\end{align*}
Combine the FOC and evelope condition, use the fact that
all firms are identical (so we can look for a symmetric equilibrium)
to substitute $\Psi_t(i)=\Psi_t$ and $Y_t(i)=Y_t$ and $P_t(i)=P_t$,
define and substitute $\Pi_t=P_t/P_{t-1}$, divide by
$Y_t(\varepsilon-1)$, and rearrange to
\begin{align*}
  0
  &=
  -1 +
  \frac{\varepsilon}{\varepsilon-1}
  \;\frac{\Psi_t}{P_t}
  -
  \frac{\theta}{\varepsilon-1}
  \left(
  \Pi_t-1
  \right) \Pi_t
  + \frac{\theta}{\varepsilon-1} \E_t\big[
    \Lambda_{t,t+1}
    \left(
    \Pi_{t+1}-1
    \right)
    \Pi_{t+1}^2
    \frac{Y_{t+1}}{Y_t}
  \big]
\end{align*}
We will log-linearize this below

\subsubsection{Log-Linearizing}

    We want to log-linearize the price-setting FOC
    \begin{align*}
      0 &=
      \underbrace{%
        -1 + \frac{\varepsilon}{\varepsilon-1}
        \frac{\calC'_t(Y_t)}{P_t}
      }_{(i)}
      -
      \frac{\theta}{\varepsilon-1}
      \underbrace{%
        \vphantom{%
          -1 + \frac{\varepsilon}{(\varepsilon-1)(1-\alpha)} M_t
            Y_t^{\frac{\alpha}{1-\alpha}}
        }
        \left(
        \Pi_t-1
        \right)
        \Pi_t
      }_{(ii)}
      +
      \frac{\theta}{\varepsilon-1}
      \E_t\bigg[
      \underbrace{%
        \vphantom{%
          -1 + \frac{\varepsilon}{(\varepsilon-1)(1-\alpha)} M_t
            Y_t^{\frac{\alpha}{1-\alpha}}
        }
        \Lambda_{t,t+1}\;
        (\Pi_{t+1}-1)\Pi^2_{t+1}\frac{Y_{t+1}}{Y_t}
      }_{(iii)}
      \bigg]
    \end{align*}
    We go term by term. First
    \begin{enumerate}[label=(\roman*)]
      \item Recall the definition of the markup
        $\mu=\frac{\varepsilon}{\varepsilon-1}$ and that the flexible
        price marginal cost is $1/\mu$. Hence, for real marginal
        cost $\calC'_t(Y_t)/P_t$ close to $1/\mu$, we can approximate
        \begin{align*}
          -1 +
          \frac{\varepsilon}{\varepsilon-1}\frac{\calC'_t(Y_t)}{P_t}
          \approx \ln\left(
            \frac{\varepsilon}{\varepsilon-1}
            \frac{\calC'_t(Y_t)}{P_t}
            \right)
          = \psi_t - \mu =: \tilde{\psi}_t
        \end{align*}
        where $\psi_t:=\ln(\calC'_t(Y_t)/P_t)$, real marginal cost.

      \item Next, we linearize the function
        \begin{align*}
          F(x_t) = (x_t-1)x_t
        \end{align*}
        about the zero-inflation steady state $\Pi=1$ up to a first
        order approximation:
        \begin{align*}
          F(\Pi_t)
          &\approx F(\Pi) + F'(\Pi)(\Pi_t-\Pi)
          \\
          &= \Pi + (2\Pi-1)(\Pi_t-\Pi)
          \\
          \text{$\Pi=1$}\implies\qquad
          &= \Pi_t-1
        \end{align*}
        For $\Pi_t$ close to one, we can approximate this by
        \begin{align*}
          (\Pi_t-1)\Pi_t
          \approx \Pi_t-1 \approx \log(\Pi_t) = \pi_t
        \end{align*}

      \item
        To log-linearize (iii)
        \begin{align*}
          (iii)
          =
          \Lambda_{t,t+1}\;
          (\Pi_{t+1}-1)\Pi^2_{t+1}\frac{Y_{t+1}}{Y_t}
        \end{align*}
        we need to make an assumption on the utility function, whose
        derivatives enter into the stochastic discount factor. We assume
        separable power utility, which gives (with market clearing
        $C_t=Y_t$)
        \begin{align*}
          (iii)
          &=
          \bigg[
          \underbrace{%
          \beta\left(\frac{Y_{t+1}}{Y_t}\right)^{-\sigma}
          \Pi_{t+1}^{-1}
          \frac{Z_{t+1}}{Z_t}
          }_{\Lambda_{t,t+1}}
          \bigg]
          (\Pi_{t+1}-1)\Pi^2_{t+1}\frac{Y_{t+1}}{Y_t}
          \\
          &=
          \beta\left(\frac{Y_{t+1}}{Y_t}\right)^{1-\sigma}
          \frac{Z_{t+1}}{Z_t}
          (\Pi_{t+1}-1)\Pi_{t+1} \\
          &=
          \beta
          \left[
          \left(\frac{Y_{t+1}}{Y_t}\right)^{1-\sigma}
          \frac{Z_{t+1}}{Z_t}
          \Pi_{t+1}^2
          -
          \left(\frac{Y_{t+1}}{Y_t}\right)^{1-\sigma}
          \frac{Z_{t+1}}{Z_t}
          \Pi_{t+1}
          \right]
          \\
          &=
          \beta
          \bigg[
          \exp\big\{
          (1-\sigma)\Delta y_{t+1}
          + \Delta z_{t+1}
          + 2\pi_{t+1}
          \big\}
          -
          \exp\big\{
          (1-\sigma)\Delta y_{t+1}
          + \Delta z_{t+1}
          + \pi_{t+1}
          \big\}
          \bigg]
        \end{align*}
        Now we will linearize the functions in brackets, which can be
        written as
        \begin{align*}
          F(\Delta y_{t+1}, \Delta z_{t+1}, \pi_{t+1})
          &\approx
          \exp\big\{
          (1-\sigma)\Delta y_{t+1}
          + \Delta z_{t+1}
          + k\pi_{t+1}
          \big\}
        \end{align*}
        We will now do a first-order Taylor expansion of $F$ about the
        nonstochastic ($\Delta z_{t+1}=0$), zero inflation
        ($\pi_{t+1}=0)$, balanced growth ($\Delta y_{t+1}=g_y$) steady
        state:
        \begin{align*}
          F(\Delta y_{t+1}, \Delta z_{t+1}, \pi_{t+1})
          &\approx
          F(g_y,0,0)
          + F_y(g_y,0,0)(\Delta y_{t+1}-g_y)
          \\
          &\qquad
          + F_z(g_y,0,0)(\Delta z_{t+1}-0)
          + F_\pi(g_y,0,0)(\pi_{t+1}-0)
          \\
          &= e^{(1-\sigma)g_y}
          \left[
            1+(1-\sigma)(\Delta y_{t+1}-g_y)
            + \Delta z_{t+1}
            + k\pi_{t+1}
          \right]
        \end{align*}
        Therefore, (iii) can be written in log-linear form as
        \begin{align*}
          (iii) \approx
          \beta e^{(1-\sigma)g_y}\pi_{t+1}
        \end{align*}
    \end{enumerate}
    Putting everything together, the log-linear first order condition is
    \begin{align*}
      0 &=
      (m_t-\mu)
      - \frac{\theta}{\varepsilon-1} \pi_t
      + \frac{\theta}{\varepsilon-1}\tilde{\beta}\E_t[\pi_{t+1}]
      \qquad \tilde{\beta} := \beta e^{(1-\sigma)g_y}
    \end{align*}
    This is a first order linear difference equation in $\pi_t$, which
    we can solve forward to get
    \begin{align*}
       \pi_t
      %&=
      %\frac{\varepsilon-1}{\theta}(m_t-\mu)
      %+\tilde{\beta}\E_t[\pi_{t+1}] \\
      &=
      \frac{\varepsilon-1}{\theta}
      \sum_{k=0} \tilde{\beta}^k
      \E_t[\tilde{m}_{t+k}]
      \qquad\text{where}\quad
      \tilde{m}_{t+k} = m_{t+k}-\mu
    \end{align*}
    We get
    \begin{align*}
      \pi_t &= \tilde{\beta}\;\E_t\pi_{t+1} + \lambda \tilde{m}_t
      \\
      \text{where}\quad
      \tilde{\beta} &=
        \beta e^{(1-\sigma)g_y} \\
      \lambda &=
        \frac{\varepsilon-1}{\theta}
    \end{align*}


\clearpage
\subsection{Calvo (1983)}

We now turn the Calvo \emph{time-dependent} price-setting scheme.
In any given period, a firm can reset its price with probability
$1-\theta$. Let $P_t^*$ denote the optimal reset price if a firm can
reset.\footnote{%
  Since all firms are identical, referring to a common optimal reset
  price is fine.
}
On the other hand, with probability $\theta$, it's stuck at previous
price $P_{t-1}(i)$.

We start by deriving aggregate price dynamics, relating $P_t$ to
$P_{t-1}$ and the optimal reset price $P_t^*$. After that, we drill down
to the price setting decision at the firm level, which relates $P_t^*$
to fundamentals like marginal costs.


\subsubsection{Aggregate Price Dynamics}

Recall the expression for aggregate price level $P_t$, derived in the
household problem. Letting, $S_t\subseteq[0,1]$ denote the set of firms
resetting prices, we have
\begin{align*}
  P_t
  =
  \left[
    \int_0^1 P_t(i)^{1-\varepsilon}\;di
  \right]^{\frac{1}{1-\varepsilon}}
  %&= \left[
    %\int_{S_t} (P_t^*)^{1-\varepsilon}\;di
    %+
    %\int_{S_t^c} P_{t-1}(i)^{1-\varepsilon}\;di
  %\right]^{\frac{1}{1-\varepsilon}}
  %\\
  %\implies\quad P_t
  &= \left[
    (1-\theta) (P_t^*)^{1-\varepsilon}
    +
    \theta P_{t-1}^{1-\varepsilon}
  \right]^{\frac{1}{1-\varepsilon}}
\end{align*}
%Since who gets to reset is totally random (i.e. independent of
%duration since last reset), the average price of those who can't
%reset (in $S^c_t$) is the same as the average last period.
Define $\Pi_t=P_t/P_{t-1}$ and divide by $P_{t-1}$
\begin{align*}
  \boxed{%
  \Pi_t^{1-\varepsilon}
  =
    \theta
    +
    (1-\theta)
    \left(\frac{P_t^*}{P_{t-1}}\right)^{1-\varepsilon}
  }
\end{align*}
We now want to log linearize aggregate price dynamics around the
zero-inflation steady state where $P_t^*=P_{t-1}$ and $\Pi_t=1$:
\begin{align}
  \Pi_t^{1-\varepsilon}
  &=
    \theta
    +
    (1-\theta)
    \left(\frac{P_t^*}{P_{t-1}}\right)^{1-\varepsilon}
  \label{calvoagg}
\end{align}
First, the LHS. We can write the LHS as
\begin{align*}
  \Pi_t^{1-\varepsilon}
  = \exp\big(\ln \Pi_t^{1-\varepsilon}\big)
  &= \exp\big(
    (1-\varepsilon)\pi_t
  \big)
\end{align*}
Taking $x_t=(1-\varepsilon)\pi_t$ so that $x=0$, we can
approximate
\begin{align*}
  \Pi_t^{1-\varepsilon}
  &\approx
  \exp(x) + \exp(x)(x_t-x)
  = \exp(0) + \exp(0)((1-\varepsilon)\pi_t-0)
  %\\
  = 1+ (1-\varepsilon)\pi_t
\end{align*}
Now the term on the RHS:
\begin{align*}
  \left(\frac{P_t^*}{P_{t-1}}\right)^{1-\varepsilon}
  = \exp\bigg\{
    \ln \left(\frac{P_t^*}{P_{t-1}}\right)^{1-\varepsilon}
    \bigg\}
  = \exp\big\{
    (1-\varepsilon)(p_t^*-p_{t-1})
    \big\}
\end{align*}
Taking $x_t=(1-\varepsilon)(p_t^*-p_{t-1})$ so
$x=0$ (since no price changes in steady state):
\begin{align*}
  \left(P_t^*/P_{t-1}\right)^{1-\varepsilon}
  &\approx
  \exp(x) + \exp(x)(x_t-x)
  = \exp(0) + \exp(0)
    ((1-\varepsilon)(p_t^*-p_{t-1}))
  \\
  &= 1 + (1-\varepsilon)(p_t^*-p_{t-1})
\end{align*}
Plugging these approximations into the LHS and RHS of
Expression~\ref{calvoagg} and simplifying
\begin{align*}
  \boxed{%
  \pi_t = (1-\theta)(p_t^*-p_{t-1})
  }
  \qquad\iff\qquad
  \boxed{%
  p_t  =
    (1-\theta)p_t^*
    + \theta p_{t-1}
  }
\end{align*}


\subsubsection{Optimal Price-Setting for Firms}

Let $V_t(i)$ denote the value at $t$ of a firm $i$ that can reset
its price at $t$ and does so optimally (now and in the future when
possible). It is the maximized expected discounted future
profits/dividends (denoted $D_t(i)$) using the owner-household's
discount factor.
\begin{align}
  V_t(i)
  =
  \max_{\{P_{s}^*(i)\}_{s=t}^\infty}
  \sum_{k=0}^\infty
  \E_t
  \left[
  \frac{\Lambda_{t,t+k}}{P_{t+k}}
  D_t(i)
  \right]
  \qquad \text{where}\quad
  \Lambda_{t,t+k} := \beta^k\frac{U_{c,t+k}}{U_{c,t}}
  \label{calvovalue}
\end{align}
To simplify, we define a few objects that will be useful.
In particular:
\begin{itemize}
  \item $P^*_t(i)$ denotes the optimal price for firm $i$ if it can
    reset in period $t$.
  \item
    $Y_{t|s}(i)$ denotes demand for the $i$th good in period $t$
    given that price was last reset at time $s$ to optimal
    $P_s^*(i)$.  This is obviously given to us by the demand curve
    and the derivative, as computed above in
    Expression~\ref{nkdemand}
    \begin{align}
      Y_{t|s}(i)
      &=
      \left(
      \frac{P_s^*(i)}{P_t}
      \right)^{-\varepsilon}
      Y_t
      \quad\implies\quad
      \frac{\partial Y_{t|s}}{\partial P_s(i)}
      =
      -\varepsilon
      \frac{Y_{t|s}}{P_s^*(i)}
      \label{calvodemand}
    \end{align}

  \item
    $N_{t|s}(i)$: amount of labor firm $i$ must hire at time $t$
    to meet demand given that its price was last reset at time $s$
    to optimal $P_s^*(i)$. Pinned down by technology as computed
    above in Expression~\ref{nklabor}
    \begin{align}
      N_{t|s}(i) =
      \left(\frac{Y_{t|s}(i)}{A_t}\right)^{\frac{1}{1-\alpha}}
      \label{calvolabor}
    \end{align}

  \item
    $\Psi_{t|s}(i)=\calC'_t(Y_{t|s}(i))$ denotes nominal marginal
    cost to firm $i$ at $t$ who last reset its price at time $s$. It
    is now producing $Y_{t|s}(i)$ units of output with $N_{t|s}(i)$
    units of labor. Hence, nominal total and marginal cost are as in
    Expression~\ref{nkcost} above:
    \begin{align}
      \calC_t(Y_{t|s}(i))=W_tN_{t|s}(i)
      \qquad\quad
      \Psi_{t|s}(i) = \calC_t'(Y_{t|s}(i))
      = \frac{W_t N_{t|s}(i)^\alpha}{(1-\alpha)A_t}
      \label{calvomc}
    \end{align}

  \item
    $D_{t|s}$(i):
    profits/dividends for $i$ at $t$ given that price last reset
    at time $s$ to $P_s^*(i)$:
    \begin{align}
      D_{t|s}(i) =
      P^*_s(i)Y_{t|s}(i) - \calC_t(Y_{t|s}(i))
      \label{calvoprofits}
    \end{align}
\end{itemize}
With these objects, we can write out an arbitrary term in the sum of
Equation~\ref{calvovalue} as
\begin{align*}
  \E_t\left\{
  \frac{\Lambda_{t,t+k}}{P_{t+k}}
  D_t(i)
  \right\}
  =
  \E_t\left\{
  \frac{\Lambda_{t,t+k}}{P_{t+k}}
  \left[
  \theta^kD_{t+k|t}(i)
  +
  \sum_{h=1}^k
  \theta^{k-h}(1-\theta)D_{t+k|t+h}(i)
  \right]
  \right\}
\end{align*}
Let's discuss what's in square brackets on RHS. First
is $D_{t+k|t}(i)$ (profits given last reset at $t$) multiplied
by probability $\theta^k$ of being stuck at $P_t^*(i)$ for $k$
periods. Now the sum, whose terms are similar.
Only instead, we multiply profits $D_{t+k|t+h}(i)$ by probability
$\theta^{k-h}(1-\theta)$, which includes prob.
$\theta^{k-h}$ of being stuck at $P_{t+h}^*(i)$ between $t+h$ and
$t+k$, times prob. $1-\theta$ of being free to reset at
$t+h$.  There's also implicity multiplication by prob. 1,
capturing that we sum over all reset/no-reset
possibilities between $t$ and $t+h$.
\clearpage
Now that we have a general form for the terms of
Equation~\ref{calvovalue}, we rewrite that equation \begin{align}
  V_t(i)
  =
  \sum_{k=0}^\infty
  \E_t\bigg\{
  \frac{\Lambda_{t,t+k}}{P_{t+k}}
  \bigg[
  \theta^kD_{t+k|t}(i)
  +
  %\underbrace{%
  \sum_{h=1}^k
  \theta^{k-h}(1-\theta)D_{t+k|t+h}(i)
  %}_{(*)}
  \bigg]
  \bigg\}
  \label{calvovalue2}
\end{align}
\emph{However}, note that for each term of the outer sum (indexed by
$k$), the inner sum (indexed by $h$) is \emph{independent} of
$P_t^*(i)$---dividends/profits $D_{t+k|t+h}(i)$ depend on
$P_{t+h}^*(i)$ where $t+h>t$, \emph{not}
$P_t^*(i)$. And since $P_{t+h}^*(i)$ is set optimally without
reference to $P_t^*(i)$ (there's no Rotemberg-style adjustment
costs), the inner sum is independent of $P_t^*(i)$.  Hence, we can
effectively ignore it when solving for optimal $P_t^*(i)$.
Therefore, firm $i$ can equivalently maximize a modified problem
when resetting at $t$:
\begin{align}
  \tilde{V}_t(i)
  = \max_{P_t^*(i)}
  \sum_{k=0}^\infty
  \E_t\bigg\{
  \frac{\Lambda_{t,t+k}}{P_{t+k}}
  \bigg[
  \theta^kD_{t+k|t}(i)
  \bigg]
  \bigg\}
  \label{calvovalue3}
\end{align}
Now we sub in for $D_{t+k|t}^*$ to get
\begin{align}
  \tilde{V}_t(i)
  = \max_{P_t^*(i)}
  \sum_{k=0}^\infty
  \theta^k
  \E_t\bigg\{
  \frac{\Lambda_{t,t+k}}{P_{t+k}}
  \bigg[
  P_t^*(i)Y_{t+k|t}(i)
  - \calC_{t+k}(Y_{t+k|t}(i))
  \bigg]
  \bigg\}
  \label{calvovalue4}
\end{align}
We can take the FOC, use the derivative of $Y_{t+k|t}(i)$ with
respect to $P_t^*(i)$ (already computed in
Expression~\ref{calvodemand} above), and substitute in the formula
for $Y_{t+k|t}$ to simplify
\begin{align*}
  0
  &=
  \sum_{k=0}^\infty
  \theta^k
  \E_t\bigg\{
  \frac{\Lambda_{t,t+k}}{P_{t+k}}
  \bigg[
  Y_{t+k|t}(i)
  +
  P_t^*(i)
  \frac{\partial Y_{t+k|t}(i)}{\partial P_t(i)}
  - \calC_{t+k}'(Y_{t+k|t}(i))
  \frac{\partial Y_{t+k|t}(i)}{\partial P_t(i)}
  \bigg]
  \bigg\}
  \\
  0
  &=
  \sum_{k=0}^\infty
  \theta^k
  \E_t\bigg\{
  \frac{\Lambda_{t,t+k}}{P_{t+k}}
  \bigg[
  Y_{t+k|t}(i)
  - P_t^*(i)
  \varepsilon \frac{Y_{t+k|t}(i)}{P_t^*(i)}
  + \varepsilon \; \Psi_{t+k|t}(i)
  \frac{Y_{t+k|t}(i)}{P_t^*(i)}
  \bigg]
  \bigg\}
\end{align*}
Simplifying, multiplying through by $P_t^*(i)/(1-\varepsilon)$, and
using $\mu=\frac{\varepsilon}{\varepsilon-1}$, we get
\begin{align*}
  \boxed{%
  0
  =
  \sum_{k=0}^\infty
  \theta^k
  \E_t\bigg\{
  \frac{\Lambda_{t,t+k}}{P_{t+k}}
  \bigg[
  P_t^*(i)
  - \mu\;\Psi_{t+k|t}(i)
  \bigg]Y_{t+k|t}(i)
  \bigg\}
  }
\end{align*}
As $\theta\ra 0$ and we approach the frictionless economy with price
resetting every period, the first term has the largest weight so
that we eventually just set $P_t^*(i)=\mu \Psi_{t|t}(i)$.


\clearpage
\subsubsection{Log-Linearizing the Price Setting FOC}

We want to log linearize the price-setting FOC.
Since all firms are identical, those who can reset at $t$ face the
same optimization problem. Therefore, we can drop all the $i$'s that
were floating around, and refer to a common reset price $P_t^*$.
\begin{align}
  0
  &=
  \sum_{k=0}^\infty
  \theta^k
  \E_t\bigg\{
  \frac{\Lambda_{t,t+k}}{P_{t+k}}
  \bigg[
  P_t^*
  - \mu\;\Psi_{t+k|t}
  \bigg]Y_{t+k|t}
  \bigg\}
  \label{calvologlin}
\end{align}
where (taking advantage of market clearing $C_t=Y_t$) the objects
are given by
\begin{align*}
  Y_{t+k|t}
  &=
  Y_{t+k}
  \left(
  \frac{P_t^*}{P_{t+k}}
  \right)^{-\varepsilon}
  \quad
  \Lambda_{t,t+k} = \beta^k\frac{U_{c,t+k}}{U_{c,t}}
  = \beta^k\frac{Z_{t+k}Y_{t+k}^{-\sigma}}{Z_{t}Y_{t}^{-\sigma}}
  \qquad
  \Psi_{t+k|t} =
  \calC_{t+k}'(Y_{t+k|t})
\end{align*}
We now choose the point to log-linearize around. As always, we use
the nonstochastic zero-inflation steady state, which implies
\begin{enumerate}[label=(\roman*)]
  \item $\Lambda_{t,t+k} = \beta^k$ since $C_t$ and $Z_t$ do not
    vary
  \item $P_t^*=P_{t}=P$ for all $t$ since no price changes in
    no-inflation steady state
  \item $Y_{t+k|t}=Y_{t+k}=Y$ which is implied by (ii) and the
    expression for $Y_{t+k|t}$
  \item $\Psi_{t+k|t}=\Psi_t=\Psi$ is implied by (iii) and the
    formula for $\Psi_{t+k|t}$
  \item $P_t^*=P=\mu\Psi$ because that satisfies
    FOC (\ref{calvologlin}) given (ii) and (iv)
\end{enumerate}
Now, we want to log-linearize each term of
Expression~\ref{calvologlin}. To facilitate this task, let's use
linearity of the expectation operator to write that expression as
\begin{align}
  0
  &=
  \sum_{k=0}^\infty
  \theta^k
  \bigg\{
  \E_t\bigg[
  \underbrace{%
    \Lambda_{t,t+k}
    \frac{P_t^*}{P_{t+k}}
    Y^*_{t+k|t}
  }_{A_k}
  \bigg]
  -
  \E_t\bigg[
  \underbrace{%
    \mu\;
    \Lambda_{t,t+k}
    \frac{\Psi_{t+k|t}}{P_{t+k}}
    Y_{t+k|t}
  }_{B_k}
  \bigg]
  \bigg\}
  \label{calvoAB}
\end{align}
We will log-linearize terms $A_k$ and $B_k$ separately, then
subtract. Letting $\tilde{\mu}=\ln\mu$ and
$\psi_{t+k|t}=\ln\Psi_{t+k|t}$, we can rewrite these terms as
\begin{alignat*}{3}
  A_k
  &= \exp\left\{
    \ln\left[
      \Lambda_{t,t+k}
      \frac{P_t^*}{P_{t+k}}
      Y_{t+k|t}
    \right]
  \right\}
  &&= \exp\big\{
    \underbrace{%
    \lambda_{t,t+k}
    + (p_t^*-p_{t+k})
    + y_{t+k|t}
    }_{\text{$=:x_t$ so that $x=\ln \beta^k+0+y$}}
  \big\}
  \\
  B_k
  &= \exp\left\{
    \ln\left[
      \mu
      \Lambda_{t,t+k}
      \frac{\Psi_{t+k|t}}{P_{t+k}}
      Y_{t+k|t}^*
    \right]
  \right\}
  &&= \exp\big\{
    \underbrace{%
    \tilde{\mu} +
    \lambda_{t,t+k}
    + \psi_{t+k|t} - p_{t+k}
    + y_{t+k|t}
    }_{\text{$=:x'_t$ so that $x'=\tilde{\mu}+\ln \beta^k+\psi-p+y$}}
  \big\}
\end{alignat*}
Log linearize the exponential terms, using both
$P=\mu\Psi$ and $p=\tilde{\mu}+\psi$ to simplify $B_k$:
\begin{align*}
  A_k
  = \exp(x_t)
  &\approx
  \exp(x) + \exp(x)(x_t-x)
  \\
  &=
  \beta^k Y
  +
  \beta^k Y
  \big(
  (\lambda_{t,t+k}-\ln\beta^k)
  + (p_t^*-p_{t+k})
  + (y_{t+k|t}-y)
  \big)
  \\
  B_k
  = \exp(x_t)
  &\approx
  \exp(x) + \exp(x)(x_t-x)
  =
  \exp(x)(1+x_t-x)
  \\
  &=
  \frac{\mu \beta^k Y\Psi}{P}
  \big(
  1 +
  (\lambda_{t,t+k}-\ln\beta^k)
  + (\psi_{t+k|t}-\psi)
  %\\
  %&\qquad\qquad\qquad\qquad\qquad\quad
  - (p_{t+k}-p)
  + (y_{t+k|t}-y)
  \big)
  \\
  %\text{Use $p=\tilde{\mu}+\psi$}\;
  \implies\quad
  B_k
  &=
  \beta^k Y
  \big(
  1+
  (\lambda_{t,t+k}-\ln\beta^k)
  + \psi_{t+k|t}
  - p_{t+k}
  + \tilde{\mu}
  + (y_{t+k|t}-y)
  \big)
\end{align*}
Now, subtract $B_k$ from $A_k$ to compute
\begin{align*}
  A_k - B_k
  =
  \beta^k Y
  \big(
  p_t^* - \psi_{t+k|t}
  - \tilde{\mu}
  \big)
\end{align*}
This allows us to rewrite First Order Condition~\ref{calvoAB} as
\begin{align*}
  0
  \approx
  \sum_{k=0}^\infty
  \theta^k
  \E_t\bigg\{
  \beta^kY
  \left(
  p_t^*
  - \psi_{t+k|t}
  -\tilde{\mu}
  \right)
  \bigg\}
\end{align*}
Divide by $Y$, use the fact that $p_t^*$ and $\tilde{\mu}$ are fixed
across $k$ terms to pull them out of the expectation and compute the
geometric sum, then rearrange to get:
\begin{align*}
  \boxed{
  p_t^*
  =
  \tilde{\mu} +
  (1-\beta\theta)\sum_{k=0}^\infty
  (\beta\theta)^k
  \E_t[ \psi_{t+k|t} ]
  }
\end{align*}


\clearpage
\subsubsection{Relating Firms' Marginal Costs $\psi_{t+k|t}$ to Average Marginal Cost $\psi_{t+k}$}

In the Calvo model, we derived the following expression for $p_t^*$
by log-linearizing the first order condition to the firm's optimal
price setting problem:
\begin{align}
  %\boxed{
  p_t^*
  =
  \tilde{\mu} +
  (1-\beta\theta)\sum_{k=0}^\infty
  (\beta\theta)^k
  \E_t[ \psi_{t+k|t} ]
  %}
  \label{calvomcrelate}
\end{align}
But this expresses $p_t^*$ as a function of $\psi_{t+k|t}$ terms
(infinitely many of them for $k=0,1,\ldots$).
We would rather express things in terms of just log-average marginal
cost $\psi_t = \int_0^1\psi_{t}(i)\;di$.
There are two steps involved: (1) Computing $\psi_t$ and expressing it
in terms of aggregates, then (2) relating $\psi_t$ to $\psi_{t+k|t}$
for all possible $k$.

So first, compute $\psi_t$, substituting in for
$\psi_t(i)=\ln\Psi_t(i)$, taking $\Psi_t(i)$ from
Expression~\ref{nkcost}:
\begin{align*}
  \psi_t = \int_0^1 \psi_{t}(i) \; di
  = \int_0^1 \ln \Psi_t(i) \; di
  &= \int_0^1 \ln\left[\frac{W_t N_t(i)^\alpha}{(1-\alpha)A_t}\right] \; di
  \\
  &=\int_0^1 \big[w_t + \alpha n_t(i) - \ln(1-\alpha) - a_t\big] \; di
  \psi_t
  \\
  \implies\quad
  \psi_t &=w_t + \alpha \int_0^1 n_t(i)\; di - \ln(1-\alpha) - a_t
\end{align*}
Recall $N_t=\int_0^1 N_t(i)\;di$; therefore, up to first order
approximation $n_t\approx\int_0^1 n_t(i)\; di$ so
\begin{align}
  \psi_t &=w_t + \alpha n_t - \ln(1-\alpha) - a_t
  \label{calvopsi}
\end{align}
That gives us $\psi_t$, and it's in terms of aggregates. Now we want
to tie it to $\psi_{t+k|t}$ terms.
To do so, recall Expressions~\ref{calvodemand}, \ref{calvolabor},
and \ref{calvomc} for the consumer's demand function, firms' labor
demand, and log marginal cost (ignoring the $i$ because of identical
firms). Then
\begin{alignat*}{5}
  y_{t+k|t}
  &= \ln Y_{t+k|t}
  &&=
  \ln \left(
  \frac{P_t^*}{P_{t+k}}
  \right)^{-\varepsilon}
  Y_{t+k}
  &&=
  \varepsilon(p_{t+k}-p_t^*) + y_{t+k}
  \\
  n_{t+k|t}
  &= \ln N_{t+k|t}
  &&= \ln \left(\frac{Y_{t+k|t}}{A_{t+k}}\right)^{\frac{1}{1-\alpha}}
  &&= \frac{y_{t+k|t}-a_{t+k}}{1-\alpha}
  \\
  \psi_{t+k|t}
  &= \ln \Psi_{t+k|t}
  &&= \ln\left(
  \frac{W_{t+k} N_{t+k|t}^\alpha}{(1-\alpha)A_{t+k}}
  \right)
  &&= w_{t+k} + \alpha n_{t+k|t} - \ln(1-\alpha) - a_{t+k}
\end{alignat*}
To relate $\psi_{t+k}$ to $\psi_{t+k|t}$, subtract
Expression~\ref{calvopsi} (at $t+k$) from
this expression for $\psi_{t+k|t}$
\begin{align*}
  \psi_{t+k|t} - \psi_{t+k}
  &=
  \alpha (n_{t+k|t} - n_{t+k})
\end{align*}
Now use the above expressions for $n_{t+k|t}$ and $y_{t+k|t}$ along
with $n_t = (y_t-a_t)/(1-\alpha)$ to simplify this last expression
to:
\begin{align}
  %\psi_{t+k|t} - \psi_{t+k}
  %&=
  %\alpha \left(
    %\frac{y_{t+k|t}-a_{t+k}}{1-\alpha}
    %-
    %\frac{y_{t+k}-a_{t+k}}{1-\alpha}
  %\right)
  %=
    %\frac{\alpha}{1-\alpha}
  %\left(
  %\varepsilon (p_{t+k}-p_t^*) +y_{t+k}
    %-
    %y_{t+k}
  %\right)
  %\\
  %\implies\quad
  \boxed{%
  \psi_{t+k|t}
  =
  \psi_{t+k} +
  \frac{\alpha\varepsilon }{1-\alpha}
  (p_{t+k}-p_t^*)
  }
  \label{calvomcrelate2}
\end{align}

\subsubsection{Relating Prices to Markups and Marginal Costs}

To relate the aggregate price level to average markups or marginal
costs, substitute Expression~\ref{calvomcrelate2} into
Expression~\ref{calvomcrelate}:
\begin{align}
  p_t^*
  &=
  \tilde{\mu} +
  (1-\beta\theta)\sum_{k=0}^\infty
  (\beta\theta)^k
  \E_t\left[
    \psi_{t+k} +
    \frac{\alpha\varepsilon }{1-\alpha}
    (p_{t+k}-p_t^*)
  \right]
  \notag
\end{align}
We can now play around with geometric sums and rearrange to
\begin{align}
  p_t^*
  &=
  (1-\beta\theta)
  \left\{
  \frac{\tilde{\mu}}{1-\beta\theta}
  -
  \left[
  \frac{\alpha\varepsilon }{1-\alpha}
  \frac{p_t^*}{1-\beta\theta}
  \right]
  +
  \sum_{k=0}^\infty
  (\beta\theta)^k
  \E_t\left[
    \psi_{t+k} +
    \frac{\alpha\varepsilon }{1-\alpha}
    p_{t+k}
  \right]
  \right\}
  \notag
\end{align}
Next, we define the actual markup $\tilde{\mu}_t := p_t-\psi_t$.
In steady state, the actual markup equals the desired markup
$\tilde{\mu}$ since, as we've already shown, $\Psi_t/P_t = 1/\mu$ in
the flex price or zero-inflation steady steady state case. With this
definition at hand, we can rearrange the above into
\begin{align}
  p_t^*
  &=
  (1-\beta\theta)
  \sum_{k=0}^\infty
  (\beta\theta)^k
  \E_t\big[
    p_{t+k}
    -
    \Theta
    (
    \tilde{\mu}_{t+k}
    -\tilde{\mu}
    )
  \big]
  \quad\text{where}\quad
  \Theta
  =
  \frac{1-\alpha +\alpha\varepsilon}{1-\alpha}
  \notag
\end{align}
We can rewrite this as a first order difference equation:
\begin{align*}
  p_t^*
  &=
  (1-\beta\theta)
  \left\{
  \E_t\big[
    p_{t}
    -
    \Theta
    (
    \tilde{\mu}_{t}
    -\tilde{\mu}
    )
  \big]
  +
  \sum_{k=1}^\infty
  (\beta\theta)^k
  \E_t\big[
    p_{t+k}
    -
    \Theta
    (
    \tilde{\mu}_{t+k}
    -\tilde{\mu}
    )
  \big]
  \right\}
  \\
  &=
  (1-\beta\theta)
  \left\{
  p_{t}
  -
  \Theta
  (
  \tilde{\mu}_{t}
  -\tilde{\mu}
  )
  +
  \beta\theta
  \sum_{k=0}^\infty
  (\beta\theta)^k
  \E_t\big[
    p_{t+k+1}
    -
    \Theta
    (
    \tilde{\mu}_{t+k+1}
    -\tilde{\mu}
    )
  \big]
  \right\}
\end{align*}
But recognize now that the sum is effectively $\E_t[p_{t+1}^*]$,
giving
\begin{align*}
  p_t^*
  &=
  (1-\beta\theta)
  \big[
  p_{t}
  -
  \Theta
  (
  \tilde{\mu}_{t}
  -\tilde{\mu}
  )
  \big]
  +
  \beta\theta
  \E_t[p_{t+1}^*]
\end{align*}
But now we can used the log-linearized expression for aggregate
price dynamics (which relates $p_t^*$ to $p_t$ and $p_{t-1}$) to
eliminate $p_{t+1}^*$ and $p_t^*$ terms from the above difference
equation, leaving only aggregates
\begin{align*}
  \boxed{%
  \pi_t
  =
  \beta \E_t[\pi_{t+1}]
  -
  \lambda
  (
  \tilde{\mu}_{t}
  -\tilde{\mu}
  )
  }
  \qquad\text{where}\quad
  \lambda :=
  \frac{(1-\theta)(1-\beta\theta)}{\theta}
  \Theta
\end{align*}
Solving forward, this also gives
\begin{align*}
  \boxed{%
  \pi_t
  =
  -\lambda
  \sum_{k=0}^\infty
  \beta^k
  \E_t\big[
  \tilde{\mu}_{t+k}
  -\tilde{\mu}
  \big]
  }
\end{align*}
Therefore, inflation today is the sum of discounted expected future
markups (in deviations from flex price or steady state markups).

Lastly, the above is sometimes also written in an equivalent
representation that uses \emph{real marginal costs}
$mc_t=\psi_t-p_t$ rather than markups. Obviously $mc_t =
\psi_t-p_t=-\tilde{\mu}_t$ with steady state $mc=-\tilde{\mu}$, so
we can easily rewrite the above expressions as
\begin{align*}
  \boxed{%
  \pi_t
  =
  \beta \E_t[\pi_{t+1}]
  +
  \lambda
  (
  mc_t
  - mc
  )
  }
  \qquad
  \boxed{%
  \pi_t
  =
  \lambda
  \sum_{k=0}^\infty
  \beta^k
  \E_t\big[
  mc_{t+k}
  -mc
  \big]
  }
\end{align*}


\clearpage
\subsection{Equilibrium Conditions}

\subsubsection{Relating Aggregate Labor and Output}

With firms producing different goods, firm-specific labor demand
$N_t(i)$ is entirely pinned down given technology and demand for
$Y_t(i)$:
\begin{align*}
    Y_t(i)=A_tN_t(i)^{1-\alpha}
    \quad\implies\quad
    N_t(i)=\left[\frac{Y_t(i)}{A_t}\right]^{\frac{1}{1-\alpha}}
\end{align*}
At the same time, demand $Y_t(i)=C_t(i)$ is pinned down by
aggregate output $Y_t$ and prices $P_t(i)$ and $P_t$ according
to the product-$i$ demand function derived above
\begin{align*}
  Y_t(i)
  =
  \left( \frac{P_t(i)}{P_t} \right)^{-\epsilon}
  Y_t
  \quad\implies\quad
  N_t(i)
  =\left[
    \frac{Y_t(i)}{A_t}
  \right]^{\frac{1}{1-\alpha}}
  =\left[
    \frac{Y_t}{A_t}
    \left( \frac{P_t(i)}{P_t} \right)^{-\epsilon}
  \right]^{\frac{1}{1-\alpha}}
\end{align*}
Hence, summing across the different firms, aggregate labor
demand $N_t$ is given by
\begin{align*}
  N_t
  = \int_0^1 N_t(i)\; di
  = \int_0^1
      \left[
        \frac{Y_t}{A_t}
        \left( \frac{P_t(i)}{P_t} \right)^{-\epsilon}
      \right]^{\frac{1}{1-\alpha}}
    di
  =
  \left(\frac{Y_t}{A_t}\right)^{\frac{1}{1-\alpha}}
  \int_0^1
  \left( \frac{P_t(i)}{P_t} \right)^{-\frac{\varepsilon}{1-\alpha}}
  di
\end{align*}
Taking logs, we get
\begin{align*}
  n_t = \frac{y_t-a_t}{1-\alpha}
  +
  \underbrace{%
  \ln\left[
  \int_0^1
  \left( \frac{P_t(i)}{P_t} \right)^{-\frac{\varepsilon}{1-\alpha}}
  \; di
  \right]
  }_{(*)}
\end{align*}
But $(*)$ (as we will show) equals zero up to a first order
approximation. Therefore, we get an expression for labor that is
\emph{exactly} the same as in single good case above (up to
first order approximation):
\begin{align*}
  \boxed{%
  n_t = \frac{y_t-a_t}{1-\alpha}
  }
  \quad\iff\quad
  \boxed{%
  (1-\alpha) n_t = y_t-a_t
  }
\end{align*}
\clearpage
Now to show that $(*)$ was indeed zero up to first order
approximation.
\begin{itemize}
  \item First, we log-linearize a generalization of the
    integrand in $(*)$, for arbitrary $\theta$:
    \begin{align*}
      \left(\frac{P_t(i)}{P_t}\right)^\theta
      =\exp\bigg\{
      \ln \left(\frac{P_t(i)}{P_t}\right)^\theta
      \bigg\}
      =\exp\big\{
      \underbrace{%
      \theta(p_t(i)-p_t)
      }_{=:x_t \;\implies\; x=0}
      \big\}
    \end{align*}
    where $x=0$ follows from since $x$ is for zero-inflation
    steady state. Hence,
    \begin{align}
      \left(\frac{P_t(i)}{P_t}\right)^\theta
      = \exp(x_t)
      &\approx \exp(x) + \exp(x)(x_t-x)
      = 1 + \big( \theta(p_t(i)-p_t) \big)
      \label{dispgeneral}
    \end{align}

  \item Next, recall the definition of $P_t$:
    \begin{align}
      P_t =
      \left[
      \int_0^1
      P_t(i)^{1-\varepsilon}\;di
      \right]^{\frac{1}{1-\varepsilon}}
      \quad\iff\quad
      1 =
      \int_0^1
      \left(\frac{P_t(i)}{P_t}\right)^{1-\varepsilon}\;di
      \label{pricedisp1}
    \end{align}
    Be Expression~\ref{dispgeneral}, Expression~\ref{pricedisp1}
    can be written up to first-order approximation
    \begin{align}
      1
      &\approx
      \int_0^1
      \big[
      1 + \big( (1-\varepsilon)(p_t(i)-p_t) \big)
      \big]
      \; di
      \quad\implies\quad
      p_t =
      \int_0^1
      p_t(i)
      \; di
      \label{pricedisp2}
    \end{align}

  \item Lastly, return to the object we really care about,
    $(*)$. Use Expression~\ref{dispgeneral} to rewrite
    $(*)$ as
    \begin{align*}
      (*)=
      \ln
      \int_0^1
      \left( \frac{P_t(i)}{P_t} \right)^{-\frac{\varepsilon}{1-\alpha}}
      di
      &\approx
      \ln
      \int_0^1
      \left[
      1
      -\frac{\varepsilon}{1-\alpha}
      (p_t(i)-p_t)
      \right]di
      \\
      &=
      \ln\left(
      1-
      \frac{\varepsilon}{1-\alpha}
      \left[
      \int_0^1
      p_t(i)
      \;di
      - p_t
      \right]
      \right)
    \end{align*}
    By Equation~\ref{pricedisp2}, the term in brackets is zero.
    Hence, $(*)=\ln(1)=0$.
\end{itemize}


\clearpage
\section{New Stuff}

\clearpage
\subsection{New Keynesian Phillips Curve}

We can combine various conditions to arrive at the
\emph{New Keynesian Phillips Curve} which relates inflation to the
output gap and marginal costs. So start with the definition
\begin{align*}
  M_t
  &= \frac{W_t}{P_tA_t} \\
  \text{Household FOCs}\qquad
  &= \frac{C_t^\sigma N_t^\varphi}{A_t}
  \\
  \text{Market Clearing, then $Y_t=A_tN_t$}\qquad
  &= \frac{Y_t^\sigma N_t^\varphi}{A_t}
  =
  \frac{Y_t^\sigma}{A_t}
  \left(
  \frac{Y_t}{A_t}
  \right)^\varphi \\
  \implies\quad
  M_t &= Y_t^{\sigma+\varphi}A_t^{-(\varphi+1)}
\end{align*}
Expressed in log deviations from the flexible price counterpart
\begin{align*}
  \tilde{m}_t
  &=
  \big[(\sigma+\varphi)y_t-(1+\varphi)a_t\big]
  -
  \big[(\sigma+\varphi)y^n_t-(1+\varphi)a_t\big]
  \\
  &=
  \left(\sigma+\varphi\right)
  \tilde{y}_t
\end{align*}
Therefore, returning to inflation under Rotemberg pricing:
\begin{align*}
  \pi_t &= \tilde{\beta}\;\E_t\pi_{t+1} + \kappa \tilde{m}_t \\
  \text{where}\quad
  \tilde{\beta} &=
    \beta e^{(1-\sigma)g_y} \\
  \kappa &=
    \frac{(\varepsilon-1)(\sigma+\varphi)}{\theta}
\end{align*}


\subsection{New Keynesian Phillips Curve}

Next, we use market clearing to rewrite the consumption Euler equation
as
\begin{align*}
  y_t = \E_ty_{t+1}
  - \frac{1}{\sigma}(r_t-\rho)
  + \frac{1}{\sigma}(1-\rho_z)z_t
\end{align*}
In deviations from the flex-price counterpart:
\begin{align*}
  \tilde{y}_t
  = \E_t\tilde{y}_{t+1}
  - \frac{1}{\sigma}\tilde{r}_t
\end{align*}
If price rigidities vanish as $t\ra\infty$ so that
$\lim_{k\ra\infty}\tilde{y}_{t+k}=0$ sufficient fast, then we solve
the above equation forward to get
\begin{align*}
  \tilde{y}_t
  =
  - \frac{1}{\sigma}
  \sum_{k=0}^\infty \E_t[\tilde{r}_{t+k}]
\end{align*}









%% APPPENDIX %%

\appendix
\clearpage
\section{Log-Linearizing Optimality/Equilibrium Conditions}

This section supports the two sections on the classical monetary and New
Keynesian models.
Here we state some key assumptions, notational conventions, and
functional forms that we need to log-linearize the optimality conditions
that define equilibrium.
\begin{enumerate}
  \item \emph{Utility, Cashless Economy}:
    Assume the period utility function is separable in $C_t$ and $N_t$
    (this leads to nice log-linear expressions for our equilibrium
    conditions) with form
    \begin{align*}
      U(C_t,N_t;Z_t) &=
      \left[
        \frac{C_t^{1-\sigma}-1}{1-\sigma}
        -
        \frac{N_t^{1+\varphi}}{1+\varphi}
      \right] Z_t
      \qquad \sigma,\varphi \geq 0 \\
      \text{where}\quad
      \ln Z_t :=
      z_t &= \rho_z z_{t-1} + \varepsilon_t^z
      \qquad \rho_z\in[0,1)
    \end{align*}
    where $\sigma,\varphi\geq 0$ ensures utility will be concave in
    consumption and convex in hours worked.
    $Z_t$ a preference shifter that effectively changes the discount
    factor (it will only, therefore, affect \emph{inter}temporal
    decisions, not \emph{intra}temporal).

    This utility function has first derivatives
    \begin{align*}
      U_{c,t} = Z_t C_t^{-\sigma}
      \qquad\quad
      U_{n,t} &= -Z_t N_t^{\varphi}
    \end{align*}
    $\varphi$ is the inverse Frisch labor supply elasticity under our
    assumed functional form.


  \item \emph{Utility, Money in the Utility Function}:
    Consumers have prefs for real money balances:
    \begin{align*}
      U(C_t,M_t/P_t,N_t,Z_t) &=
      \left[
        \frac{C_t^{1-\sigma}-1}{1-\sigma}
        + \frac{(M_t/P_t)^{1-\nu}}{1-\nu}
        - \frac{N_t^{1+\varphi}}{1+\varphi}
      \right] Z_t
      \qquad \sigma,\nu,\varphi \geq 0
    \end{align*}
    where $\varphi\geq 0$ ensures utility is concave in real money
    balances.
    Since utility is separable, the other derivatives don't change; we
    just add first derivative with respect to money:
    \begin{align*}
      U_{m/p,t} &= Z_t (M_t/P_t)^{-\nu}
    \end{align*}

  \item \emph{Logged Variables}:
    For any model object $X_t$, we define
    $x_t = \ln X_t$.

  \item \emph{New Variables}:
    Since $Q_t$ is the nominal price of the zero-coupon discount bound,
    define the nominal interest rate as $i_t = -\ln Q_t$. Also define
    $\rho$ as the discount rate implied by $\beta$ the discount factor:
    $\beta = e^{-\rho}$, and define inflation $\pi_t=\ln(P_{t+1}/P_t)$

  \item \emph{Taylor-Expansion Point}:
    To linearize non-linear function $f$, use a first-order expansion
    \begin{align*}
      f(x_t) = f(x_*) + f'(x_*)(x_t-x_*)
    \end{align*}
    For a totally made-up example, we might have
    \begin{align*}
      f(y)=\exp(y)\quad\text{and}\quad
      x_t = \pi_t + i_t - \rho
    \end{align*}
    The point $x_*$ that we Taylor-expand about is the equivalent of
    $x_t$, but in a ``steady state'' that is non-stochastic
    ($\Delta z_t=0$), on a balanced growth path ($\Delta c_t =g$), and
    has zero inflation ($\pi_t=0$). So in the above example, that would
    $x=0+i-\rho$.\footnote{%
      Growth in consumption $\Delta c_t=g$ comes from growth in
      productivity, $A_t$, that we'll see in the firm problem.
    }

  \item
    Suppose $Y_t=\int_0^1 Y_t(i)\; di$, and we want an equivalent in
    logs. If $\ln Y_t(i) - \ln Y_t = y_t(i)-y_t=0$ for all $i$ in steady
    state, then $y_t \approx \int_0^1 y_t(i)\;di$. This follows from
    \begin{align*}
      1
      = \int_0^1 \frac{Y_t(i)}{Y_t}\; di
      %= \int_0^1 \exp\left\{\ln\left(\frac{X_t(i)}{X_t}\right)\right\}\; di
      = \int_0^1 \exp(y_t(i)-y)\; di
      &\approx
      \int_0^1 \big[\exp(0) + \exp(0)(y_t(i)-y_t-0)\big]\; di
      \\
      \implies\quad 1
      &\approx 1 + \int_0^1 y_t(i)\; di -y_t
      \\
      \implies\quad y_t
      &\approx \int_0^1 y_t(i)\; di
    \end{align*}
\end{enumerate}



\end{document}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% SAMPLE CODE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %% VIEW LAYOUT %%

        \layout

    %% LANDSCAPE PAGE %%

        \begin{landscape}
        \end{landscape}

    %% BIBLIOGRAPHIES %%

        \cite{LabelInSourcesFile}  %Use in text; cites
        \citep{LabelInSourcesFile} %Use in text; cites in parens

        \nocite{LabelInSourceFile} % Includes in refs w/o specific citation
        \bibliographystyle{apalike}  % Or some other style

        % To ditch the ``References'' header
        \begingroup
        \renewcommand{\section}[2]{}
        \endgroup

        \bibliography{sources} % where sources.bib has all the citation info

    %% SPACING %%

        \vspace{1in}
        \hspace{1in}

    %% URLS, EMAIL, AND LOCAL FILES %%

      \url{url}
      \href{url}{name}
      \href{mailto:mcocci@raidenlovessusie.com}{name}
      \href{run:/path/to/file.pdf}{name}


    %% INCLUDING PDF PAGE %%

        \includepdf{file.pdf}


    %% INCLUDING CODE %%

        %\verbatiminput{file.ext}
            %   Includes verbatim text from the file

        \texttt{text}
            %   Renders text in courier, or code-like, font

        \matlabcode{file.m}
            %   Includes Matlab code with colors and line numbers

        \lstset{style=bash}
        \begin{lstlisting}
        \end{lstlisting}
            % Inline code rendering


    %% INCLUDING FIGURES %%

        % Basic Figure with size scaling
            \begin{figure}[h!]
               \centering
               \includegraphics[scale=1]{file.pdf}
            \end{figure}

        % Basic Figure with specific height
            \begin{figure}[h!]
               \centering
               \includegraphics[height=5in, width=5in]{file.pdf}
            \end{figure}

        % Figure with cropping, where the order for trimming is  L, B, R, T
            \begin{figure}
               \centering
               \includegraphics[trim={1cm, 1cm, 1cm, 1cm}, clip]{file.pdf}
            \end{figure}

        % Side by Side figures: Use the tabular environment


